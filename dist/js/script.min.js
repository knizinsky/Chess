"use strict";var whitePiece,gameBoard=document.getElementById("gameBoard"),ctx=gameBoard.getContext("2d"),brownColor="#653c10",whiteColor="#dfc795",windowWidth=window.innerWidth,windowHeight=window.innerHeight,gameBoardSize=Math.min(windowWidth,windowHeight,600),board=[["r","p","","","","","P","R"],["n","p","","","","","P","N"],["b","p","","","","","P","B"],["q","p","","","","","P","Q"],["k","p","","","","","P","K"],["b","p","","","","","P","B"],["n","p","","","","","P","N"],["r","p","","","","","P","R"]],pieceNames={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking",P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},whitePiecesID={P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},blackPiecesID={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking"},tileSize=gameBoardSize/8,selectedPiece=null,whitesMove=!0,drawPiece=function(e,i,o){var a=new Image;a.src="./dist/img/".concat(e,".png"),a.onload=function(){ctx.drawImage(a,i,o,tileSize,tileSize)}},drawBoardAndPieces=function(e){for(var i=0,o=0;i<e;i+=tileSize,o++)for(var a=0,r=0;a<e;a+=tileSize,r++){ctx.fillStyle=o%2==0?r%2==0?whiteColor:brownColor:r%2==0?brownColor:whiteColor;var t=board[o][r];""!=t&&drawPiece(pieceNames[t],i,a),ctx.fillRect(i,a,tileSize,tileSize)}},resizeCanvas=function(){gameBoard.width=gameBoardSize,gameBoard.height=gameBoardSize,drawBoardAndPieces(gameBoardSize)},selectPiece=function(e){var i=e.offsetX,e=e.offsetY,o=Math.floor(e/tileSize),a=Math.floor(i/tileSize),e=Math.floor(e/tileSize),i=Math.floor(i/tileSize);selectedPiece=board[a][o],movePiece(selectedPiece,e,i)},checkRules=function(e,n,c,i,o,a,r){var t=Math.abs(i-n),d=Math.abs(o-c),l=!1;if(whitePiece)for(var s in whitePiecesID)s==board[c][n]&&(l=!0);else for(var h in blackPiecesID)h==board[c][n]&&(l=!0);if(1!=l)if("P"==e)6==i&&(n==i-1||n==i-2)&&o==c||n==i-1&&o==c||(o==c+1||o==c-1)&&""!=board[c][n]&&n<i?a():gameBoard.removeEventListener("click",r);else if("p"==e)1==i&&(n==i+1||n==i+2)&&o==c||n==i+1&&o==c||(o==c+1||o==c-1)&&""!=board[c][n]&&i<n?a():gameBoard.removeEventListener("click",r);else if("B"==e||"b"==e){if(d==t){for(var w=function(o){var e=Math.min(c+o,7),i=Math.abs(c-o),a=Math.min(n+o,7),r=Math.abs(n-o);{function t(e,i){"k"===board[e][i]&&1==whitesMove?(console.log("szachPrzezBialych"),console.log(o),console.log(whitesMove),drawPiece("kCHECK",e*tileSize,i*tileSize)):"K"===board[e][i]&&0==whitesMove&&(console.log("szachPrzezCzarnych"),console.log(o),console.log(whitesMove),drawPiece("KCHECK2",e*tileSize,i*tileSize))}""!==board[e][a]&&""!==board[i][r]&&""!==board[e][r]&&""!==board[i][a]||(t(e,a),t(i,r),t(e,r),t(i,a))}if(0==r)return"break";console.log(board[e][r])},f=1;f<=8;f++)if("break"===w(f))break;a()}}else"N"==e||"n"==e?(1==t&&2==d||2==t&&1==d)&&a():"R"==e||"r"==e?0!=t&&0!=d||a():"K"==e||"k"==e?(0<=t||0<=d)&&t<=1&&d<=1&&a():"Q"!=e&&"q"!=e||0!=t&&0!=d&&d!=t||a()},movePiece=function(e,c,d){function i(n){e==n&&board.forEach(function(e,i){e.forEach(function(t,e){t==n&&c==e&&d==i&&gameBoard.addEventListener("click",function e(i){var o=i.offsetX,i=i.offsetY,a=Math.floor(i/tileSize),r=Math.floor(o/tileSize);gameBoard.removeEventListener("click",e),checkRules(n,a,r,c,d,function(){board[r][a]=t,l=board[r][a],drawPiece(pieceNames[l],r*tileSize,a*tileSize),board[d][c]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove},e)})})})}var l;if(whitesMove)for(var o in whitePiecesID)o==e&&(whitePiece=!0,i(o));else for(var a in blackPiecesID)a==e&&(whitePiece=!1,i(a))};window.addEventListener("resize",resizeCanvas),window.addEventListener("load",function(){gameBoard.addEventListener("click",selectPiece),resizeCanvas()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJ3aGl0ZVBpZWNlIiwiZ2FtZUJvYXJkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImN0eCIsImdldENvbnRleHQiLCJicm93bkNvbG9yIiwid2luZG93IiwiaW5uZXJXaWR0aCIsIndoaXRlQ29sb3IiLCJpbm5lckhlaWdodCIsIndpbmRvd1dpZHRoIiwid2luZG93SGVpZ2h0IiwiZ2FtZUJvYXJkU2l6ZSIsIk1hdGgiLCJib2FyZCIsInBpZWNlTmFtZXMiLCJwIiwiciIsIm4iLCJiIiwicSIsImsiLCJ3aGl0ZVBpZWNlc0lEIiwiUCIsIlIiLCJOIiwiQiIsIlEiLCJLIiwidGlsZVNpemUiLCJkcmF3UGllY2UiLCJpbWciLCJzZWxlY3RlZFBpZWNlIiwibCIsIndoaXRlc01vdmUiLCJwaWVjZU5hbWUiLCJ4IiwieSIsImZpbGxTdHlsZSIsInNyYyIsImNvbmNhdCIsIm9ubG9hZCIsImRyYXdJbWFnZSIsImRyYXdCb2FyZEFuZFBpZWNlcyIsInBpZWNlIiwiaiIsImkiLCJ3aWR0aCIsImNsaWNrZWRSb3ciLCJmbG9vciIsIkNSIiwiZmlsbFJlY3QiLCJwaWVjZUlEIiwic2VsZWN0UGllY2UiLCJldmVudCIsImNsaWNrZWRDb2wiLCJ3cm9uZ1Rha2UiLCJDQyIsImNsaWNrZWRSb3dUYXJnZXQiLCJtb3ZlUGllY2UiLCJjaGVja1J1bGVzIiwiZHJhd1BpZWNlT25UYXJnZXQiLCJjbGlja2VkQ29sVGFyZ2V0IiwibWFrZU1vdmUiLCJyb3dEaWZmZXJlbmNlIiwiY29sRGlmZmVyZW5jZSIsImFicyIsImRlY3JlbWVudGVkQ29sIiwiaW5jcmVtZW50ZWRSb3ciLCJkZWNyZW1lbnRlZFJvdyIsImNvbnNvbGUiLCJsb2ciLCJpbmNyZW1lbnRlZENvbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJfbG9vcCIsIm1pbiIsImNoZWNrUGllY2UiLCJjb2wiLCJyb3ciLCJtb3ZlZFBpZWNlIiwid2hpY2hQaWVjZSIsImZvckVhY2giLCJhZGRFdmVudExpc3RlbmVyIiwicmVzaXplQ2FudmFzIiwib2Zmc2V0WCIsIm9mZnNldFkiLCJibGFja1BpZWNlc0lEIl0sIm1hcHBpbmdzIjoiYUFBQSxJQXVESUEsV0F2REVDLFVBQVlDLFNBQVNDLGVBQWUsV0FBVyxFQUMvQ0MsSUFBTUgsVUFBVUksV0FBVyxJQUFJLEVBRC9CSixXQUFZQyxVQUNaRSxXQUFlLFVBQ2ZFLFlBQWFDLE9BQVNDLFdBQ3RCQyxhQUFhRixPQUFTRyxZQUN0QkMsY0FBY0osS0FBT0MsSUFBQUEsWUFBVUksYUFBQSxHQUFBLEVBQy9CQSxNQUFBQSxDQUNOLENBQUEsSUFBTUMsSUFBQUEsR0FBQUEsR0FBZ0JDLEdBQUksR0FBSSxJQUFDSCxLQUMvQixDQUFBLElBQU1JLElBQVEsR0FDWixHQUFLLEdBQUssR0FBSSxJQUFJLEtBVXBCLENBQUEsSUFBTUMsSUFBQUEsR0FBVSxHQUFHLEdBQUEsR0FBQSxJQUFBLEtBUGxCLENBUUFDLElBQUcsSUFBTyxHQUFBLEdBQUEsR0FBQSxHQUFBLElBQUEsS0FQVixDQVFBQyxJQUFHLElBQU8sR0FBQSxHQUFBLEdBQUEsR0FBQSxJQUFBLEtBUFYsQ0FRQUMsSUFBRyxJQUFBLEdBQVMsR0FBQSxHQUFBLEdBQUEsSUFBQSxLQVBaLENBUUFDLElBQUcsSUFBQSxHQUFTLEdBQUEsR0FBQSxHQUFBLElBQUEsS0FQWixDQVFBQyxJQUFHLElBQUEsR0FBUSxHQUFBLEdBQUEsR0FBQSxJQUFBLE1BSVJMLFdBQU8sQ0FSVkMsRUFTQyxRQVJEQyxFQVNDLFFBUkRDLEVBU0MsVUFSREMsRUFTQyxVQUNEQyxFQUFBLFNBRURDLEVBQU1DLFFBUkxDLEVBVUMsUUFUREMsRUFVQyxRQVREQyxFQVVDLFVBVERDLEVBVUMsVUFUREMsRUFVQyxTQUNEQyxFQUFBLE9BRUQsRUFFSU4sY0FBTyxDQVZWQyxFQVdDLFFBVkRDLEVBV0MsUUFWREMsRUFXQyxVQVZEQyxFQVdDLFVBQ0RDLEVBQUEsU0FFREMsRUFBSUMsT0FDSixFQUVJOUIsY0FBVSxDQUVkaUIs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LEVBRS9DSCxXQUNDUixFQUNBTSxFQUNBSSxFQUNBWixFQUNBTyxFQTNCeUIsV0FFekIzQyxNQUFNZ0QsR0FBa0JKLEdBQW9CSCxFQUU1Q3dCLEVBQWFqRSxNQUFNZ0QsR0FBa0JKLEdBRXJDNUIsVUFDQ2YsV0FBV2dFLEdBQ1hqQixFQUFtQmpDLFNBQ25CNkIsRUFBbUI3QixRQUFRLEVBRzVCZixNQUFNMkMsR0FBSVAsR0FBTSxHQUVoQlAsbUJBQW1CL0IsYUFBYSxFQUVoQ3NCLFdBQWEsQ0FBQ0EsVUFFZixFQVdDNkIsQ0FBUSxDQUVWLENBRTRDLENBRTlDLENBQUMsQ0FDRixDQUFDLENBRUgsQ0FwREEsSUFBSWdCLEVBc0RKLEdBQUk3QyxXQUNILElBQUssSUFBSWtCLEtBQVc5QixjQUNmOEIsR0FBV3BCLElBQ2RqQyxXQUFhLENBQUEsRUFDYmlGLEVBQVc1QixDQUFPLFFBSXBCLElBQUssSUFBSUEsS0FBV2tDLGNBQ2ZsQyxHQUFXcEIsSUFDZGpDLFdBQWEsQ0FBQSxFQUNiaUYsRUFBVzVCLENBQU8sRUFJdEIsRUFFQTlDLE9BQU80RSxpQkFBaUIsU0FBVUMsWUFBWSxFQUU5QzdFLE9BQU80RSxpQkFBaUIsT0FBUSxXQUMvQmxGLFVBQVVrRixpQkFBaUIsUUFBUzdCLFdBQVcsRUFDL0M4QixhQUFZLENBQ2IsQ0FBQyIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZ2FtZUJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnYW1lQm9hcmRcIik7XHJcbmNvbnN0IGN0eCA9IGdhbWVCb2FyZC5nZXRDb250ZXh0KFwiMmRcIik7XHJcbmNvbnN0IGJyb3duQ29sb3IgPSBcIiM2NTNjMTBcIjtcclxuY29uc3Qgd2hpdGVDb2xvciA9IFwiI2RmYzc5NVwiO1xyXG5jb25zdCB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG5jb25zdCB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbmNvbnN0IGdhbWVCb2FyZFNpemUgPSBNYXRoLm1pbih3aW5kb3dXaWR0aCwgd2luZG93SGVpZ2h0LCA2MDApO1xyXG5jb25zdCBib2FyZCA9IFtcclxuXHRbXCJyXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJSXCJdLFxyXG5cdFtcIm5cIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIk5cIl0sXHJcblx0W1wiYlwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiQlwiXSxcclxuXHRbXCJxXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJRXCJdLFxyXG5cdFtcImtcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIktcIl0sXHJcblx0W1wiYlwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiQlwiXSxcclxuXHRbXCJuXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJOXCJdLFxyXG5cdFtcInJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIlJcIl0sXHJcbl07XHJcblxyXG5jb25zdCBwaWVjZU5hbWVzID0ge1xyXG5cdHA6IFwiQnBhd25cIixcclxuXHRyOiBcIkJyb29rXCIsXHJcblx0bjogXCJCa25pZ2h0XCIsXHJcblx0YjogXCJCYmlzaG9wXCIsXHJcblx0cTogXCJCcXVlZW5cIixcclxuXHRrOiBcIkJraW5nXCIsXHJcblxyXG5cdFA6IFwiV3Bhd25cIixcclxuXHRSOiBcIldyb29rXCIsXHJcblx0TjogXCJXa25pZ2h0XCIsXHJcblx0QjogXCJXYmlzaG9wXCIsXHJcblx0UTogXCJXcXVlZW5cIixcclxuXHRLOiBcIldraW5nXCIsXHJcbn07XHJcblxyXG5jb25zdCB3aGl0ZVBpZWNlc0lEID0ge1xyXG5cdFA6IFwiV3Bhd25cIixcclxuXHRSOiBcIldyb29rXCIsXHJcblx0TjogXCJXa25pZ2h0XCIsXHJcblx0QjogXCJXYmlzaG9wXCIsXHJcblx0UTogXCJXcXVlZW5cIixcclxuXHRLOiBcIldraW5nXCIsXHJcbn07XHJcblxyXG5jb25zdCBibGFja1BpZWNlc0lEID0ge1xyXG5cdHA6IFwiQnBhd25cIixcclxuXHRyOiBcIkJyb29rXCIsXHJcblx0bjogXCJCa25pZ2h0XCIsXHJcblx0YjogXCJCYmlzaG9wXCIsXHJcblx0cTogXCJCcXVlZW5cIixcclxuXHRrOiBcIkJraW5nXCIsXHJcbn07XHJcblxyXG5sZXQgdGlsZVNpemUgPSBnYW1lQm9hcmRTaXplIC8gODtcclxubGV0IHNlbGVjdGVkUGllY2UgPSBudWxsO1xyXG5sZXQgd2hpdGVzTW92ZSA9IHRydWU7XHJcbmxldCB3aGl0ZVBpZWNlO1xyXG5cclxuY29uc3QgZHJhd1BpZWNlID0gKHBpZWNlTmFtZSwgeCwgeSkgPT4ge1xyXG5cdGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xyXG5cdGltZy5zcmMgPSBgLi9kaXN0L2ltZy8ke3BpZWNlTmFtZX0ucG5nYDtcclxuXHJcblx0aW1nLm9ubG9hZCA9ICgpID0+IHtcclxuXHRcdGN0eC5kcmF3SW1hZ2UoaW1nLCB4LCB5LCB0aWxlU2l6ZSwgdGlsZVNpemUpO1xyXG5cdH07XHJcbn07XHJcblxyXG5jb25zdCBkcmF3Qm9hcmRBbmRQaWVjZXMgPSAoZ2FtZUJvYXJkU2l6ZSkgPT4ge1xyXG5cdGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IGdhbWVCb2FyZFNpemU7IGkgKz0gdGlsZVNpemUsIGorKykge1xyXG5cdFx0Zm9yIChsZXQgayA9IDAsIGwgPSAwOyBrIDwgZ2FtZUJvYXJkU2l6ZTsgayArPSB0aWxlU2l6ZSwgbCsrKSB7XHJcblx0XHRcdGlmIChqICUgMiA9PT0gMCkge1xyXG5cdFx0XHRcdGlmIChsICUgMiA9PT0gMCkge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IHdoaXRlQ29sb3I7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSBicm93bkNvbG9yO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRpZiAobCAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSBicm93bkNvbG9yO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gd2hpdGVDb2xvcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGNvbnN0IHBpZWNlID0gYm9hcmRbal1bbF07XHJcblxyXG5cdFx0XHRpZiAocGllY2UgIT0gXCJcIikge1xyXG5cdFx0XHRcdGRyYXdQaWVjZShwaWVjZU5hbWVzW3BpZWNlXSwgaSwgayk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGN0eC5maWxsUmVjdChpLCBrLCB0aWxlU2l6ZSwgdGlsZVNpemUpO1xyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcbmNvbnN0IHJlc2l6ZUNhbnZhcyA9ICgpID0+IHtcclxuXHRnYW1lQm9hcmQud2lkdGggPSBnYW1lQm9hcmRTaXplO1xyXG5cdGdhbWVCb2FyZC5oZWlnaHQgPSBnYW1lQm9hcmRTaXplO1xyXG5cdGRyYXdCb2FyZEFuZFBpZWNlcyhnYW1lQm9hcmRTaXplKTtcclxufTtcclxuXHJcbmNvbnN0IHNlbGVjdFBpZWNlID0gKGV2ZW50KSA9PiB7XHJcblx0bGV0IHggPSBldmVudC5vZmZzZXRYO1xyXG5cdGxldCB5ID0gZXZlbnQub2Zmc2V0WTtcclxuXHJcblx0Y29uc3QgY2xpY2tlZFJvdyA9IE1hdGguZmxvb3IoeSAvIHRpbGVTaXplKTtcclxuXHRjb25zdCBjbGlja2VkQ29sID0gTWF0aC5mbG9vcih4IC8gdGlsZVNpemUpO1xyXG5cclxuXHRjb25zdCBDUiA9IE1hdGguZmxvb3IoeSAvIHRpbGVTaXplKTtcclxuXHRjb25zdCBDQyA9IE1hdGguZmxvb3IoeCAvIHRpbGVTaXplKTtcclxuXHJcblx0c2VsZWN0ZWRQaWVjZSA9IGJvYXJkW2NsaWNrZWRDb2xdW2NsaWNrZWRSb3ddO1xyXG5cclxuXHRtb3ZlUGllY2Uoc2VsZWN0ZWRQaWVjZSwgQ1IsIENDKTtcclxufTtcclxuXHJcbmNvbnN0IGNoZWNrUnVsZXMgPSAoXHJcblx0cGllY2VJRCxcclxuXHRjbGlja2VkUm93VGFyZ2V0LFxyXG5cdGNsaWNrZWRDb2xUYXJnZXQsXHJcblx0Q1IsXHJcblx0Q0MsXHJcblx0ZHJhd1BpZWNlT25UYXJnZXQsXHJcblx0bWFrZU1vdmVcclxuKSA9PiB7XHJcblx0bGV0IHJvd0RpZmZlcmVuY2UgPSBNYXRoLmFicyhDUiAtIGNsaWNrZWRSb3dUYXJnZXQpO1xyXG5cdGxldCBjb2xEaWZmZXJlbmNlID0gTWF0aC5hYnMoQ0MgLSBjbGlja2VkQ29sVGFyZ2V0KTtcclxuXHRsZXQgd3JvbmdUYWtlID0gZmFsc2U7XHJcblxyXG5cdGlmICh3aGl0ZVBpZWNlKSB7XHJcblx0XHRmb3IgKGxldCBwaWVjZUlEIGluIHdoaXRlUGllY2VzSUQpIHtcclxuXHRcdFx0aWYgKHBpZWNlSUQgPT0gYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0pIHtcclxuXHRcdFx0XHR3cm9uZ1Rha2UgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSBlbHNlIHtcclxuXHRcdGZvciAobGV0IHBpZWNlSUQgaW4gYmxhY2tQaWVjZXNJRCkge1xyXG5cdFx0XHRpZiAocGllY2VJRCA9PSBib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSkge1xyXG5cdFx0XHRcdHdyb25nVGFrZSA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGlmICh3cm9uZ1Rha2UgIT0gdHJ1ZSkge1xyXG5cdFx0Ly8gUGF3bnNcclxuXHRcdGlmIChwaWVjZUlEID09IFwiUFwiKSB7XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHRDUiA9PSA2ICYmXHJcblx0XHRcdFx0KGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgLSAxIHx8IGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgLSAyKSAmJlxyXG5cdFx0XHRcdENDID09IGNsaWNrZWRDb2xUYXJnZXRcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIGlmIChjbGlja2VkUm93VGFyZ2V0ID09IENSIC0gMSAmJiBDQyA9PSBjbGlja2VkQ29sVGFyZ2V0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIGlmIChcclxuXHRcdFx0XHQoQ0MgPT0gY2xpY2tlZENvbFRhcmdldCArIDEgfHwgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCAtIDEpICYmXHJcblx0XHRcdFx0Ym9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gIT0gXCJcIiAmJlxyXG5cdFx0XHRcdGNsaWNrZWRSb3dUYXJnZXQgPCBDUlxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGdhbWVCb2FyZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJwXCIpIHtcclxuXHRcdFx0aWYgKFxyXG5cdFx0XHRcdENSID09IDEgJiZcclxuXHRcdFx0XHQoY2xpY2tlZFJvd1RhcmdldCA9PSBDUiArIDEgfHwgY2xpY2tlZFJvd1RhcmdldCA9PSBDUiArIDIpICYmXHJcblx0XHRcdFx0Q0MgPT0gY2xpY2tlZENvbFRhcmdldFxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgKyAxICYmIENDID09IGNsaWNrZWRDb2xUYXJnZXQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKFxyXG5cdFx0XHRcdChDQyA9PSBjbGlja2VkQ29sVGFyZ2V0ICsgMSB8fCBDQyA9PSBjbGlja2VkQ29sVGFyZ2V0IC0gMSkgJiZcclxuXHRcdFx0XHRib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSAhPSBcIlwiICYmXHJcblx0XHRcdFx0Y2xpY2tlZFJvd1RhcmdldCA+IENSXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Z2FtZUJvYXJkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEJpc2hvcHNcclxuXHRcdH0gZWxzZSBpZiAocGllY2VJRCA9PSBcIkJcIiB8fCBwaWVjZUlEID09IFwiYlwiKSB7XHJcblx0XHRcdGlmIChjb2xEaWZmZXJlbmNlID09IHJvd0RpZmZlcmVuY2UpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBpID0gMTsgaSA8PSA4OyBpKyspIHtcclxuXHRcdFx0XHRcdGxldCBpbmNyZW1lbnRlZENvbCA9IE1hdGgubWluKGNsaWNrZWRDb2xUYXJnZXQgKyBpLCA3KTtcclxuXHRcdFx0XHRcdGxldCBkZWNyZW1lbnRlZENvbCA9IE1hdGguYWJzKGNsaWNrZWRDb2xUYXJnZXQgLSBpKTtcclxuXHRcdFx0XHRcdGxldCBpbmNyZW1lbnRlZFJvdyA9IE1hdGgubWluKGNsaWNrZWRSb3dUYXJnZXQgKyBpLCA3KTtcclxuXHRcdFx0XHRcdGxldCBkZWNyZW1lbnRlZFJvdyA9IE1hdGguYWJzKGNsaWNrZWRSb3dUYXJnZXQgLSBpKTtcclxuXHJcblx0XHRcdFx0XHRjb25zdCBpc0NoZWNrID0gKCkgPT4ge1xyXG5cdFx0XHRcdFx0XHRjb25zdCBjaGVja1BpZWNlID0gKGNvbCwgcm93KSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGJvYXJkW2NvbF1bcm93XSA9PT0gXCJrXCIgJiYgd2hpdGVzTW92ZSA9PSB0cnVlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcInN6YWNoUHJ6ZXpCaWFseWNoXCIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coaSk7XHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyh3aGl0ZXNNb3ZlKTtcclxuXHRcdFx0XHRcdFx0XHRcdGRyYXdQaWVjZShcImtDSEVDS1wiLCBjb2wgKiB0aWxlU2l6ZSwgcm93ICogdGlsZVNpemUpO1xyXG5cdFx0XHRcdFx0XHRcdH1lbHNlIGlmKGJvYXJkW2NvbF1bcm93XSA9PT0gXCJLXCIgJiYgd2hpdGVzTW92ZSA9PSBmYWxzZSl7XHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcInN6YWNoUHJ6ZXpDemFybnljaFwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKGkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2cod2hpdGVzTW92ZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRkcmF3UGllY2UoXCJLQ0hFQ0syXCIsIGNvbCAqIHRpbGVTaXplLCByb3cgKiB0aWxlU2l6ZSk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHRcdFx0Y2hlY2tQaWVjZShpbmNyZW1lbnRlZENvbCwgaW5jcmVtZW50ZWRSb3cpO1xyXG5cdFx0XHRcdFx0XHRjaGVja1BpZWNlKGRlY3JlbWVudGVkQ29sLCBkZWNyZW1lbnRlZFJvdyk7XHJcblx0XHRcdFx0XHRcdGNoZWNrUGllY2UoaW5jcmVtZW50ZWRDb2wsIGRlY3JlbWVudGVkUm93KTtcclxuXHRcdFx0XHRcdFx0Y2hlY2tQaWVjZShkZWNyZW1lbnRlZENvbCwgaW5jcmVtZW50ZWRSb3cpO1xyXG5cdFx0XHRcdFx0fTtcclxuXHJcblx0XHRcdFx0XHRpZiAoXHJcblx0XHRcdFx0XHRcdGJvYXJkW2luY3JlbWVudGVkQ29sXVtpbmNyZW1lbnRlZFJvd10gPT09IFwiXCIgfHxcclxuXHRcdFx0XHRcdFx0Ym9hcmRbZGVjcmVtZW50ZWRDb2xdW2RlY3JlbWVudGVkUm93XSA9PT0gXCJcIiB8fFxyXG5cdFx0XHRcdFx0XHRib2FyZFtpbmNyZW1lbnRlZENvbF1bZGVjcmVtZW50ZWRSb3ddID09PSBcIlwiIHx8XHJcblx0XHRcdFx0XHRcdGJvYXJkW2RlY3JlbWVudGVkQ29sXVtpbmNyZW1lbnRlZFJvd10gPT09IFwiXCJcclxuXHRcdFx0XHRcdCkge1xyXG5cdFx0XHRcdFx0XHRpc0NoZWNrKCk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKGRlY3JlbWVudGVkUm93ID09IDApIGJyZWFrO1xyXG5cclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGJvYXJkW2luY3JlbWVudGVkQ29sXVtkZWNyZW1lbnRlZFJvd10pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vIEtuaWdodHNcclxuXHRcdH0gZWxzZSBpZiAocGllY2VJRCA9PSBcIk5cIiB8fCBwaWVjZUlEID09IFwiblwiKSB7XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHQocm93RGlmZmVyZW5jZSA9PSAxICYmIGNvbERpZmZlcmVuY2UgPT0gMikgfHxcclxuXHRcdFx0XHQocm93RGlmZmVyZW5jZSA9PSAyICYmIGNvbERpZmZlcmVuY2UgPT0gMSlcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBSb29rc1xyXG5cdFx0fSBlbHNlIGlmIChwaWVjZUlEID09IFwiUlwiIHx8IHBpZWNlSUQgPT0gXCJyXCIpIHtcclxuXHRcdFx0aWYgKHJvd0RpZmZlcmVuY2UgPT0gMCB8fCBjb2xEaWZmZXJlbmNlID09IDApIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vIEtpbmdzXHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJLXCIgfHwgcGllY2VJRCA9PSBcImtcIikge1xyXG5cdFx0XHRpZiAoXHJcblx0XHRcdFx0KHJvd0RpZmZlcmVuY2UgPj0gMCB8fCBjb2xEaWZmZXJlbmNlID49IDApICYmXHJcblx0XHRcdFx0cm93RGlmZmVyZW5jZSA8PSAxICYmXHJcblx0XHRcdFx0Y29sRGlmZmVyZW5jZSA8PSAxXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gUXVlZW5zXHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJRXCIgfHwgcGllY2VJRCA9PSBcInFcIikge1xyXG5cdFx0XHRpZiAocm93RGlmZmVyZW5jZSA9PSAwIHx8IGNvbERpZmZlcmVuY2UgPT0gMCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSBpZiAoY29sRGlmZmVyZW5jZSA9PSByb3dEaWZmZXJlbmNlKSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcbmNvbnN0IG1vdmVQaWVjZSA9IChzZWxlY3RlZFBpZWNlLCBDUiwgQ0MpID0+IHtcclxuXHRsZXQgbW92ZWRQaWVjZTtcclxuXHJcblx0Y29uc3Qgd2hpY2hQaWVjZSA9IChwaWVjZUlEKSA9PiB7XHJcblx0XHRpZiAoc2VsZWN0ZWRQaWVjZSA9PSBwaWVjZUlEKSB7XHJcblx0XHRcdGJvYXJkLmZvckVhY2goKGNsaWNrZWRSb3csIGkpID0+IHtcclxuXHRcdFx0XHRjbGlja2VkUm93LmZvckVhY2goKGNsaWNrZWRDb2wsIGopID0+IHtcclxuXHRcdFx0XHRcdGlmIChjbGlja2VkQ29sID09IHBpZWNlSUQgJiYgQ1IgPT0gaiAmJiBDQyA9PSBpKSB7XHJcblx0XHRcdFx0XHRcdGNvbnN0IG1ha2VNb3ZlID0gKGV2ZW50KSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0bGV0IHggPSBldmVudC5vZmZzZXRYO1xyXG5cdFx0XHRcdFx0XHRcdGxldCB5ID0gZXZlbnQub2Zmc2V0WTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgY2xpY2tlZFJvd1RhcmdldCA9IE1hdGguZmxvb3IoeSAvIHRpbGVTaXplKTtcclxuXHRcdFx0XHRcdFx0XHRjb25zdCBjbGlja2VkQ29sVGFyZ2V0ID0gTWF0aC5mbG9vcih4IC8gdGlsZVNpemUpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRjb25zdCBkcmF3UGllY2VPblRhcmdldCA9ICgpID0+IHtcclxuXHRcdFx0XHRcdFx0XHRcdC8vIGlmIChib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSA9PSBcIlwiIHx8IHdoaXRlUGllY2UgPT0gdHJ1ZSB8fCB3aGl0ZVBpZWNlID09IGZhbHNlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSA9IGNsaWNrZWRDb2w7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0bW92ZWRQaWVjZSA9IGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdGRyYXdQaWVjZShcclxuXHRcdFx0XHRcdFx0XHRcdFx0cGllY2VOYW1lc1ttb3ZlZFBpZWNlXSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2xpY2tlZENvbFRhcmdldCAqIHRpbGVTaXplLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRjbGlja2VkUm93VGFyZ2V0ICogdGlsZVNpemVcclxuXHRcdFx0XHRcdFx0XHRcdCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0Ym9hcmRbQ0NdW0NSXSA9IFwiXCI7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0ZHJhd0JvYXJkQW5kUGllY2VzKGdhbWVCb2FyZFNpemUpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdHdoaXRlc01vdmUgPSAhd2hpdGVzTW92ZTtcclxuXHRcdFx0XHRcdFx0XHRcdC8vIH1cclxuXHRcdFx0XHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHRcdFx0XHRnYW1lQm9hcmQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG1ha2VNb3ZlKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Y2hlY2tSdWxlcyhcclxuXHRcdFx0XHRcdFx0XHRcdHBpZWNlSUQsXHJcblx0XHRcdFx0XHRcdFx0XHRjbGlja2VkUm93VGFyZ2V0LFxyXG5cdFx0XHRcdFx0XHRcdFx0Y2xpY2tlZENvbFRhcmdldCxcclxuXHRcdFx0XHRcdFx0XHRcdENSLFxyXG5cdFx0XHRcdFx0XHRcdFx0Q0MsXHJcblx0XHRcdFx0XHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCxcclxuXHRcdFx0XHRcdFx0XHRcdG1ha2VNb3ZlXHJcblx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0fTtcclxuXHJcblx0XHRcdFx0XHRcdGdhbWVCb2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRpZiAod2hpdGVzTW92ZSkge1xyXG5cdFx0Zm9yIChsZXQgcGllY2VJRCBpbiB3aGl0ZVBpZWNlc0lEKSB7XHJcblx0XHRcdGlmIChwaWVjZUlEID09IHNlbGVjdGVkUGllY2UpIHtcclxuXHRcdFx0XHR3aGl0ZVBpZWNlID0gdHJ1ZTtcclxuXHRcdFx0XHR3aGljaFBpZWNlKHBpZWNlSUQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSBlbHNlIHtcclxuXHRcdGZvciAobGV0IHBpZWNlSUQgaW4gYmxhY2tQaWVjZXNJRCkge1xyXG5cdFx0XHRpZiAocGllY2VJRCA9PSBzZWxlY3RlZFBpZWNlKSB7XHJcblx0XHRcdFx0d2hpdGVQaWVjZSA9IGZhbHNlO1xyXG5cdFx0XHRcdHdoaWNoUGllY2UocGllY2VJRCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCByZXNpemVDYW52YXMpO1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHtcclxuXHRnYW1lQm9hcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHNlbGVjdFBpZWNlKTtcclxuXHRyZXNpemVDYW52YXMoKTtcclxufSk7XHJcbiJdfQ==
