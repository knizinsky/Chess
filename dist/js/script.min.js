"use strict";var gameBoard=document.getElementById("gameBoard"),ctx=gameBoard.getContext("2d"),brownColor="#653c10",whiteColor="#dfc795",windowWidth=window.innerWidth,windowHeight=window.innerHeight,gameBoardSize=Math.min(windowWidth,windowHeight,600),board=[["r","p","","","","","P","R"],["n","p","","","","","P","N"],["b","p","","","","","P","B"],["q","p","","","","","P","Q"],["k","p","","","","","P","K"],["b","p","","","","","P","B"],["n","p","","","","","P","N"],["r","p","","","","","P","R"]],pieceNames={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking",P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},whitePiecesID={P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},blackPiecesID={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking"},tileSize=gameBoardSize/8,selectedPiece=null,whitesMove=!0,drawPiece=function(e,i,o){var t=new Image;t.src="./dist/img/".concat(e,".png"),t.onload=function(){ctx.drawImage(t,i,o,tileSize,tileSize)}},drawBoardAndPieces=function(e){for(var i=0,o=0;i<e;i+=tileSize,o++)for(var t=0,a=0;t<e;t+=tileSize,a++){ctx.fillStyle=o%2==0?a%2==0?whiteColor:brownColor:a%2==0?brownColor:whiteColor;var n=board[o][a];""!=n&&drawPiece(pieceNames[n],i,t),ctx.fillRect(i,t,tileSize,tileSize)}},resizeCanvas=function(){gameBoard.width=gameBoardSize,gameBoard.height=gameBoardSize,drawBoardAndPieces(gameBoardSize)},selectPiece=function(e){var i=e.offsetX,e=e.offsetY,o=Math.floor(e/tileSize),t=Math.floor(i/tileSize),e=Math.floor(e/tileSize),i=Math.floor(i/tileSize);selectedPiece=board[t][o],movePiece(selectedPiece,e,i)},checkRules=function(e,i,o,t,a,n,r){"P"==e?6==t&&(i==t-1||i==t-2)&&a==o||i==t-1&&a==o||(a==o+1||a==o-1)&&""!=board[o][i]&&i<t?n():gameBoard.removeEventListener("click",r):"p"==e&&(1==t&&(i==t+1||i==t+2)&&a==o||i==t+1&&a==o||(a==o+1||a==o-1)&&""!=board[o][i]&&t<i?n():gameBoard.removeEventListener("click",r))},movePiece=function(e,c,d){function i(r){e==r&&board.forEach(function(e,i){e.forEach(function(n,e){n==r&&c==e&&d==i&&gameBoard.addEventListener("click",function e(i){var o=i.offsetX,i=i.offsetY,t=Math.floor(i/tileSize),a=Math.floor(o/tileSize);gameBoard.removeEventListener("click",e),checkRules(r,t,a,c,d,function(){board[a][t]=n,l=board[a][t],drawPiece(pieceNames[l],a*tileSize,t*tileSize),board[d][c]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove},e)})})})}var l;if(whitesMove)for(var o in whitePiecesID)o==e&&i(o);else for(var t in blackPiecesID)t==e&&i(t)};window.addEventListener("resize",resizeCanvas),window.addEventListener("load",function(){gameBoard.addEventListener("click",selectPiece),resizeCanvas()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJnYW1lQm9hcmQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY3R4IiwiZ2V0Q29udGV4dCIsImJyb3duQ29sb3IiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwid2hpdGVDb2xvciIsImlubmVySGVpZ2h0Iiwid2luZG93V2lkdGgiLCJ3aW5kb3dIZWlnaHQiLCJnYW1lQm9hcmRTaXplIiwiTWF0aCIsImJvYXJkIiwicGllY2VOYW1lcyIsInAiLCJyIiwibiIsImIiLCJxIiwiayIsIndoaXRlUGllY2VzSUQiLCJQIiwiUiIsIk4iLCJCIiwiUSIsIksiLCJ0aWxlU2l6ZSIsImRyYXdQaWVjZSIsImltZyIsInNlbGVjdGVkUGllY2UiLCJ3aGl0ZXNNb3ZlIiwicGllY2VOYW1lIiwieCIsInkiLCJmaWxsU3R5bGUiLCJzcmMiLCJjb25jYXQiLCJvbmxvYWQiLCJkcmF3SW1hZ2UiLCJkcmF3Qm9hcmRBbmRQaWVjZXMiLCJwaWVjZSIsImoiLCJpIiwibCIsIndpZHRoIiwiY2xpY2tlZFJvdyIsImZsb29yIiwiQ1IiLCJmaWxsUmVjdCIsImRyYXdQaWVjZU9uVGFyZ2V0IiwiY2xpY2tlZFJvd1RhcmdldCIsImNsaWNrZWRDb2xUYXJnZXQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJvZmZzZXRYIiwicGllY2VJRCIsImNsaWNrZWRDb2wiLCJDQyIsIm1vdmVQaWVjZSIsIm1vdmVkUGllY2UiLCJtYWtlTW92ZSIsImZvckVhY2giLCJhZGRFdmVudExpc3RlbmVyIiwid2hpY2hQaWVjZSIsIndoaXRlUGllY2UiLCJvZmZzZXRZIiwiY2hlY2tSdWxlcyIsImJsYWNrUGllY2VzSUQiLCJyZXNpemVDYW52YXMiLCJzZWxlY3RQaWVjZSJdLCJtYXBwaW5ncyI6ImFBQUEsSUFBTUEsVUFBWUMsU0FBU0MsZUFBZSxXQUFXLEVBQy9DQyxJQUFNSCxVQUFVSSxXQUFXLElBQUksRUFEL0JKLFdBQVlDLFVBQ1pFLFdBQWUs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RUFBa0JKLEVBQUlVLEVBbUI3Q1UsV0FFbEJILE1BQUFBLEdBQWtCZCxHQUFBTSxFQUVuQkcsRUFBQWhELE1BQUF3QyxHQUFBRCxHQUVGdkIsVUFDQWYsV0FBQStDLEdBRU1HLEVBQWlCcEMsU0FFakJvQyxFQUFpQnBDLFFBQVEsRUFHOUJmLE1BQUE4QyxHQUFBVixHQUFBLEdBeENPUixtQkFBbUI5QixhQUFhLEVBRWhDcUIsV0FBYSxDQUFDQSxVQUVoQixFQUdtRjhCLENBQVEsQ0FDNUYsQ0FDNEMsQ0FFOUMsQ0FBQyxDQUNGLENBQUMsQ0FFSCxDQTFDQSxJQUFJRCxFQThDSixHQUFJN0IsV0FDSCxJQUFLLElBQUl5QixLQUFXcEMsY0FDZm9DLEdBQVcxQixHQUVka0MsRUFBV1IsQ0FBTyxPQUlwQixJQUFLLElBQUlBLEtBQVdZLGNBQ2ZaLEdBQVcxQixHQUVka0MsRUFBV1IsQ0FBTyxDQUl0QixFQUVBcEQsT0FBTzJELGlCQUFpQixTQUFVTSxZQUFZLEVBRTlDakUsT0FBTzJELGlCQUFpQixPQUFRLFdBQy9CakUsVUFBVWlFLGlCQUFpQixRQUFTTyxXQUFXLEVBQy9DRCxhQUFZLENBQ2IsQ0FBQyIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZ2FtZUJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnYW1lQm9hcmRcIik7XHJcbmNvbnN0IGN0eCA9IGdhbWVCb2FyZC5nZXRDb250ZXh0KFwiMmRcIik7XHJcbmNvbnN0IGJyb3duQ29sb3IgPSBcIiM2NTNjMTBcIjtcclxuY29uc3Qgd2hpdGVDb2xvciA9IFwiI2RmYzc5NVwiO1xyXG5jb25zdCB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG5jb25zdCB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbmNvbnN0IGdhbWVCb2FyZFNpemUgPSBNYXRoLm1pbih3aW5kb3dXaWR0aCwgd2luZG93SGVpZ2h0LCA2MDApO1xyXG5jb25zdCBib2FyZCA9IFtcclxuXHRbXCJyXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJSXCJdLFxyXG5cdFtcIm5cIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIk5cIl0sXHJcblx0W1wiYlwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiQlwiXSxcclxuXHRbXCJxXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJRXCJdLFxyXG5cdFtcImtcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIktcIl0sXHJcblx0W1wiYlwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiQlwiXSxcclxuXHRbXCJuXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJOXCJdLFxyXG5cdFtcInJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIlJcIl0sXHJcbl07XHJcblxyXG5jb25zdCBwaWVjZU5hbWVzID0ge1xyXG5cdHA6IFwiQnBhd25cIixcclxuXHRyOiBcIkJyb29rXCIsXHJcblx0bjogXCJCa25pZ2h0XCIsXHJcblx0YjogXCJCYmlzaG9wXCIsXHJcblx0cTogXCJCcXVlZW5cIixcclxuXHRrOiBcIkJraW5nXCIsXHJcblxyXG5cdFA6IFwiV3Bhd25cIixcclxuXHRSOiBcIldyb29rXCIsXHJcblx0TjogXCJXa25pZ2h0XCIsXHJcblx0QjogXCJXYmlzaG9wXCIsXHJcblx0UTogXCJXcXVlZW5cIixcclxuXHRLOiBcIldraW5nXCIsXHJcbn07XHJcblxyXG5jb25zdCB3aGl0ZVBpZWNlc0lEID0ge1xyXG5cdFx0UDogXCJXcGF3blwiLFxyXG5cdFx0UjogXCJXcm9va1wiLFxyXG5cdFx0TjogXCJXa25pZ2h0XCIsXHJcblx0XHRCOiBcIldiaXNob3BcIixcclxuXHRcdFE6IFwiV3F1ZWVuXCIsXHJcblx0XHRLOiBcIldraW5nXCIsXHJcblx0fTtcclxuXHJcblx0Y29uc3QgYmxhY2tQaWVjZXNJRCA9IHtcclxuXHRcdHA6IFwiQnBhd25cIixcclxuXHRcdHI6IFwiQnJvb2tcIixcclxuXHRcdG46IFwiQmtuaWdodFwiLFxyXG5cdFx0YjogXCJCYmlzaG9wXCIsXHJcblx0XHRxOiBcIkJxdWVlblwiLFxyXG5cdFx0azogXCJCa2luZ1wiLFxyXG5cdH07XHJcblxyXG5sZXQgdGlsZVNpemUgPSBnYW1lQm9hcmRTaXplIC8gODtcclxubGV0IHNlbGVjdGVkUGllY2UgPSBudWxsO1xyXG5sZXQgd2hpdGVzTW92ZSA9IHRydWU7XHJcblxyXG5jb25zdCBkcmF3UGllY2UgPSAocGllY2VOYW1lLCB4LCB5KSA9PiB7XHJcblx0Y29uc3QgaW1nID0gbmV3IEltYWdlKCk7XHJcblx0aW1nLnNyYyA9IGAuL2Rpc3QvaW1nLyR7cGllY2VOYW1lfS5wbmdgO1xyXG5cclxuXHRpbWcub25sb2FkID0gKCkgPT4ge1xyXG5cdFx0Y3R4LmRyYXdJbWFnZShpbWcsIHgsIHksIHRpbGVTaXplLCB0aWxlU2l6ZSk7XHJcblx0fTtcclxufTtcclxuXHJcbmNvbnN0IGRyYXdCb2FyZEFuZFBpZWNlcyA9IChnYW1lQm9hcmRTaXplKSA9PiB7XHJcblx0Zm9yIChsZXQgaSA9IDAsIGogPSAwOyBpIDwgZ2FtZUJvYXJkU2l6ZTsgaSArPSB0aWxlU2l6ZSwgaisrKSB7XHJcblx0XHRmb3IgKGxldCBrID0gMCwgbCA9IDA7IGsgPCBnYW1lQm9hcmRTaXplOyBrICs9IHRpbGVTaXplLCBsKyspIHtcclxuXHRcdFx0aWYgKGogJSAyID09PSAwKSB7XHJcblx0XHRcdFx0aWYgKGwgJSAyID09PSAwKSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gd2hpdGVDb2xvcjtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IGJyb3duQ29sb3I7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGlmIChsICUgMiA9PT0gMCkge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IGJyb3duQ29sb3I7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSB3aGl0ZUNvbG9yO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Y29uc3QgcGllY2UgPSBib2FyZFtqXVtsXTtcclxuXHJcblx0XHRcdGlmIChwaWVjZSAhPSBcIlwiKSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlKHBpZWNlTmFtZXNbcGllY2VdLCBpLCBrKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Y3R4LmZpbGxSZWN0KGksIGssIHRpbGVTaXplLCB0aWxlU2l6ZSk7XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxuY29uc3QgcmVzaXplQ2FudmFzID0gKCkgPT4ge1xyXG5cdGdhbWVCb2FyZC53aWR0aCA9IGdhbWVCb2FyZFNpemU7XHJcblx0Z2FtZUJvYXJkLmhlaWdodCA9IGdhbWVCb2FyZFNpemU7XHJcblx0ZHJhd0JvYXJkQW5kUGllY2VzKGdhbWVCb2FyZFNpemUpO1xyXG59O1xyXG5cclxuY29uc3Qgc2VsZWN0UGllY2UgPSAoZXZlbnQpID0+IHtcclxuXHRsZXQgeCA9IGV2ZW50Lm9mZnNldFg7XHJcblx0bGV0IHkgPSBldmVudC5vZmZzZXRZO1xyXG5cclxuXHRjb25zdCBjbGlja2VkUm93ID0gTWF0aC5mbG9vcih5IC8gdGlsZVNpemUpO1xyXG5cdGNvbnN0IGNsaWNrZWRDb2wgPSBNYXRoLmZsb29yKHggLyB0aWxlU2l6ZSk7XHJcblxyXG5cdGNvbnN0IENSID0gTWF0aC5mbG9vcih5IC8gdGlsZVNpemUpO1xyXG5cdGNvbnN0IENDID0gTWF0aC5mbG9vcih4IC8gdGlsZVNpemUpO1xyXG5cclxuXHRzZWxlY3RlZFBpZWNlID0gYm9hcmRbY2xpY2tlZENvbF1bY2xpY2tlZFJvd107XHJcblxyXG5cdG1vdmVQaWVjZShzZWxlY3RlZFBpZWNlLCBDUiwgQ0MpO1xyXG59O1xyXG5cclxuY29uc3QgY2hlY2tSdWxlcyA9IChwaWVjZUlELCBjbGlja2VkUm93VGFyZ2V0LCBjbGlja2VkQ29sVGFyZ2V0LCBDUiwgQ0MsIGRyYXdQaWVjZU9uVGFyZ2V0LCBtYWtlTW92ZSkgPT4ge1xyXG5cdC8vIFBhd25zXHJcblx0aWYocGllY2VJRCA9PSBcIlBcIil7XHJcblx0XHRpZihDUiA9PSA2ICYmIChjbGlja2VkUm93VGFyZ2V0ID09IENSLTEgfHwgY2xpY2tlZFJvd1RhcmdldCA9PUNSLTIpICYmIENDID09IGNsaWNrZWRDb2xUYXJnZXQpe1xyXG5cdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0fWVsc2UgaWYoY2xpY2tlZFJvd1RhcmdldCA9PSBDUi0xICYmIENDID09IGNsaWNrZWRDb2xUYXJnZXQpe1xyXG5cdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0fWVsc2UgaWYoKENDID09IChjbGlja2VkQ29sVGFyZ2V0KzEpIHx8IENDID09IChjbGlja2VkQ29sVGFyZ2V0LTEpKSAmJiAoYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gIT0gXCJcIikgJiYgY2xpY2tlZFJvd1RhcmdldCA8IENSKXtcclxuXHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdH1lbHNle1xyXG5cdFx0XHRnYW1lQm9hcmQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG1ha2VNb3ZlKTtcclxuXHRcdH1cclxuXHR9ZWxzZSBpZihwaWVjZUlEID09IFwicFwiKXtcclxuXHRcdGlmKENSID09IDEgJiYgKGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IrMSB8fCBjbGlja2VkUm93VGFyZ2V0ID09Q1IrMikgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCl7XHJcblx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHR9ZWxzZSBpZihjbGlja2VkUm93VGFyZ2V0ID09IENSKzEgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCl7XHJcblx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHR9ZWxzZSBpZigoQ0MgPT0gKGNsaWNrZWRDb2xUYXJnZXQrMSkgfHwgQ0MgPT0gKGNsaWNrZWRDb2xUYXJnZXQtMSkpICYmIChib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSAhPSBcIlwiKSAmJiBjbGlja2VkUm93VGFyZ2V0ID4gQ1Ipe1xyXG5cdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0fWVsc2V7XHJcblx0XHRcdGdhbWVCb2FyZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuY29uc3QgbW92ZVBpZWNlID0gKHNlbGVjdGVkUGllY2UsIENSLCBDQykgPT4ge1xyXG5cdGxldCBtb3ZlZFBpZWNlO1xyXG5cclxuXHRjb25zdCB3aGljaFBpZWNlID0gKHBpZWNlSUQpID0+IHtcclxuXHRcdGlmIChzZWxlY3RlZFBpZWNlID09IHBpZWNlSUQpIHtcclxuXHRcdFx0Ym9hcmQuZm9yRWFjaCgoY2xpY2tlZFJvdywgaSkgPT4ge1xyXG5cdFx0XHRcdGNsaWNrZWRSb3cuZm9yRWFjaCgoY2xpY2tlZENvbCwgaikgPT4ge1xyXG5cdFx0XHRcdFx0aWYgKGNsaWNrZWRDb2wgPT0gcGllY2VJRCAmJiBDUiA9PSBqICYmIENDID09IGkpIHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgbWFrZU1vdmUgPSAoZXZlbnQpID0+IHtcclxuXHRcdFx0XHRcdFx0XHRsZXQgeCA9IGV2ZW50Lm9mZnNldFg7XHJcblx0XHRcdFx0XHRcdFx0bGV0IHkgPSBldmVudC5vZmZzZXRZO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRjb25zdCBjbGlja2VkUm93VGFyZ2V0ID0gTWF0aC5mbG9vcih5IC8gdGlsZVNpemUpO1xyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGNsaWNrZWRDb2xUYXJnZXQgPSBNYXRoLmZsb29yKHggLyB0aWxlU2l6ZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGRyYXdQaWVjZU9uVGFyZ2V0ID0gKCkgPT4ge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gaWYgKGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdID09IFwiXCIgfHwgd2hpdGVQaWVjZSA9PSB0cnVlIHx8IHdoaXRlUGllY2UgPT0gZmFsc2UpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ym9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gPSBjbGlja2VkQ29sO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0bW92ZWRQaWVjZSA9IGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdO1xyXG5cdFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRkcmF3UGllY2UoXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0cGllY2VOYW1lc1ttb3ZlZFBpZWNlXSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjbGlja2VkQ29sVGFyZ2V0ICogdGlsZVNpemUsXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2xpY2tlZFJvd1RhcmdldCAqIHRpbGVTaXplXHJcblx0XHRcdFx0XHRcdFx0XHRcdCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRib2FyZFtDQ11bQ1JdID0gXCJcIjtcclxuXHRcclxuXHRcdFx0XHRcdFx0XHRcdFx0ZHJhd0JvYXJkQW5kUGllY2VzKGdhbWVCb2FyZFNpemUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHRcdFx0d2hpdGVzTW92ZSA9ICF3aGl0ZXNNb3ZlO1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gfVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0Z2FtZUJvYXJkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHRcdFx0XHRcdFx0Y2hlY2tSdWxlcyhwaWVjZUlELCBjbGlja2VkUm93VGFyZ2V0LCBjbGlja2VkQ29sVGFyZ2V0LCBDUiwgQ0MsIGRyYXdQaWVjZU9uVGFyZ2V0LCBtYWtlTW92ZSlcclxuXHRcdFx0XHRcdFx0fTtcclxuXHRcdFx0XHRcdFx0Z2FtZUJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGxldCB3aGl0ZVBpZWNlO1xyXG5cclxuXHRpZiAod2hpdGVzTW92ZSkge1xyXG5cdFx0Zm9yIChsZXQgcGllY2VJRCBpbiB3aGl0ZVBpZWNlc0lEKSB7XHJcblx0XHRcdGlmIChwaWVjZUlEID09IHNlbGVjdGVkUGllY2UpIHtcclxuXHRcdFx0XHR3aGl0ZVBpZWNlID0gdHJ1ZTtcclxuXHRcdFx0XHR3aGljaFBpZWNlKHBpZWNlSUQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSBlbHNlIHtcclxuXHRcdGZvciAobGV0IHBpZWNlSUQgaW4gYmxhY2tQaWVjZXNJRCkge1xyXG5cdFx0XHRpZiAocGllY2VJRCA9PSBzZWxlY3RlZFBpZWNlKSB7XHJcblx0XHRcdFx0d2hpdGVQaWVjZSA9IGZhbHNlO1xyXG5cdFx0XHRcdHdoaWNoUGllY2UocGllY2VJRCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCByZXNpemVDYW52YXMpO1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHtcclxuXHRnYW1lQm9hcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHNlbGVjdFBpZWNlKTtcclxuXHRyZXNpemVDYW52YXMoKTtcclxufSk7XHJcbiJdfQ==
