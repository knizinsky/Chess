"use strict";var gameBoard=document.getElementById("gameBoard"),ctx=gameBoard.getContext("2d"),brownColor="#653c10",whiteColor="#dfc795",windowWidth=window.innerWidth,windowHeight=window.innerHeight,gameBoardSize=Math.min(windowWidth,windowHeight,600),board=[["r","p","","","","","P","R"],["n","p","","","","","P","N"],["b","p","","","","","P","B"],["q","p","","","","","P","Q"],["k","p","","","","","P","K"],["b","p","","","","","P","B"],["n","p","","","","","P","N"],["r","p","","","","","P","R"]],pieceNames={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking",P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},whitePiecesID={P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},blackPiecesID={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking"},tileSize=gameBoardSize/8,selectedPiece=null,whitesMove=!0,drawPiece=function(e,i,o){var a=new Image;a.src="./dist/img/".concat(e,".png"),a.onload=function(){ctx.drawImage(a,i,o,tileSize,tileSize)}},drawBoardAndPieces=function(e){for(var i=0,o=0;i<e;i+=tileSize,o++)for(var a=0,t=0;a<e;a+=tileSize,t++){ctx.fillStyle=o%2==0?t%2==0?whiteColor:brownColor:t%2==0?brownColor:whiteColor;var n=board[o][t];""!=n&&drawPiece(pieceNames[n],i,a),ctx.fillRect(i,a,tileSize,tileSize)}},resizeCanvas=function(){gameBoard.width=gameBoardSize,gameBoard.height=gameBoardSize,drawBoardAndPieces(gameBoardSize)},selectPiece=function(e){var i=e.offsetX,e=e.offsetY,o=Math.floor(e/tileSize),a=Math.floor(i/tileSize),e=Math.floor(e/tileSize),i=Math.floor(i/tileSize);selectedPiece=board[a][o],movePiece(selectedPiece,e,i)},movePiece=function(e,s,w){function i(l){e==l&&board.forEach(function(e,c){e.forEach(function(r,d){r==l&&s==d&&w==c&&gameBoard.addEventListener("click",function e(i){function o(){board[n][t]=r,f=board[n][t],drawPiece(pieceNames[f],n*tileSize,t*tileSize),board[w][s]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove}var a=i.offsetX,i=i.offsetY,t=Math.floor(i/tileSize),n=Math.floor(a/tileSize);gameBoard.removeEventListener("click",e),console.log(r,t,w,s,c,d),"P"==l?6==s&&(t==s-1||t==s-2)&&w==n||t==s-1&&w==n||(w==n+1||w==n-1)&&""!=board[n][t]&&t<s?o():gameBoard.removeEventListener("click",e):"p"==l&&(1==s&&(t==s+1||t==s+2)&&w==n||t==s+1&&w==n||(w==n+1||w==n-1)&&""!=board[n][t])&&o()})})})}var f;if(whitesMove)for(var o in whitePiecesID)o==e&&i(o);else for(var a in blackPiecesID)a==e&&i(a)};window.addEventListener("resize",resizeCanvas),window.addEventListener("load",function(){gameBoard.addEventListener("click",selectPiece),resizeCanvas()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJnYW1lQm9hcmQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY3R4IiwiZ2V0Q29udGV4dCIsImJyb3duQ29sb3IiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwid2hpdGVDb2xvciIsImlubmVySGVpZ2h0Iiwid2luZG93V2lkdGgiLCJ3aW5kb3dIZWlnaHQiLCJnYW1lQm9hcmRTaXplIiwiTWF0aCIsImJvYXJkIiwicGllY2VOYW1lcyIsInAiLCJyIiwibiIsImIiLCJxIiwiayIsIndoaXRlUGllY2VzSUQiLCJQIiwiUiIsIk4iLCJCIiwiUSIsIksiLCJ0aWxlU2l6ZSIsImRyYXdQaWVjZSIsImltZyIsInNlbGVjdGVkUGllY2UiLCJ3aGl0ZXNNb3ZlIiwicGllY2VOYW1lIiwieCIsInkiLCJmaWxsU3R5bGUiLCJzcmMiLCJjb25jYXQiLCJvbmxvYWQiLCJkcmF3SW1hZ2UiLCJkcmF3Qm9hcmRBbmRQaWVjZXMiLCJwaWVjZSIsImoiLCJpIiwibCIsIndpZHRoIiwiY2xpY2tlZFJvdyIsImZsb29yIiwiQ1IiLCJmaWxsUmVjdCIsImZvckVhY2giLCJoZWlnaHQiLCJjbGlja2VkQ29sIiwibWFrZU1vdmUiLCJzZWxlY3RQaWVjZSIsImNsaWNrZWRSb3dUYXJnZXQiLCJldmVudCIsIm9mZnNldFgiLCJvZmZzZXRZIiwiY2xpY2tlZENvbFRhcmdldCIsIm1vdmVkUGllY2UiLCJDQyIsIm1vdmVQaWVjZSIsIndoaWNoUGllY2UiLCJwaWVjZUlEIiwiZHJhd1BpZWNlT25UYXJnZXQiLCJhZGRFdmVudExpc3RlbmVyIiwid2hpdGVQaWVjZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjb25zb2xlIiwibG9nIiwicmVzaXplQ2FudmFzIiwiYmxhY2tQaWVjZXNJRCJdLCJtYXBwaW5ncyI6ImFBQUEsSUFBTUEsVUFBWUMsU0FBU0MsZUFBZSxXQUFXLEVBQy9DQyxJQUFNSCxVQUFVSSxXQUFXLElBQUksRUFEL0JKLFdBQVlD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LEdBQUFPLEdBQUFQLEVBQUEsSUFBQWEsR0FBQUYsR0F6Q0dKLEdBQW9CUCxFQUFHLEdBQUthLEdBQU1GLElBRWpDRSxHQUFPRixFQUFpQixHQUFNRSxHQUFPRixFQUFpQixJQUFvRCxJQUE3Qy9DLE1BQU0rQyxHQUFrQkosS0F3Q3RHVSxFQUFBLENBaENJLENBQzRDLENBRTlDLENBQUMsQ0FDRixDQUFDLENBRUgsQ0FwRUEsSUFBSUwsRUF3RUosR0FBSTdCLFdBQ0gsSUFBSyxJQUFJaUMsS0FBVzVDLGNBQ2Y0QyxHQUFXbEMsR0FFZGlDLEVBQVdDLENBQU8sT0FJcEIsSUFBSyxJQUFJQSxLQUFXUSxjQUNmUixHQUFXbEMsR0FFZGlDLEVBQVdDLENBQU8sQ0FJdEIsRUFFQTVELE9BQU84RCxpQkFBaUIsU0FBVUssWUFBWSxFQUU5Q25FLE9BQU84RCxpQkFBaUIsT0FBUSxXQUMvQnBFLFVBQVVvRSxpQkFBaUIsUUFBU1osV0FBVyxFQUMvQ2lCLGFBQVksQ0FDYixDQUFDIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBnYW1lQm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbWVCb2FyZFwiKTtcclxuY29uc3QgY3R4ID0gZ2FtZUJvYXJkLmdldENvbnRleHQoXCIyZFwiKTtcclxuY29uc3QgYnJvd25Db2xvciA9IFwiIzY1M2MxMFwiO1xyXG5jb25zdCB3aGl0ZUNvbG9yID0gXCIjZGZjNzk1XCI7XHJcbmNvbnN0IHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbmNvbnN0IHdpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuY29uc3QgZ2FtZUJvYXJkU2l6ZSA9IE1hdGgubWluKHdpbmRvd1dpZHRoLCB3aW5kb3dIZWlnaHQsIDYwMCk7XHJcbmNvbnN0IGJvYXJkID0gW1xyXG5cdFtcInJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIlJcIl0sXHJcblx0W1wiblwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiTlwiXSxcclxuXHRbXCJiXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJCXCJdLFxyXG5cdFtcInFcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIlFcIl0sXHJcblx0W1wia1wiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiS1wiXSxcclxuXHRbXCJiXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJCXCJdLFxyXG5cdFtcIm5cIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIk5cIl0sXHJcblx0W1wiclwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiUlwiXSxcclxuXTtcclxuXHJcbmNvbnN0IHBpZWNlTmFtZXMgPSB7XHJcblx0cDogXCJCcGF3blwiLFxyXG5cdHI6IFwiQnJvb2tcIixcclxuXHRuOiBcIkJrbmlnaHRcIixcclxuXHRiOiBcIkJiaXNob3BcIixcclxuXHRxOiBcIkJxdWVlblwiLFxyXG5cdGs6IFwiQmtpbmdcIixcclxuXHJcblx0UDogXCJXcGF3blwiLFxyXG5cdFI6IFwiV3Jvb2tcIixcclxuXHROOiBcIldrbmlnaHRcIixcclxuXHRCOiBcIldiaXNob3BcIixcclxuXHRROiBcIldxdWVlblwiLFxyXG5cdEs6IFwiV2tpbmdcIixcclxufTtcclxuXHJcbmNvbnN0IHdoaXRlUGllY2VzSUQgPSB7XHJcblx0XHRQOiBcIldwYXduXCIsXHJcblx0XHRSOiBcIldyb29rXCIsXHJcblx0XHROOiBcIldrbmlnaHRcIixcclxuXHRcdEI6IFwiV2Jpc2hvcFwiLFxyXG5cdFx0UTogXCJXcXVlZW5cIixcclxuXHRcdEs6IFwiV2tpbmdcIixcclxuXHR9O1xyXG5cclxuXHRjb25zdCBibGFja1BpZWNlc0lEID0ge1xyXG5cdFx0cDogXCJCcGF3blwiLFxyXG5cdFx0cjogXCJCcm9va1wiLFxyXG5cdFx0bjogXCJCa25pZ2h0XCIsXHJcblx0XHRiOiBcIkJiaXNob3BcIixcclxuXHRcdHE6IFwiQnF1ZWVuXCIsXHJcblx0XHRrOiBcIkJraW5nXCIsXHJcblx0fTtcclxuXHJcbmxldCB0aWxlU2l6ZSA9IGdhbWVCb2FyZFNpemUgLyA4O1xyXG5sZXQgc2VsZWN0ZWRQaWVjZSA9IG51bGw7XHJcbmxldCB3aGl0ZXNNb3ZlID0gdHJ1ZTtcclxuXHJcbmNvbnN0IGRyYXdQaWVjZSA9IChwaWVjZU5hbWUsIHgsIHkpID0+IHtcclxuXHRjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHRpbWcuc3JjID0gYC4vZGlzdC9pbWcvJHtwaWVjZU5hbWV9LnBuZ2A7XHJcblxyXG5cdGltZy5vbmxvYWQgPSAoKSA9PiB7XHJcblx0XHRjdHguZHJhd0ltYWdlKGltZywgeCwgeSwgdGlsZVNpemUsIHRpbGVTaXplKTtcclxuXHR9O1xyXG59O1xyXG5cclxuY29uc3QgZHJhd0JvYXJkQW5kUGllY2VzID0gKGdhbWVCb2FyZFNpemUpID0+IHtcclxuXHRmb3IgKGxldCBpID0gMCwgaiA9IDA7IGkgPCBnYW1lQm9hcmRTaXplOyBpICs9IHRpbGVTaXplLCBqKyspIHtcclxuXHRcdGZvciAobGV0IGsgPSAwLCBsID0gMDsgayA8IGdhbWVCb2FyZFNpemU7IGsgKz0gdGlsZVNpemUsIGwrKykge1xyXG5cdFx0XHRpZiAoaiAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRpZiAobCAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSB3aGl0ZUNvbG9yO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gYnJvd25Db2xvcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0aWYgKGwgJSAyID09PSAwKSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gYnJvd25Db2xvcjtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IHdoaXRlQ29sb3I7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjb25zdCBwaWVjZSA9IGJvYXJkW2pdW2xdO1xyXG5cclxuXHRcdFx0aWYgKHBpZWNlICE9IFwiXCIpIHtcclxuXHRcdFx0XHRkcmF3UGllY2UocGllY2VOYW1lc1twaWVjZV0sIGksIGspO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjdHguZmlsbFJlY3QoaSwgaywgdGlsZVNpemUsIHRpbGVTaXplKTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5jb25zdCByZXNpemVDYW52YXMgPSAoKSA9PiB7XHJcblx0Z2FtZUJvYXJkLndpZHRoID0gZ2FtZUJvYXJkU2l6ZTtcclxuXHRnYW1lQm9hcmQuaGVpZ2h0ID0gZ2FtZUJvYXJkU2l6ZTtcclxuXHRkcmF3Qm9hcmRBbmRQaWVjZXMoZ2FtZUJvYXJkU2l6ZSk7XHJcbn07XHJcblxyXG5jb25zdCBzZWxlY3RQaWVjZSA9IChldmVudCkgPT4ge1xyXG5cdGxldCB4ID0gZXZlbnQub2Zmc2V0WDtcclxuXHRsZXQgeSA9IGV2ZW50Lm9mZnNldFk7XHJcblxyXG5cdGNvbnN0IGNsaWNrZWRSb3cgPSBNYXRoLmZsb29yKHkgLyB0aWxlU2l6ZSk7XHJcblx0Y29uc3QgY2xpY2tlZENvbCA9IE1hdGguZmxvb3IoeCAvIHRpbGVTaXplKTtcclxuXHJcblx0Y29uc3QgQ1IgPSBNYXRoLmZsb29yKHkgLyB0aWxlU2l6ZSk7XHJcblx0Y29uc3QgQ0MgPSBNYXRoLmZsb29yKHggLyB0aWxlU2l6ZSk7XHJcblxyXG5cdHNlbGVjdGVkUGllY2UgPSBib2FyZFtjbGlja2VkQ29sXVtjbGlja2VkUm93XTtcclxuXHJcblx0bW92ZVBpZWNlKHNlbGVjdGVkUGllY2UsIENSLCBDQyk7XHJcbn07XHJcblxyXG5jb25zdCBtb3ZlUGllY2UgPSAoc2VsZWN0ZWRQaWVjZSwgQ1IsIENDKSA9PiB7XHJcblx0bGV0IG1vdmVkUGllY2U7XHJcblxyXG5cdGNvbnN0IHdoaWNoUGllY2UgPSAocGllY2VJRCkgPT4ge1xyXG5cdFx0aWYgKHNlbGVjdGVkUGllY2UgPT0gcGllY2VJRCkge1xyXG5cdFx0XHRib2FyZC5mb3JFYWNoKChjbGlja2VkUm93LCBpKSA9PiB7XHJcblx0XHRcdFx0Y2xpY2tlZFJvdy5mb3JFYWNoKChjbGlja2VkQ29sLCBqKSA9PiB7XHJcblx0XHRcdFx0XHRpZiAoY2xpY2tlZENvbCA9PSBwaWVjZUlEICYmIENSID09IGogJiYgQ0MgPT0gaSkge1xyXG5cdFx0XHRcdFx0XHRjb25zdCBtYWtlTW92ZSA9IChldmVudCkgPT4ge1xyXG5cdFx0XHRcdFx0XHRcdGxldCB4ID0gZXZlbnQub2Zmc2V0WDtcclxuXHRcdFx0XHRcdFx0XHRsZXQgeSA9IGV2ZW50Lm9mZnNldFk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGNsaWNrZWRSb3dUYXJnZXQgPSBNYXRoLmZsb29yKHkgLyB0aWxlU2l6ZSk7XHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgY2xpY2tlZENvbFRhcmdldCA9IE1hdGguZmxvb3IoeCAvIHRpbGVTaXplKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgZHJhd1BpZWNlT25UYXJnZXQgPSAoKSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0XHQvLyBpZiAoYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gPT0gXCJcIiB8fCB3aGl0ZVBpZWNlID09IHRydWUgfHwgd2hpdGVQaWVjZSA9PSBmYWxzZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSA9IGNsaWNrZWRDb2w7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRtb3ZlZFBpZWNlID0gYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF07XHJcblx0XHJcblx0XHRcdFx0XHRcdFx0XHRcdGRyYXdQaWVjZShcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwaWVjZU5hbWVzW21vdmVkUGllY2VdLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNsaWNrZWRDb2xUYXJnZXQgKiB0aWxlU2l6ZSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjbGlja2VkUm93VGFyZ2V0ICogdGlsZVNpemVcclxuXHRcdFx0XHRcdFx0XHRcdFx0KTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdGJvYXJkW0NDXVtDUl0gPSBcIlwiO1xyXG5cdFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRkcmF3Qm9hcmRBbmRQaWVjZXMoZ2FtZUJvYXJkU2l6ZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdFx0XHR3aGl0ZXNNb3ZlID0gIXdoaXRlc01vdmU7XHJcblx0XHRcdFx0XHRcdFx0XHQvLyB9XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHRjb25zdCBjaGVja1J1bGVzID0gKCkgPT4ge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhjbGlja2VkQ29sLCBjbGlja2VkUm93VGFyZ2V0LCBDQywgQ1IsIGksIGopO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdC8vIFBhd25zXHJcblx0XHRcdFx0XHRcdFx0XHRpZihwaWVjZUlEID09IFwiUFwiKXtcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYoQ1IgPT0gNiAmJiAoY2xpY2tlZFJvd1RhcmdldCA9PSBDUi0xIHx8IGNsaWNrZWRSb3dUYXJnZXQgPT1DUi0yKSAmJiBDQyA9PSBjbGlja2VkQ29sVGFyZ2V0KXtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9ZWxzZSBpZihjbGlja2VkUm93VGFyZ2V0ID09IENSLTEgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCl7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fWVsc2UgaWYoKENDID09IChjbGlja2VkQ29sVGFyZ2V0KzEpIHx8IENDID09IChjbGlja2VkQ29sVGFyZ2V0LTEpKSAmJiAoYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gIT0gXCJcIikgJiYgY2xpY2tlZFJvd1RhcmdldCA8IENSKXtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9ZWxzZXtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRnYW1lQm9hcmQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG1ha2VNb3ZlKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0fWVsc2UgaWYocGllY2VJRCA9PSBcInBcIil7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmKENSID09IDEgJiYgKGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IrMSB8fCBjbGlja2VkUm93VGFyZ2V0ID09Q1IrMikgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCl7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fWVsc2UgaWYoY2xpY2tlZFJvd1RhcmdldCA9PSBDUisxICYmIENDID09IGNsaWNrZWRDb2xUYXJnZXQpe1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH1lbHNlIGlmKChDQyA9PSAoY2xpY2tlZENvbFRhcmdldCsxKSB8fCBDQyA9PSAoY2xpY2tlZENvbFRhcmdldC0xKSkgJiYgYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gIT0gXCJcIil7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0Z2FtZUJvYXJkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHRcdFx0XHRcdFx0Y2hlY2tSdWxlcygpXHJcblx0XHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHRcdGdhbWVCb2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRsZXQgd2hpdGVQaWVjZTtcclxuXHJcblx0aWYgKHdoaXRlc01vdmUpIHtcclxuXHRcdGZvciAobGV0IHBpZWNlSUQgaW4gd2hpdGVQaWVjZXNJRCkge1xyXG5cdFx0XHRpZiAocGllY2VJRCA9PSBzZWxlY3RlZFBpZWNlKSB7XHJcblx0XHRcdFx0d2hpdGVQaWVjZSA9IHRydWU7XHJcblx0XHRcdFx0d2hpY2hQaWVjZShwaWVjZUlEKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0gZWxzZSB7XHJcblx0XHRmb3IgKGxldCBwaWVjZUlEIGluIGJsYWNrUGllY2VzSUQpIHtcclxuXHRcdFx0aWYgKHBpZWNlSUQgPT0gc2VsZWN0ZWRQaWVjZSkge1xyXG5cdFx0XHRcdHdoaXRlUGllY2UgPSBmYWxzZTtcclxuXHRcdFx0XHR3aGljaFBpZWNlKHBpZWNlSUQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgcmVzaXplQ2FudmFzKTtcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiB7XHJcblx0Z2FtZUJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzZWxlY3RQaWVjZSk7XHJcblx0cmVzaXplQ2FudmFzKCk7XHJcbn0pO1xyXG4iXX0=
