"use strict";var gameBoard=document.getElementById("gameBoard"),ctx=gameBoard.getContext("2d"),brownColor="#653c10",whiteColor="#dfc795",windowWidth=window.innerWidth,windowHeight=window.innerHeight,gameBoardSize=Math.min(windowWidth,windowHeight,600),board=[["r","p","","","","","P","R"],["n","p","","","","","P","N"],["b","p","","","","","P","B"],["q","p","","","","","P","Q"],["k","p","","","","","P","K"],["b","p","","","","","P","B"],["n","p","","","","","P","N"],["r","p","","","","","P","R"]],pieceNames={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking",P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},whitePiecesID={P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},blackPiecesID={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking"},tileSize=gameBoardSize/8,selectedPiece=null,whitesMove=!0,drawPiece=function(e,i,o){var a=new Image;a.src="./dist/img/".concat(e,".png"),a.onload=function(){ctx.drawImage(a,i,o,tileSize,tileSize)}},drawBoardAndPieces=function(e){for(var i=0,o=0;i<e;i+=tileSize,o++)for(var a=0,t=0;a<e;a+=tileSize,t++){ctx.fillStyle=o%2==0?t%2==0?whiteColor:brownColor:t%2==0?brownColor:whiteColor;var r=board[o][t];""!=r&&drawPiece(pieceNames[r],i,a),ctx.fillRect(i,a,tileSize,tileSize)}},resizeCanvas=function(){gameBoard.width=gameBoardSize,gameBoard.height=gameBoardSize,drawBoardAndPieces(gameBoardSize)},selectPiece=function(e){var i=e.offsetX,e=e.offsetY,o=Math.floor(e/tileSize),a=Math.floor(i/tileSize),e=Math.floor(e/tileSize),i=Math.floor(i/tileSize);selectedPiece=board[a][o],movePiece(selectedPiece,e,i)},checkRules=function(e,i,o,a,t,r,n){var c=Math.abs(a-i),d=Math.abs(t-o);"P"==e?6==a&&(i==a-1||i==a-2)&&t==o||i==a-1&&t==o||(t==o+1||t==o-1)&&""!=board[o][i]&&i<a?r():gameBoard.removeEventListener("click",n):"p"==e?1==a&&(i==a+1||i==a+2)&&t==o||i==a+1&&t==o||(t==o+1||t==o-1)&&""!=board[o][i]&&a<i?r():gameBoard.removeEventListener("click",n):"B"==e||"b"==e?d==c&&r():"N"==e||"n"==e?(1==c&&2==d||2==c&&1==d)&&r():"R"==e||"r"==e?0!=c&&0!=d||r():"K"==e||"k"==e?(0<=c||0<=d)&&c<=1&&d<=1&&r():"Q"!=e&&"q"!=e||0!=c&&0!=d&&d!=c||r()},movePiece=function(e,c,d){function i(n){e==n&&board.forEach(function(e,i){e.forEach(function(r,e){r==n&&c==e&&d==i&&gameBoard.addEventListener("click",function e(i){var o=i.offsetX,i=i.offsetY,a=Math.floor(i/tileSize),t=Math.floor(o/tileSize);gameBoard.removeEventListener("click",e),checkRules(n,a,t,c,d,function(){board[t][a]=r,l=board[t][a],drawPiece(pieceNames[l],t*tileSize,a*tileSize),board[d][c]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove},e)})})})}var l;if(whitesMove)for(var o in whitePiecesID)o==e&&i(o);else for(var a in blackPiecesID)a==e&&i(a)};window.addEventListener("resize",resizeCanvas),window.addEventListener("load",function(){gameBoard.addEventListener("click",selectPiece),resizeCanvas()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJnYW1lQm9hcmQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY3R4IiwiZ2V0Q29udGV4dCIsImJyb3duQ29sb3IiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwid2hpdGVDb2xvciIsImlubmVySGVpZ2h0Iiwid2luZG93V2lkdGgiLCJ3aW5kb3dIZWlnaHQiLCJnYW1lQm9hcmRTaXplIiwiTWF0aCIsImJvYXJkIiwicGllY2VOYW1lcyIsInAiLCJyIiwibiIsImIiLCJxIiwiayIsIndoaXRlUGllY2VzSUQiLCJQIiwiUiIsIk4iLCJCIiwiUSIsIksiLCJ0aWxlU2l6ZSIsImRyYXdQaWVjZSIsImltZyIsInNlbGVjdGVkUGllY2UiLCJ3aGl0ZXNNb3ZlIiwicGllY2VOYW1lIiwieCIsInkiLCJmaWxsU3R5bGUiLCJzcmMiLCJjb25jYXQiLCJvbmxvYWQiLCJkcmF3SW1hZ2UiLCJkcmF3Qm9hcmRBbmRQaWVjZXMiLCJwaWVjZSIsImoiLCJpIiwibCIsIndpZHRoIiwiY2xpY2tlZFJvdyIsImZsb29yIiwiQ1IiLCJmaWxsUmVjdCIsInJlc2l6ZUNhbnZhcyIsInBpZWNlSUQiLCJoZWlnaHQiLCJjbGlja2VkUm93VGFyZ2V0IiwiZHJhd1BpZWNlT25UYXJnZXQiLCJzZWxlY3RQaWVjZSIsImV2ZW50Iiwib2Zmc2V0WSIsImNsaWNrZWRDb2wiLCJDQyIsImNsaWNrZWRDb2xUYXJnZXQiLCJtb3ZlUGllY2UiLCJjaGVja1J1bGVzIiwibWFrZU1vdmUiLCJyb3dEaWZmZXJlbmNlIiwiYWJzIiwiY29sRGlmZmVyZW5jZSIsIndoaWNoUGllY2UiLCJhZGRFdmVudExpc3RlbmVyIiwiZm9yRWFjaCIsIndoaXRlUGllY2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYmxhY2tQaWVjZXNJRCIsIm1vdmVkUGllY2UiXSwibWFwcGluZ3MiOiJhQUFBLElBQU1BLFVBQVlDLFNBQVNDLGVBQWUsV0FBVyxFQUMvQ0MsSUFBTUgsVUFB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LE9BQU9nRSxpQkFBaUIsT0FBUSxXQUMvQnRFLFVBQVVzRSxpQkFBaUIsUUFBU2IsV0FBVyxFQUMvQ0wsYUFBWSxDQUNiLENBQUMiLCJmaWxlIjoic2NyaXB0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGdhbWVCb2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZ2FtZUJvYXJkXCIpO1xyXG5jb25zdCBjdHggPSBnYW1lQm9hcmQuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG5jb25zdCBicm93bkNvbG9yID0gXCIjNjUzYzEwXCI7XHJcbmNvbnN0IHdoaXRlQ29sb3IgPSBcIiNkZmM3OTVcIjtcclxuY29uc3Qgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuY29uc3Qgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5jb25zdCBnYW1lQm9hcmRTaXplID0gTWF0aC5taW4od2luZG93V2lkdGgsIHdpbmRvd0hlaWdodCwgNjAwKTtcclxuY29uc3QgYm9hcmQgPSBbXHJcblx0W1wiclwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiUlwiXSxcclxuXHRbXCJuXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJOXCJdLFxyXG5cdFtcImJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIkJcIl0sXHJcblx0W1wicVwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiUVwiXSxcclxuXHRbXCJrXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJLXCJdLFxyXG5cdFtcImJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIkJcIl0sXHJcblx0W1wiblwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiTlwiXSxcclxuXHRbXCJyXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJSXCJdLFxyXG5dO1xyXG5cclxuY29uc3QgcGllY2VOYW1lcyA9IHtcclxuXHRwOiBcIkJwYXduXCIsXHJcblx0cjogXCJCcm9va1wiLFxyXG5cdG46IFwiQmtuaWdodFwiLFxyXG5cdGI6IFwiQmJpc2hvcFwiLFxyXG5cdHE6IFwiQnF1ZWVuXCIsXHJcblx0azogXCJCa2luZ1wiLFxyXG5cclxuXHRQOiBcIldwYXduXCIsXHJcblx0UjogXCJXcm9va1wiLFxyXG5cdE46IFwiV2tuaWdodFwiLFxyXG5cdEI6IFwiV2Jpc2hvcFwiLFxyXG5cdFE6IFwiV3F1ZWVuXCIsXHJcblx0SzogXCJXa2luZ1wiLFxyXG59O1xyXG5cclxuY29uc3Qgd2hpdGVQaWVjZXNJRCA9IHtcclxuXHRcdFA6IFwiV3Bhd25cIixcclxuXHRcdFI6IFwiV3Jvb2tcIixcclxuXHRcdE46IFwiV2tuaWdodFwiLFxyXG5cdFx0QjogXCJXYmlzaG9wXCIsXHJcblx0XHRROiBcIldxdWVlblwiLFxyXG5cdFx0SzogXCJXa2luZ1wiLFxyXG5cdH07XHJcblxyXG5cdGNvbnN0IGJsYWNrUGllY2VzSUQgPSB7XHJcblx0XHRwOiBcIkJwYXduXCIsXHJcblx0XHRyOiBcIkJyb29rXCIsXHJcblx0XHRuOiBcIkJrbmlnaHRcIixcclxuXHRcdGI6IFwiQmJpc2hvcFwiLFxyXG5cdFx0cTogXCJCcXVlZW5cIixcclxuXHRcdGs6IFwiQmtpbmdcIixcclxuXHR9O1xyXG5cclxubGV0IHRpbGVTaXplID0gZ2FtZUJvYXJkU2l6ZSAvIDg7XHJcbmxldCBzZWxlY3RlZFBpZWNlID0gbnVsbDtcclxubGV0IHdoaXRlc01vdmUgPSB0cnVlO1xyXG5cclxuY29uc3QgZHJhd1BpZWNlID0gKHBpZWNlTmFtZSwgeCwgeSkgPT4ge1xyXG5cdGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xyXG5cdGltZy5zcmMgPSBgLi9kaXN0L2ltZy8ke3BpZWNlTmFtZX0ucG5nYDtcclxuXHJcblx0aW1nLm9ubG9hZCA9ICgpID0+IHtcclxuXHRcdGN0eC5kcmF3SW1hZ2UoaW1nLCB4LCB5LCB0aWxlU2l6ZSwgdGlsZVNpemUpO1xyXG5cdH07XHJcbn07XHJcblxyXG5jb25zdCBkcmF3Qm9hcmRBbmRQaWVjZXMgPSAoZ2FtZUJvYXJkU2l6ZSkgPT4ge1xyXG5cdGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IGdhbWVCb2FyZFNpemU7IGkgKz0gdGlsZVNpemUsIGorKykge1xyXG5cdFx0Zm9yIChsZXQgayA9IDAsIGwgPSAwOyBrIDwgZ2FtZUJvYXJkU2l6ZTsgayArPSB0aWxlU2l6ZSwgbCsrKSB7XHJcblx0XHRcdGlmIChqICUgMiA9PT0gMCkge1xyXG5cdFx0XHRcdGlmIChsICUgMiA9PT0gMCkge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IHdoaXRlQ29sb3I7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSBicm93bkNvbG9yO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRpZiAobCAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSBicm93bkNvbG9yO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gd2hpdGVDb2xvcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGNvbnN0IHBpZWNlID0gYm9hcmRbal1bbF07XHJcblxyXG5cdFx0XHRpZiAocGllY2UgIT0gXCJcIikge1xyXG5cdFx0XHRcdGRyYXdQaWVjZShwaWVjZU5hbWVzW3BpZWNlXSwgaSwgayk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGN0eC5maWxsUmVjdChpLCBrLCB0aWxlU2l6ZSwgdGlsZVNpemUpO1xyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcbmNvbnN0IHJlc2l6ZUNhbnZhcyA9ICgpID0+IHtcclxuXHRnYW1lQm9hcmQud2lkdGggPSBnYW1lQm9hcmRTaXplO1xyXG5cdGdhbWVCb2FyZC5oZWlnaHQgPSBnYW1lQm9hcmRTaXplO1xyXG5cdGRyYXdCb2FyZEFuZFBpZWNlcyhnYW1lQm9hcmRTaXplKTtcclxufTtcclxuXHJcbmNvbnN0IHNlbGVjdFBpZWNlID0gKGV2ZW50KSA9PiB7XHJcblx0bGV0IHggPSBldmVudC5vZmZzZXRYO1xyXG5cdGxldCB5ID0gZXZlbnQub2Zmc2V0WTtcclxuXHJcblx0Y29uc3QgY2xpY2tlZFJvdyA9IE1hdGguZmxvb3IoeSAvIHRpbGVTaXplKTtcclxuXHRjb25zdCBjbGlja2VkQ29sID0gTWF0aC5mbG9vcih4IC8gdGlsZVNpemUpO1xyXG5cclxuXHRjb25zdCBDUiA9IE1hdGguZmxvb3IoeSAvIHRpbGVTaXplKTtcclxuXHRjb25zdCBDQyA9IE1hdGguZmxvb3IoeCAvIHRpbGVTaXplKTtcclxuXHJcblx0c2VsZWN0ZWRQaWVjZSA9IGJvYXJkW2NsaWNrZWRDb2xdW2NsaWNrZWRSb3ddO1xyXG5cclxuXHRtb3ZlUGllY2Uoc2VsZWN0ZWRQaWVjZSwgQ1IsIENDKTtcclxufTtcclxuXHJcbmNvbnN0IGNoZWNrUnVsZXMgPSAocGllY2VJRCwgY2xpY2tlZFJvd1RhcmdldCwgY2xpY2tlZENvbFRhcmdldCwgQ1IsIENDLCBkcmF3UGllY2VPblRhcmdldCwgbWFrZU1vdmUpID0+IHtcclxuXHRsZXQgcm93RGlmZmVyZW5jZSA9IE1hdGguYWJzKENSIC0gY2xpY2tlZFJvd1RhcmdldClcclxuXHRsZXQgY29sRGlmZmVyZW5jZSA9IE1hdGguYWJzKENDIC0gY2xpY2tlZENvbFRhcmdldClcclxuXHJcblx0Ly8gUGF3bnNcclxuXHRpZihwaWVjZUlEID09IFwiUFwiKXtcclxuXHRcdGlmKENSID09IDYgJiYgKGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1ItMSB8fCBjbGlja2VkUm93VGFyZ2V0ID09Q1ItMikgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCl7XHJcblx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHR9ZWxzZSBpZihjbGlja2VkUm93VGFyZ2V0ID09IENSLTEgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCl7XHJcblx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHR9ZWxzZSBpZigoQ0MgPT0gKGNsaWNrZWRDb2xUYXJnZXQrMSkgfHwgQ0MgPT0gKGNsaWNrZWRDb2xUYXJnZXQtMSkpICYmIChib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSAhPSBcIlwiKSAmJiBjbGlja2VkUm93VGFyZ2V0IDwgQ1Ipe1xyXG5cdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0fWVsc2V7XHJcblx0XHRcdGdhbWVCb2FyZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0fVxyXG5cdH1lbHNlIGlmKHBpZWNlSUQgPT0gXCJwXCIpe1xyXG5cdFx0aWYoQ1IgPT0gMSAmJiAoY2xpY2tlZFJvd1RhcmdldCA9PSBDUisxIHx8IGNsaWNrZWRSb3dUYXJnZXQgPT1DUisyKSAmJiBDQyA9PSBjbGlja2VkQ29sVGFyZ2V0KXtcclxuXHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdH1lbHNlIGlmKGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IrMSAmJiBDQyA9PSBjbGlja2VkQ29sVGFyZ2V0KXtcclxuXHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdH1lbHNlIGlmKChDQyA9PSAoY2xpY2tlZENvbFRhcmdldCsxKSB8fCBDQyA9PSAoY2xpY2tlZENvbFRhcmdldC0xKSkgJiYgKGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdICE9IFwiXCIpICYmIGNsaWNrZWRSb3dUYXJnZXQgPiBDUil7XHJcblx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHR9ZWxzZXtcclxuXHRcdFx0Z2FtZUJvYXJkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHR9XHJcblxyXG5cdC8vIEJpc2hvcHNcclxuXHR9ZWxzZSBpZihwaWVjZUlEID09IFwiQlwiIHx8IHBpZWNlSUQgPT0gXCJiXCIpe1xyXG5cdFx0aWYoY29sRGlmZmVyZW5jZSA9PSByb3dEaWZmZXJlbmNlKXtcclxuXHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdH1cclxuXHQvLyBLbmlnaHRzXHJcblx0fWVsc2UgaWYocGllY2VJRCA9PSAnTicgfHwgcGllY2VJRCA9PSAnbicpe1xyXG5cdFx0aWYoKHJvd0RpZmZlcmVuY2UgPT0gMSAmJiBjb2xEaWZmZXJlbmNlID09IDIpIHx8IChyb3dEaWZmZXJlbmNlID09IDIgJiYgY29sRGlmZmVyZW5jZSA9PSAxKSl7XHJcblx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHR9XHJcblx0Ly8gUm9va3NcclxuXHR9ZWxzZSBpZihwaWVjZUlEID09ICdSJyB8fCBwaWVjZUlEID09ICdyJyl7XHJcblx0XHRpZihyb3dEaWZmZXJlbmNlID09IDAgfHwgY29sRGlmZmVyZW5jZSA9PSAwKXtcclxuXHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdH1cclxuXHQvLyBLaW5nc1xyXG5cdH1lbHNlIGlmKHBpZWNlSUQgPT0gJ0snIHx8IHBpZWNlSUQgPT0gXCJrXCIpe1xyXG5cdFx0aWYoKHJvd0RpZmZlcmVuY2UgPj0gMCB8fCBjb2xEaWZmZXJlbmNlID49IDApICYmIHJvd0RpZmZlcmVuY2UgPD0xICYmIGNvbERpZmZlcmVuY2UgPD0xKXtcclxuXHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdH1cclxuXHQvLyBRdWVlbnNcclxuXHR9ZWxzZSBpZihwaWVjZUlEID09ICdRJyB8fCBwaWVjZUlEID09IFwicVwiKXtcclxuXHRcdGlmKHJvd0RpZmZlcmVuY2UgPT0gMCB8fCBjb2xEaWZmZXJlbmNlID09IDApe1xyXG5cdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0fWVsc2UgaWYoY29sRGlmZmVyZW5jZSA9PSByb3dEaWZmZXJlbmNlKXtcclxuXHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbmNvbnN0IG1vdmVQaWVjZSA9IChzZWxlY3RlZFBpZWNlLCBDUiwgQ0MpID0+IHtcclxuXHRsZXQgbW92ZWRQaWVjZTtcclxuXHJcblx0Y29uc3Qgd2hpY2hQaWVjZSA9IChwaWVjZUlEKSA9PiB7XHJcblx0XHRpZiAoc2VsZWN0ZWRQaWVjZSA9PSBwaWVjZUlEKSB7XHJcblx0XHRcdGJvYXJkLmZvckVhY2goKGNsaWNrZWRSb3csIGkpID0+IHtcclxuXHRcdFx0XHRjbGlja2VkUm93LmZvckVhY2goKGNsaWNrZWRDb2wsIGopID0+IHtcclxuXHRcdFx0XHRcdGlmIChjbGlja2VkQ29sID09IHBpZWNlSUQgJiYgQ1IgPT0gaiAmJiBDQyA9PSBpKSB7XHJcblx0XHRcdFx0XHRcdGNvbnN0IG1ha2VNb3ZlID0gKGV2ZW50KSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0bGV0IHggPSBldmVudC5vZmZzZXRYO1xyXG5cdFx0XHRcdFx0XHRcdGxldCB5ID0gZXZlbnQub2Zmc2V0WTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgY2xpY2tlZFJvd1RhcmdldCA9IE1hdGguZmxvb3IoeSAvIHRpbGVTaXplKTtcclxuXHRcdFx0XHRcdFx0XHRjb25zdCBjbGlja2VkQ29sVGFyZ2V0ID0gTWF0aC5mbG9vcih4IC8gdGlsZVNpemUpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRjb25zdCBkcmF3UGllY2VPblRhcmdldCA9ICgpID0+IHtcclxuXHRcdFx0XHRcdFx0XHRcdC8vIGlmIChib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSA9PSBcIlwiIHx8IHdoaXRlUGllY2UgPT0gdHJ1ZSB8fCB3aGl0ZVBpZWNlID09IGZhbHNlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdID0gY2xpY2tlZENvbDtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdG1vdmVkUGllY2UgPSBib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XTtcclxuXHRcclxuXHRcdFx0XHRcdFx0XHRcdFx0ZHJhd1BpZWNlKFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHBpZWNlTmFtZXNbbW92ZWRQaWVjZV0sXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2xpY2tlZENvbFRhcmdldCAqIHRpbGVTaXplLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNsaWNrZWRSb3dUYXJnZXQgKiB0aWxlU2l6ZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHQpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0Ym9hcmRbQ0NdW0NSXSA9IFwiXCI7XHJcblx0XHJcblx0XHRcdFx0XHRcdFx0XHRcdGRyYXdCb2FyZEFuZFBpZWNlcyhnYW1lQm9hcmRTaXplKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRcdHdoaXRlc01vdmUgPSAhd2hpdGVzTW92ZTtcclxuXHRcdFx0XHRcdFx0XHRcdC8vIH1cclxuXHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdGdhbWVCb2FyZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0XHRcdFx0XHRcdGNoZWNrUnVsZXMocGllY2VJRCwgY2xpY2tlZFJvd1RhcmdldCwgY2xpY2tlZENvbFRhcmdldCwgQ1IsIENDLCBkcmF3UGllY2VPblRhcmdldCwgbWFrZU1vdmUpXHJcblx0XHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHRcdGdhbWVCb2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRsZXQgd2hpdGVQaWVjZTtcclxuXHJcblx0aWYgKHdoaXRlc01vdmUpIHtcclxuXHRcdGZvciAobGV0IHBpZWNlSUQgaW4gd2hpdGVQaWVjZXNJRCkge1xyXG5cdFx0XHRpZiAocGllY2VJRCA9PSBzZWxlY3RlZFBpZWNlKSB7XHJcblx0XHRcdFx0d2hpdGVQaWVjZSA9IHRydWU7XHJcblx0XHRcdFx0d2hpY2hQaWVjZShwaWVjZUlEKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0gZWxzZSB7XHJcblx0XHRmb3IgKGxldCBwaWVjZUlEIGluIGJsYWNrUGllY2VzSUQpIHtcclxuXHRcdFx0aWYgKHBpZWNlSUQgPT0gc2VsZWN0ZWRQaWVjZSkge1xyXG5cdFx0XHRcdHdoaXRlUGllY2UgPSBmYWxzZTtcclxuXHRcdFx0XHR3aGljaFBpZWNlKHBpZWNlSUQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgcmVzaXplQ2FudmFzKTtcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiB7XHJcblx0Z2FtZUJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzZWxlY3RQaWVjZSk7XHJcblx0cmVzaXplQ2FudmFzKCk7XHJcbn0pO1xyXG4iXX0=
