"use strict";var gameBoard=document.getElementById("gameBoard"),ctx=gameBoard.getContext("2d"),brownColor="#653c10",whiteColor="#dfc795",windowWidth=window.innerWidth,windowHeight=window.innerHeight,gameBoardSize=Math.min(windowWidth,windowHeight,600),board=[["r","p","","","","","P","R"],["n","p","","","","","P","N"],["b","p","","","","","P","B"],["q","p","","","","","P","Q"],["k","p","","","","","P","K"],["b","p","","","","","P","B"],["n","p","","","","","P","N"],["r","p","","","","","P","R"]],pieceNames={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking",P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},whitePiecesID={P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},blackPiecesID={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking"},tileSize=gameBoardSize/8,selectedPiece=null,whitesMove=!0,drawPiece=function(e,i,o){var a=new Image;a.src="./dist/img/".concat(e,".png"),a.onload=function(){ctx.drawImage(a,i,o,tileSize,tileSize)}},drawBoardAndPieces=function(e){for(var i=0,o=0;i<e;i+=tileSize,o++)for(var a=0,t=0;a<e;a+=tileSize,t++){ctx.fillStyle=o%2==0?t%2==0?whiteColor:brownColor:t%2==0?brownColor:whiteColor;var n=board[o][t];""!=n&&drawPiece(pieceNames[n],i,a),ctx.fillRect(i,a,tileSize,tileSize)}},resizeCanvas=function(){gameBoard.width=gameBoardSize,gameBoard.height=gameBoardSize,drawBoardAndPieces(gameBoardSize)},selectPiece=function(e){var i=e.offsetX,e=e.offsetY,o=Math.floor(e/tileSize),a=Math.floor(i/tileSize),e=Math.floor(e/tileSize),i=Math.floor(i/tileSize);selectedPiece=board[a][o],movePiece(selectedPiece,e,i)},checkRules=function(e,i,o,a,t,n,r){var c=Math.abs(a-i),d=Math.abs(t-o);"P"==e?6==a&&(i==a-1||i==a-2)&&t==o||i==a-1&&t==o||(t==o+1||t==o-1)&&""!=board[o][i]&&i<a?n():gameBoard.removeEventListener("click",r):"p"==e?1==a&&(i==a+1||i==a+2)&&t==o||i==a+1&&t==o||(t==o+1||t==o-1)&&""!=board[o][i]&&a<i?n():gameBoard.removeEventListener("click",r):"B"==e||"b"==e?d==c&&n():"N"!=e&&"n"!=e||(1==c&&2==d||2==c&&1==d)&&n()},movePiece=function(e,c,d){function i(r){e==r&&board.forEach(function(e,i){e.forEach(function(n,e){n==r&&c==e&&d==i&&gameBoard.addEventListener("click",function e(i){var o=i.offsetX,i=i.offsetY,a=Math.floor(i/tileSize),t=Math.floor(o/tileSize);gameBoard.removeEventListener("click",e),checkRules(r,a,t,c,d,function(){board[t][a]=n,l=board[t][a],drawPiece(pieceNames[l],t*tileSize,a*tileSize),board[d][c]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove},e)})})})}var l;if(whitesMove)for(var o in whitePiecesID)o==e&&i(o);else for(var a in blackPiecesID)a==e&&i(a)};window.addEventListener("resize",resizeCanvas),window.addEventListener("load",function(){gameBoard.addEventListener("click",selectPiece),resizeCanvas()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJnYW1lQm9hcmQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY3R4IiwiZ2V0Q29udGV4dCIsImJyb3duQ29sb3IiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwid2hpdGVDb2xvciIsImlubmVySGVpZ2h0Iiwid2luZG93V2lkdGgiLCJ3aW5kb3dIZWlnaHQiLCJnYW1lQm9hcmRTaXplIiwiTWF0aCIsImJvYXJkIiwicGllY2VOYW1lcyIsInAiLCJyIiwibiIsImIiLCJxIiwiayIsIndoaXRlUGllY2VzSUQiLCJQIiwiUiIsIk4iLCJCIiwiUSIsIksiLCJ0aWxlU2l6ZSIsImRyYXdQaWVjZSIsImltZyIsInNlbGVjdGVkUGllY2UiLCJ3aGl0ZXNNb3ZlIiwicGllY2VOYW1lIiwieCIsInkiLCJmaWxsU3R5bGUiLCJzcmMiLCJjb25jYXQiLCJvbmxvYWQiLCJkcmF3SW1hZ2UiLCJkcmF3Qm9hcmRBbmRQaWVjZXMiLCJwaWVjZSIsImoiLCJpIiwibCIsIndpZHRoIiwiY2xpY2tlZFJvdyIsImZsb29yIiwiQ1IiLCJmaWxsUmVjdCIsInJlc2l6ZUNhbnZhcyIsInBpZWNlSUQiLCJoZWlnaHQiLCJjbGlja2VkUm93VGFyZ2V0IiwiZHJhd1BpZWNlT25UYXJnZXQiLCJzZWxlY3RQaWVjZSIsImV2ZW50Iiwib2Zmc2V0WSIsImNsaWNrZWRDb2wiLCJDQyIsImNsaWNrZWRDb2xUYXJnZXQiLCJtb3ZlUGllY2UiLCJjaGVja1J1bGVzIiwibWFrZU1vdmUiLCJyb3dEaWZmZXJlbmNlIiwiYWJzIiwiY29sRGlmZmVyZW5jZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJ3aGljaFBpZWNlIiwibW92ZWRQaWVjZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJmb3JFYWNoIiwid2hpdGVQaWVjZSIsImJsYWNrUGllY2VzSUQiXSwibWFwcGluZ3MiOiJhQUFBLElBQU1BLFVBQVlDLFNBQVNDLGVBQWUsV0FBVyxFQUMvQ0MsSUFBTUgsVUFB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LEdBQUFILEdBQUFOLEdBQUFpQixHQUFBaEIsR0FUWDdDLFVBQVV3RSxpQkFBaUIsUUFVZixTQUFYUCxFQUFlM0MsR0FDbkIsSUFBSStCLEVBQUFBLEVBQVdyQixRQUNkMEMsRUFBQUEsRUFBYWYsUUFFZEosRUFBQTFDLEtBQUFvQyxNQUFBYixFQUFBUCxRQUFBLEVBQ0RpQyxFQUFBakQsS0FBQW9DLE1BQUFkLEVBQUFOLFFBQUEsRUFsQks3QixVQUFVcUUsb0JBQW9CLFFBQVNKLENBQVEsRUFDL0NELFdBQVdYLEVBQVNFLEVBQWtCTyxFQUFrQlosRUFBSVcsRUFtQjdDYyxXQUVsQkQsTUFBQUEsR0FBa0JuQixHQUFBSyxFQUVuQlcsRUFBQXpELE1BQUFnRCxHQUFBUCxHQUVGekIsVUFDQWYsV0FBQXdELEdBRU1DLEVBQWlCM0MsU0FFakIyQyxFQUFpQjNDLFFBQVEsRUFHOUJmLE1BQUErQyxHQUFBWCxHQUFBLEdBeENPUixtQkFBbUI5QixhQUFhLEVBRWhDcUIsV0FBYSxDQUFDQSxVQUVoQixFQUdtRmdDLENBQVEsQ0FDNUYsQ0FDNEMsQ0FFOUMsQ0FBQyxDQUNGLENBQUMsQ0FFSCxDQTFDQSxJQUFJTSxFQThDSixHQUFJdEMsV0FDSCxJQUFLLElBQUlvQixLQUFXL0IsY0FDZitCLEdBQVdyQixHQUVkc0MsRUFBV2pCLENBQU8sT0FJcEIsSUFBSyxJQUFJQSxLQUFXc0IsY0FDZnRCLEdBQVdyQixHQUVkc0MsRUFBV2pCLENBQU8sQ0FJdEIsRUFFQS9DLE9BQU9rRSxpQkFBaUIsU0FBVXBCLFlBQVksRUFFOUM5QyxPQUFPa0UsaUJBQWlCLE9BQVEsV0FDL0J4RSxVQUFVd0UsaUJBQWlCLFFBQVNmLFdBQVcsRUFDL0NMLGFBQVksQ0FDYixDQUFDIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBnYW1lQm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbWVCb2FyZFwiKTtcclxuY29uc3QgY3R4ID0gZ2FtZUJvYXJkLmdldENvbnRleHQoXCIyZFwiKTtcclxuY29uc3QgYnJvd25Db2xvciA9IFwiIzY1M2MxMFwiO1xyXG5jb25zdCB3aGl0ZUNvbG9yID0gXCIjZGZjNzk1XCI7XHJcbmNvbnN0IHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbmNvbnN0IHdpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuY29uc3QgZ2FtZUJvYXJkU2l6ZSA9IE1hdGgubWluKHdpbmRvd1dpZHRoLCB3aW5kb3dIZWlnaHQsIDYwMCk7XHJcbmNvbnN0IGJvYXJkID0gW1xyXG5cdFtcInJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIlJcIl0sXHJcblx0W1wiblwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiTlwiXSxcclxuXHRbXCJiXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJCXCJdLFxyXG5cdFtcInFcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIlFcIl0sXHJcblx0W1wia1wiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiS1wiXSxcclxuXHRbXCJiXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJCXCJdLFxyXG5cdFtcIm5cIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIk5cIl0sXHJcblx0W1wiclwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiUlwiXSxcclxuXTtcclxuXHJcbmNvbnN0IHBpZWNlTmFtZXMgPSB7XHJcblx0cDogXCJCcGF3blwiLFxyXG5cdHI6IFwiQnJvb2tcIixcclxuXHRuOiBcIkJrbmlnaHRcIixcclxuXHRiOiBcIkJiaXNob3BcIixcclxuXHRxOiBcIkJxdWVlblwiLFxyXG5cdGs6IFwiQmtpbmdcIixcclxuXHJcblx0UDogXCJXcGF3blwiLFxyXG5cdFI6IFwiV3Jvb2tcIixcclxuXHROOiBcIldrbmlnaHRcIixcclxuXHRCOiBcIldiaXNob3BcIixcclxuXHRROiBcIldxdWVlblwiLFxyXG5cdEs6IFwiV2tpbmdcIixcclxufTtcclxuXHJcbmNvbnN0IHdoaXRlUGllY2VzSUQgPSB7XHJcblx0XHRQOiBcIldwYXduXCIsXHJcblx0XHRSOiBcIldyb29rXCIsXHJcblx0XHROOiBcIldrbmlnaHRcIixcclxuXHRcdEI6IFwiV2Jpc2hvcFwiLFxyXG5cdFx0UTogXCJXcXVlZW5cIixcclxuXHRcdEs6IFwiV2tpbmdcIixcclxuXHR9O1xyXG5cclxuXHRjb25zdCBibGFja1BpZWNlc0lEID0ge1xyXG5cdFx0cDogXCJCcGF3blwiLFxyXG5cdFx0cjogXCJCcm9va1wiLFxyXG5cdFx0bjogXCJCa25pZ2h0XCIsXHJcblx0XHRiOiBcIkJiaXNob3BcIixcclxuXHRcdHE6IFwiQnF1ZWVuXCIsXHJcblx0XHRrOiBcIkJraW5nXCIsXHJcblx0fTtcclxuXHJcbmxldCB0aWxlU2l6ZSA9IGdhbWVCb2FyZFNpemUgLyA4O1xyXG5sZXQgc2VsZWN0ZWRQaWVjZSA9IG51bGw7XHJcbmxldCB3aGl0ZXNNb3ZlID0gdHJ1ZTtcclxuXHJcbmNvbnN0IGRyYXdQaWVjZSA9IChwaWVjZU5hbWUsIHgsIHkpID0+IHtcclxuXHRjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHRpbWcuc3JjID0gYC4vZGlzdC9pbWcvJHtwaWVjZU5hbWV9LnBuZ2A7XHJcblxyXG5cdGltZy5vbmxvYWQgPSAoKSA9PiB7XHJcblx0XHRjdHguZHJhd0ltYWdlKGltZywgeCwgeSwgdGlsZVNpemUsIHRpbGVTaXplKTtcclxuXHR9O1xyXG59O1xyXG5cclxuY29uc3QgZHJhd0JvYXJkQW5kUGllY2VzID0gKGdhbWVCb2FyZFNpemUpID0+IHtcclxuXHRmb3IgKGxldCBpID0gMCwgaiA9IDA7IGkgPCBnYW1lQm9hcmRTaXplOyBpICs9IHRpbGVTaXplLCBqKyspIHtcclxuXHRcdGZvciAobGV0IGsgPSAwLCBsID0gMDsgayA8IGdhbWVCb2FyZFNpemU7IGsgKz0gdGlsZVNpemUsIGwrKykge1xyXG5cdFx0XHRpZiAoaiAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRpZiAobCAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSB3aGl0ZUNvbG9yO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gYnJvd25Db2xvcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0aWYgKGwgJSAyID09PSAwKSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gYnJvd25Db2xvcjtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IHdoaXRlQ29sb3I7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjb25zdCBwaWVjZSA9IGJvYXJkW2pdW2xdO1xyXG5cclxuXHRcdFx0aWYgKHBpZWNlICE9IFwiXCIpIHtcclxuXHRcdFx0XHRkcmF3UGllY2UocGllY2VOYW1lc1twaWVjZV0sIGksIGspO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjdHguZmlsbFJlY3QoaSwgaywgdGlsZVNpemUsIHRpbGVTaXplKTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5jb25zdCByZXNpemVDYW52YXMgPSAoKSA9PiB7XHJcblx0Z2FtZUJvYXJkLndpZHRoID0gZ2FtZUJvYXJkU2l6ZTtcclxuXHRnYW1lQm9hcmQuaGVpZ2h0ID0gZ2FtZUJvYXJkU2l6ZTtcclxuXHRkcmF3Qm9hcmRBbmRQaWVjZXMoZ2FtZUJvYXJkU2l6ZSk7XHJcbn07XHJcblxyXG5jb25zdCBzZWxlY3RQaWVjZSA9IChldmVudCkgPT4ge1xyXG5cdGxldCB4ID0gZXZlbnQub2Zmc2V0WDtcclxuXHRsZXQgeSA9IGV2ZW50Lm9mZnNldFk7XHJcblxyXG5cdGNvbnN0IGNsaWNrZWRSb3cgPSBNYXRoLmZsb29yKHkgLyB0aWxlU2l6ZSk7XHJcblx0Y29uc3QgY2xpY2tlZENvbCA9IE1hdGguZmxvb3IoeCAvIHRpbGVTaXplKTtcclxuXHJcblx0Y29uc3QgQ1IgPSBNYXRoLmZsb29yKHkgLyB0aWxlU2l6ZSk7XHJcblx0Y29uc3QgQ0MgPSBNYXRoLmZsb29yKHggLyB0aWxlU2l6ZSk7XHJcblxyXG5cdHNlbGVjdGVkUGllY2UgPSBib2FyZFtjbGlja2VkQ29sXVtjbGlja2VkUm93XTtcclxuXHJcblx0bW92ZVBpZWNlKHNlbGVjdGVkUGllY2UsIENSLCBDQyk7XHJcbn07XHJcblxyXG5jb25zdCBjaGVja1J1bGVzID0gKHBpZWNlSUQsIGNsaWNrZWRSb3dUYXJnZXQsIGNsaWNrZWRDb2xUYXJnZXQsIENSLCBDQywgZHJhd1BpZWNlT25UYXJnZXQsIG1ha2VNb3ZlKSA9PiB7XHJcblx0bGV0IHJvd0RpZmZlcmVuY2UgPSBNYXRoLmFicyhDUiAtIGNsaWNrZWRSb3dUYXJnZXQpXHJcblx0bGV0IGNvbERpZmZlcmVuY2UgPSBNYXRoLmFicyhDQyAtIGNsaWNrZWRDb2xUYXJnZXQpXHJcblxyXG5cdC8vIFBhd25zXHJcblx0aWYocGllY2VJRCA9PSBcIlBcIil7XHJcblx0XHRpZihDUiA9PSA2ICYmIChjbGlja2VkUm93VGFyZ2V0ID09IENSLTEgfHwgY2xpY2tlZFJvd1RhcmdldCA9PUNSLTIpICYmIENDID09IGNsaWNrZWRDb2xUYXJnZXQpe1xyXG5cdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0fWVsc2UgaWYoY2xpY2tlZFJvd1RhcmdldCA9PSBDUi0xICYmIENDID09IGNsaWNrZWRDb2xUYXJnZXQpe1xyXG5cdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0fWVsc2UgaWYoKENDID09IChjbGlja2VkQ29sVGFyZ2V0KzEpIHx8IENDID09IChjbGlja2VkQ29sVGFyZ2V0LTEpKSAmJiAoYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gIT0gXCJcIikgJiYgY2xpY2tlZFJvd1RhcmdldCA8IENSKXtcclxuXHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdH1lbHNle1xyXG5cdFx0XHRnYW1lQm9hcmQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG1ha2VNb3ZlKTtcclxuXHRcdH1cclxuXHR9ZWxzZSBpZihwaWVjZUlEID09IFwicFwiKXtcclxuXHRcdGlmKENSID09IDEgJiYgKGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IrMSB8fCBjbGlja2VkUm93VGFyZ2V0ID09Q1IrMikgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCl7XHJcblx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHR9ZWxzZSBpZihjbGlja2VkUm93VGFyZ2V0ID09IENSKzEgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCl7XHJcblx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHR9ZWxzZSBpZigoQ0MgPT0gKGNsaWNrZWRDb2xUYXJnZXQrMSkgfHwgQ0MgPT0gKGNsaWNrZWRDb2xUYXJnZXQtMSkpICYmIChib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSAhPSBcIlwiKSAmJiBjbGlja2VkUm93VGFyZ2V0ID4gQ1Ipe1xyXG5cdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0fWVsc2V7XHJcblx0XHRcdGdhbWVCb2FyZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0fVxyXG5cclxuXHQvLyBCaXNob3BzXHJcblx0fWVsc2UgaWYocGllY2VJRCA9PSBcIkJcIiB8fCBwaWVjZUlEID09IFwiYlwiKXtcclxuXHRcdGlmKGNvbERpZmZlcmVuY2UgPT0gcm93RGlmZmVyZW5jZSl7XHJcblx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHR9XHJcblx0Ly8gS25pZ2h0c1xyXG5cdH1lbHNlIGlmKHBpZWNlSUQgPT0gJ04nIHx8IHBpZWNlSUQgPT0gJ24nKXtcclxuXHRcdGlmKChyb3dEaWZmZXJlbmNlID09IDEgJiYgY29sRGlmZmVyZW5jZSA9PSAyKSB8fCAocm93RGlmZmVyZW5jZSA9PSAyICYmIGNvbERpZmZlcmVuY2UgPT0gMSkpe1xyXG5cdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuY29uc3QgbW92ZVBpZWNlID0gKHNlbGVjdGVkUGllY2UsIENSLCBDQykgPT4ge1xyXG5cdGxldCBtb3ZlZFBpZWNlO1xyXG5cclxuXHRjb25zdCB3aGljaFBpZWNlID0gKHBpZWNlSUQpID0+IHtcclxuXHRcdGlmIChzZWxlY3RlZFBpZWNlID09IHBpZWNlSUQpIHtcclxuXHRcdFx0Ym9hcmQuZm9yRWFjaCgoY2xpY2tlZFJvdywgaSkgPT4ge1xyXG5cdFx0XHRcdGNsaWNrZWRSb3cuZm9yRWFjaCgoY2xpY2tlZENvbCwgaikgPT4ge1xyXG5cdFx0XHRcdFx0aWYgKGNsaWNrZWRDb2wgPT0gcGllY2VJRCAmJiBDUiA9PSBqICYmIENDID09IGkpIHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgbWFrZU1vdmUgPSAoZXZlbnQpID0+IHtcclxuXHRcdFx0XHRcdFx0XHRsZXQgeCA9IGV2ZW50Lm9mZnNldFg7XHJcblx0XHRcdFx0XHRcdFx0bGV0IHkgPSBldmVudC5vZmZzZXRZO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRjb25zdCBjbGlja2VkUm93VGFyZ2V0ID0gTWF0aC5mbG9vcih5IC8gdGlsZVNpemUpO1xyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGNsaWNrZWRDb2xUYXJnZXQgPSBNYXRoLmZsb29yKHggLyB0aWxlU2l6ZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGRyYXdQaWVjZU9uVGFyZ2V0ID0gKCkgPT4ge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gaWYgKGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdID09IFwiXCIgfHwgd2hpdGVQaWVjZSA9PSB0cnVlIHx8IHdoaXRlUGllY2UgPT0gZmFsc2UpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ym9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gPSBjbGlja2VkQ29sO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0bW92ZWRQaWVjZSA9IGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdO1xyXG5cdFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRkcmF3UGllY2UoXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0cGllY2VOYW1lc1ttb3ZlZFBpZWNlXSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjbGlja2VkQ29sVGFyZ2V0ICogdGlsZVNpemUsXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2xpY2tlZFJvd1RhcmdldCAqIHRpbGVTaXplXHJcblx0XHRcdFx0XHRcdFx0XHRcdCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRib2FyZFtDQ11bQ1JdID0gXCJcIjtcclxuXHRcclxuXHRcdFx0XHRcdFx0XHRcdFx0ZHJhd0JvYXJkQW5kUGllY2VzKGdhbWVCb2FyZFNpemUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHRcdFx0d2hpdGVzTW92ZSA9ICF3aGl0ZXNNb3ZlO1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gfVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0Z2FtZUJvYXJkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHRcdFx0XHRcdFx0Y2hlY2tSdWxlcyhwaWVjZUlELCBjbGlja2VkUm93VGFyZ2V0LCBjbGlja2VkQ29sVGFyZ2V0LCBDUiwgQ0MsIGRyYXdQaWVjZU9uVGFyZ2V0LCBtYWtlTW92ZSlcclxuXHRcdFx0XHRcdFx0fTtcclxuXHRcdFx0XHRcdFx0Z2FtZUJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGxldCB3aGl0ZVBpZWNlO1xyXG5cclxuXHRpZiAod2hpdGVzTW92ZSkge1xyXG5cdFx0Zm9yIChsZXQgcGllY2VJRCBpbiB3aGl0ZVBpZWNlc0lEKSB7XHJcblx0XHRcdGlmIChwaWVjZUlEID09IHNlbGVjdGVkUGllY2UpIHtcclxuXHRcdFx0XHR3aGl0ZVBpZWNlID0gdHJ1ZTtcclxuXHRcdFx0XHR3aGljaFBpZWNlKHBpZWNlSUQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSBlbHNlIHtcclxuXHRcdGZvciAobGV0IHBpZWNlSUQgaW4gYmxhY2tQaWVjZXNJRCkge1xyXG5cdFx0XHRpZiAocGllY2VJRCA9PSBzZWxlY3RlZFBpZWNlKSB7XHJcblx0XHRcdFx0d2hpdGVQaWVjZSA9IGZhbHNlO1xyXG5cdFx0XHRcdHdoaWNoUGllY2UocGllY2VJRCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCByZXNpemVDYW52YXMpO1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHtcclxuXHRnYW1lQm9hcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHNlbGVjdFBpZWNlKTtcclxuXHRyZXNpemVDYW52YXMoKTtcclxufSk7XHJcbiJdfQ==
