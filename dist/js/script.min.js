"use strict";var whitePiece,gameBoard=document.getElementById("gameBoard"),ctx=gameBoard.getContext("2d"),brownColor="#653c10",whiteColor="#dfc795",windowWidth=window.innerWidth,windowHeight=window.innerHeight,gameBoardSize=Math.min(windowWidth,windowHeight,600),board=[["r","p","","","","","P","R"],["n","p","","","","","P","N"],["b","p","","","","","P","B"],["q","p","","","","","P","Q"],["k","p","","","","","P","K"],["b","p","","","","","P","B"],["n","p","","","","","P","N"],["r","p","","","","","P","R"]],pieceNames={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking",P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},whitePiecesID={P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},blackPiecesID={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking"},tileSize=gameBoardSize/8,selectedPiece=null,whitesMove=!0,drawPiece=function(e,i,o){var a=new Image;a.src="./dist/img/".concat(e,".png"),a.onload=function(){ctx.drawImage(a,i,o,tileSize,tileSize)}},drawBoardAndPieces=function(e){for(var i=0,o=0;i<e;i+=tileSize,o++)for(var a=0,r=0;a<e;a+=tileSize,r++){ctx.fillStyle=o%2==0?r%2==0?whiteColor:brownColor:r%2==0?brownColor:whiteColor;var t=board[o][r];""!=t&&drawPiece(pieceNames[t],i,a),ctx.fillRect(i,a,tileSize,tileSize)}},resizeCanvas=function(){gameBoard.width=gameBoardSize,gameBoard.height=gameBoardSize,drawBoardAndPieces(gameBoardSize)},selectPiece=function(e){var i=e.offsetX,e=e.offsetY,o=Math.floor(e/tileSize),a=Math.floor(i/tileSize),e=Math.floor(e/tileSize),i=Math.floor(i/tileSize);selectedPiece=board[a][o],movePiece(selectedPiece,e,i)},checkRules=function(e,n,d,i,o,a,r){var t=Math.abs(i-n),c=Math.abs(o-d),l=!1;if(whitePiece)for(var s in whitePiecesID)s==board[d][n]&&(l=!0);else for(var w in blackPiecesID)w==board[d][n]&&(l=!0);if(1!=l)if("P"==e)6==i&&(n==i-1||n==i-2)&&o==d||n==i-1&&o==d||(o==d+1||o==d-1)&&""!=board[d][n]&&n<i?a():gameBoard.removeEventListener("click",r);else if("p"==e)1==i&&(n==i+1||n==i+2)&&o==d||n==i+1&&o==d||(o==d+1||o==d-1)&&""!=board[d][n]&&i<n?a():gameBoard.removeEventListener("click",r);else if("B"==e||"b"==e){if(c==t){for(var h=function(o){var e=Math.min(d+o,7),i=Math.abs(d-o),a=Math.min(n+o,7),r=Math.abs(n-o);{function t(e,i){"k"===board[e][i]&&1==whitesMove?(console.log("szachPrzezBialych"),console.log(o),console.log(whitesMove),drawPiece("kCHECK",e*tileSize,i*tileSize)):"K"===board[e][i]&&0==whitesMove&&(console.log("szachPrzezCzarnych"),console.log(o),console.log(whitesMove),drawPiece("KCHECK2",e*tileSize,i*tileSize))}""!==board[e][a]&&""!==board[i][r]&&""!==board[e][r]&&""!==board[i][a]||(t(e,a),t(i,r),t(e,r),t(i,a))}if(0==r)return"break";console.log(board[e][r])},b=1;b<=8;b++)if("break"===h(b))break;a()}}else"N"==e||"n"==e?(1==t&&2==c||2==t&&1==c)&&a():"R"==e||"r"==e?0!=t&&0!=c||a():"K"==e||"k"==e?(0<=t||0<=c)&&t<=1&&c<=1?a():"K"==e&&7==n&&6==d&&"R"==board[7][7]&&""==board[6][7]&&""==board[5][7]?(board[6][7]="K",board[5][7]="R",drawPiece("Wking",6*tileSize,7*tileSize),drawPiece("Wrook",5*tileSize,7*tileSize),board[7][7]="",board[4][7]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove):"K"==e&&7==n&&2==d&&"R"==board[0][7]&&""==board[1][7]&&""==board[2][7]&&""==board[3][7]&&(board[2][7]="K",board[3][7]="R",drawPiece("Wking",2*tileSize,7*tileSize),drawPiece("Wrook",3*tileSize,7*tileSize),board[0][7]="",board[4][7]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove):"Q"!=e&&"q"!=e||0!=t&&0!=c&&c!=t||a()},movePiece=function(e,d,c){function i(n){e==n&&board.forEach(function(e,i){e.forEach(function(t,e){t==n&&d==e&&c==i&&gameBoard.addEventListener("click",function e(i){var o=i.offsetX,i=i.offsetY,a=Math.floor(i/tileSize),r=Math.floor(o/tileSize);gameBoard.removeEventListener("click",e),checkRules(n,a,r,d,c,function(){board[r][a]=t,l=board[r][a],drawPiece(pieceNames[l],r*tileSize,a*tileSize),board[c][d]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove},e)})})})}var l;if(whitesMove)for(var o in whitePiecesID)o==e&&(whitePiece=!0,i(o));else for(var a in blackPiecesID)a==e&&(whitePiece=!1,i(a))};window.addEventListener("resize",resizeCanvas),window.addEventListener("load",function(){gameBoard.addEventListener("click",selectPiece),resizeCanvas()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJ3aGl0ZVBpZWNlIiwiZ2FtZUJvYXJkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImN0eCIsImdldENvbnRleHQiLCJicm93bkNvbG9yIiwid2luZG93IiwiaW5uZXJXaWR0aCIsIndoaXRlQ29sb3IiLCJpbm5lckhlaWdodCIsIndpbmRvd1dpZHRoIiwid2luZG93SGVpZ2h0IiwiZ2FtZUJvYXJkU2l6ZSIsIk1hdGgiLCJib2FyZCIsInBpZWNlTmFtZXMiLCJwIiwiciIsIm4iLCJiIiwicSIsImsiLCJ3aGl0ZVBpZWNlc0lEIiwiUCIsIlIiLCJOIiwiQiIsIlEiLCJLIiwidGlsZVNpemUiLCJkcmF3UGllY2UiLCJpbWciLCJzZWxlY3RlZFBpZWNlIiwibCIsIndoaXRlc01vdmUiLCJwaWVjZU5hbWUiLCJ4IiwieSIsImZpbGxTdHlsZSIsInNyYyIsImNvbmNhdCIsIm9ubG9hZCIsImRyYXdJbWFnZSIsImRyYXdCb2FyZEFuZFBpZWNlcyIsInBpZWNlIiwiaiIsImkiLCJ3aWR0aCIsImNsaWNrZWRSb3ciLCJmbG9vciIsIkNSIiwiZmlsbFJlY3QiLCJwaWVjZUlEIiwic2VsZWN0UGllY2UiLCJldmVudCIsImNsaWNrZWRDb2wiLCJ3cm9uZ1Rha2UiLCJDQyIsImNsaWNrZWRSb3dUYXJnZXQiLCJtb3ZlUGllY2UiLCJjaGVja1J1bGVzIiwiZHJhd1BpZWNlT25UYXJnZXQiLCJjbGlja2VkQ29sVGFyZ2V0IiwibWFrZU1vdmUiLCJyb3dEaWZmZXJlbmNlIiwiY29sRGlmZmVyZW5jZSIsImFicyIsImRlY3JlbWVudGVkQ29sIiwiaW5jcmVtZW50ZWRSb3ciLCJkZWNyZW1lbnRlZFJvdyIsImNvbnNvbGUiLCJsb2ciLCJpbmNyZW1lbnRlZENvbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJfbG9vcCIsIm1pbiIsInJvdyIsImNvbCIsIm1vdmVkUGllY2UiLCJjaGVja1BpZWNlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIndoaWNoUGllY2UiLCJyZXNpemVDYW52YXMiLCJmb3JFYWNoIiwib2Zmc2V0WCIsIm9mZnNldFkiLCJibGFja1BpZWNlc0lEIl0sIm1hcHBpbmdzIjoiYUFBQSxJQXVESUEsV0F2REVDLFVBQVlDLFNBQVNDLGVBQWUsV0FBVyxFQUMvQ0MsSUFBTUgsVUFBVUksV0FBVyxJQUFJLEVBRC9CSixXQUFZQyxVQUNaRSxXQUFlLFVBQ2ZFLFlBQWFDLE9BQVNDLFdBQ3RCQyxhQUFhRixPQUFTRyxZQUN0QkMsY0FBY0osS0FBT0MsSUFBQUEsWUFBVUksYUFBQSxHQUFBLEVBQy9CQSxNQUFBQSxDQUNOLENBQUEsSUFBTUMsSUFBQUEsR0FBQUEsR0FBZ0JDLEdBQUksR0FBSSxJQUFDSCxLQUMvQixDQUFBLElBQU1JLElBQVEsR0FDWixHQUFLLEdBQUssR0FBSSxJQUFJLEtBVXBCLENBQUEsSUFBTUMsSUFBQUEsR0FBVSxHQUFHLEdBQUEsR0FBQSxJQUFBLEtBUGxCLENBUUFDLElBQUcsSUFBTyxHQUFBLEdBQUEsR0FBQSxHQUFBLElBQUEsS0FQVixDQVFBQyxJQUFHLElBQU8sR0FBQSxHQUFBLEdBQUEsR0FBQSxJQUFBLEtBUFYsQ0FRQUMsSUFBRyxJQUFBLEdBQVMsR0FBQSxHQUFBLEdBQUEsSUFBQSxLQVBaLENBUUFDLElBQUcsSUFBQSxHQUFTLEdBQUEsR0FBQSxHQUFBLElBQUEsS0FQWixDQVFBQyxJQUFHLElBQUEsR0FBUSxHQUFBLEdBQUEsR0FBQSxJQUFBLE1BSVJMLFdBQU8sQ0FSVkMsRUFTQyxRQVJEQyxFQVNDLFFBUkRDLEVBU0MsVUFSREMsRUFTQyxVQUNEQyxFQUFBLFNBRURDLEVBQU1DLFFBUkxDLEVBVUMsUUFUREMsRUFVQyxRQVREQyxFQVVDLFVBVERDLEVBVUMsVUFUREMsRUFVQyxTQUNEQyxFQUFBLE9BRUQsRUFFSU4sY0FBTyxDQVZWQyxFQVdDLFFBVkRDLEVBV0MsUUFWREMsRUFXQyxVQVZEQyxFQVdDLFVBQ0RDLEVBQUEsU0FFREMsRUFBSUMsT0FDSixFQUVJOUIsY0FBVSxDQUVkaUIs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V0M2QixDQUFRLENBRVYsQ0FFNEMsQ0FFOUMsQ0FBQyxDQUNGLENBQUMsQ0FFSCxDQXBEQSxJQUFJZSxFQXNESixHQUFJNUMsV0FDSCxJQUFLLElBQUlrQixLQUFXOUIsY0FDZjhCLEdBQVdwQixJQUNkakMsV0FBYSxDQUFBLEVBQ2JrRixFQUFXN0IsQ0FBTyxRQUlwQixJQUFLLElBQUlBLEtBQVdrQyxjQUNmbEMsR0FBV3BCLElBQ2RqQyxXQUFhLENBQUEsRUFDYmtGLEVBQVc3QixDQUFPLEVBSXRCLEVBRUE5QyxPQUFPMEUsaUJBQWlCLFNBQVVFLFlBQVksRUFFOUM1RSxPQUFPMEUsaUJBQWlCLE9BQVEsV0FDL0JoRixVQUFVZ0YsaUJBQWlCLFFBQVMzQixXQUFXLEVBQy9DNkIsYUFBWSxDQUNiLENBQUMiLCJmaWxlIjoic2NyaXB0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGdhbWVCb2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZ2FtZUJvYXJkXCIpO1xyXG5jb25zdCBjdHggPSBnYW1lQm9hcmQuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG5jb25zdCBicm93bkNvbG9yID0gXCIjNjUzYzEwXCI7XHJcbmNvbnN0IHdoaXRlQ29sb3IgPSBcIiNkZmM3OTVcIjtcclxuY29uc3Qgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuY29uc3Qgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5jb25zdCBnYW1lQm9hcmRTaXplID0gTWF0aC5taW4od2luZG93V2lkdGgsIHdpbmRvd0hlaWdodCwgNjAwKTtcclxuY29uc3QgYm9hcmQgPSBbXHJcblx0W1wiclwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiUlwiXSxcclxuXHRbXCJuXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJOXCJdLFxyXG5cdFtcImJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIkJcIl0sXHJcblx0W1wicVwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiUVwiXSxcclxuXHRbXCJrXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJLXCJdLFxyXG5cdFtcImJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIkJcIl0sXHJcblx0W1wiblwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiTlwiXSxcclxuXHRbXCJyXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJSXCJdLFxyXG5dO1xyXG5cclxuY29uc3QgcGllY2VOYW1lcyA9IHtcclxuXHRwOiBcIkJwYXduXCIsXHJcblx0cjogXCJCcm9va1wiLFxyXG5cdG46IFwiQmtuaWdodFwiLFxyXG5cdGI6IFwiQmJpc2hvcFwiLFxyXG5cdHE6IFwiQnF1ZWVuXCIsXHJcblx0azogXCJCa2luZ1wiLFxyXG5cclxuXHRQOiBcIldwYXduXCIsXHJcblx0UjogXCJXcm9va1wiLFxyXG5cdE46IFwiV2tuaWdodFwiLFxyXG5cdEI6IFwiV2Jpc2hvcFwiLFxyXG5cdFE6IFwiV3F1ZWVuXCIsXHJcblx0SzogXCJXa2luZ1wiLFxyXG59O1xyXG5cclxuY29uc3Qgd2hpdGVQaWVjZXNJRCA9IHtcclxuXHRQOiBcIldwYXduXCIsXHJcblx0UjogXCJXcm9va1wiLFxyXG5cdE46IFwiV2tuaWdodFwiLFxyXG5cdEI6IFwiV2Jpc2hvcFwiLFxyXG5cdFE6IFwiV3F1ZWVuXCIsXHJcblx0SzogXCJXa2luZ1wiLFxyXG59O1xyXG5cclxuY29uc3QgYmxhY2tQaWVjZXNJRCA9IHtcclxuXHRwOiBcIkJwYXduXCIsXHJcblx0cjogXCJCcm9va1wiLFxyXG5cdG46IFwiQmtuaWdodFwiLFxyXG5cdGI6IFwiQmJpc2hvcFwiLFxyXG5cdHE6IFwiQnF1ZWVuXCIsXHJcblx0azogXCJCa2luZ1wiLFxyXG59O1xyXG5cclxubGV0IHRpbGVTaXplID0gZ2FtZUJvYXJkU2l6ZSAvIDg7XHJcbmxldCBzZWxlY3RlZFBpZWNlID0gbnVsbDtcclxubGV0IHdoaXRlc01vdmUgPSB0cnVlO1xyXG5sZXQgd2hpdGVQaWVjZTtcclxuXHJcbmNvbnN0IGRyYXdQaWVjZSA9IChwaWVjZU5hbWUsIHgsIHkpID0+IHtcclxuXHRjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHRpbWcuc3JjID0gYC4vZGlzdC9pbWcvJHtwaWVjZU5hbWV9LnBuZ2A7XHJcblxyXG5cdGltZy5vbmxvYWQgPSAoKSA9PiB7XHJcblx0XHRjdHguZHJhd0ltYWdlKGltZywgeCwgeSwgdGlsZVNpemUsIHRpbGVTaXplKTtcclxuXHR9O1xyXG59O1xyXG5cclxuY29uc3QgZHJhd0JvYXJkQW5kUGllY2VzID0gKGdhbWVCb2FyZFNpemUpID0+IHtcclxuXHRmb3IgKGxldCBpID0gMCwgaiA9IDA7IGkgPCBnYW1lQm9hcmRTaXplOyBpICs9IHRpbGVTaXplLCBqKyspIHtcclxuXHRcdGZvciAobGV0IGsgPSAwLCBsID0gMDsgayA8IGdhbWVCb2FyZFNpemU7IGsgKz0gdGlsZVNpemUsIGwrKykge1xyXG5cdFx0XHRpZiAoaiAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRpZiAobCAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSB3aGl0ZUNvbG9yO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gYnJvd25Db2xvcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0aWYgKGwgJSAyID09PSAwKSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gYnJvd25Db2xvcjtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IHdoaXRlQ29sb3I7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjb25zdCBwaWVjZSA9IGJvYXJkW2pdW2xdO1xyXG5cclxuXHRcdFx0aWYgKHBpZWNlICE9IFwiXCIpIHtcclxuXHRcdFx0XHRkcmF3UGllY2UocGllY2VOYW1lc1twaWVjZV0sIGksIGspO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjdHguZmlsbFJlY3QoaSwgaywgdGlsZVNpemUsIHRpbGVTaXplKTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5jb25zdCByZXNpemVDYW52YXMgPSAoKSA9PiB7XHJcblx0Z2FtZUJvYXJkLndpZHRoID0gZ2FtZUJvYXJkU2l6ZTtcclxuXHRnYW1lQm9hcmQuaGVpZ2h0ID0gZ2FtZUJvYXJkU2l6ZTtcclxuXHRkcmF3Qm9hcmRBbmRQaWVjZXMoZ2FtZUJvYXJkU2l6ZSk7XHJcbn07XHJcblxyXG5jb25zdCBzZWxlY3RQaWVjZSA9IChldmVudCkgPT4ge1xyXG5cdGxldCB4ID0gZXZlbnQub2Zmc2V0WDtcclxuXHRsZXQgeSA9IGV2ZW50Lm9mZnNldFk7XHJcblxyXG5cdGNvbnN0IGNsaWNrZWRSb3cgPSBNYXRoLmZsb29yKHkgLyB0aWxlU2l6ZSk7XHJcblx0Y29uc3QgY2xpY2tlZENvbCA9IE1hdGguZmxvb3IoeCAvIHRpbGVTaXplKTtcclxuXHJcblx0Y29uc3QgQ1IgPSBNYXRoLmZsb29yKHkgLyB0aWxlU2l6ZSk7XHJcblx0Y29uc3QgQ0MgPSBNYXRoLmZsb29yKHggLyB0aWxlU2l6ZSk7XHJcblxyXG5cdHNlbGVjdGVkUGllY2UgPSBib2FyZFtjbGlja2VkQ29sXVtjbGlja2VkUm93XTtcclxuXHJcblx0bW92ZVBpZWNlKHNlbGVjdGVkUGllY2UsIENSLCBDQyk7XHJcbn07XHJcblxyXG5jb25zdCBjaGVja1J1bGVzID0gKFxyXG5cdHBpZWNlSUQsXHJcblx0Y2xpY2tlZFJvd1RhcmdldCxcclxuXHRjbGlja2VkQ29sVGFyZ2V0LFxyXG5cdENSLFxyXG5cdENDLFxyXG5cdGRyYXdQaWVjZU9uVGFyZ2V0LFxyXG5cdG1ha2VNb3ZlXHJcbikgPT4ge1xyXG5cdGxldCByb3dEaWZmZXJlbmNlID0gTWF0aC5hYnMoQ1IgLSBjbGlja2VkUm93VGFyZ2V0KTtcclxuXHRsZXQgY29sRGlmZmVyZW5jZSA9IE1hdGguYWJzKENDIC0gY2xpY2tlZENvbFRhcmdldCk7XHJcblx0bGV0IHdyb25nVGFrZSA9IGZhbHNlO1xyXG5cclxuXHRpZiAod2hpdGVQaWVjZSkge1xyXG5cdFx0Zm9yIChsZXQgcGllY2VJRCBpbiB3aGl0ZVBpZWNlc0lEKSB7XHJcblx0XHRcdGlmIChwaWVjZUlEID09IGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdKSB7XHJcblx0XHRcdFx0d3JvbmdUYWtlID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0gZWxzZSB7XHJcblx0XHRmb3IgKGxldCBwaWVjZUlEIGluIGJsYWNrUGllY2VzSUQpIHtcclxuXHRcdFx0aWYgKHBpZWNlSUQgPT0gYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0pIHtcclxuXHRcdFx0XHR3cm9uZ1Rha2UgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRpZiAod3JvbmdUYWtlICE9IHRydWUpIHtcclxuXHRcdC8vIFBhd25zXHJcblx0XHRpZiAocGllY2VJRCA9PSBcIlBcIikge1xyXG5cdFx0XHRpZiAoXHJcblx0XHRcdFx0Q1IgPT0gNiAmJlxyXG5cdFx0XHRcdChjbGlja2VkUm93VGFyZ2V0ID09IENSIC0gMSB8fCBjbGlja2VkUm93VGFyZ2V0ID09IENSIC0gMikgJiZcclxuXHRcdFx0XHRDQyA9PSBjbGlja2VkQ29sVGFyZ2V0XHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSBpZiAoY2xpY2tlZFJvd1RhcmdldCA9PSBDUiAtIDEgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSBpZiAoXHJcblx0XHRcdFx0KENDID09IGNsaWNrZWRDb2xUYXJnZXQgKyAxIHx8IENDID09IGNsaWNrZWRDb2xUYXJnZXQgLSAxKSAmJlxyXG5cdFx0XHRcdGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdICE9IFwiXCIgJiZcclxuXHRcdFx0XHRjbGlja2VkUm93VGFyZ2V0IDwgQ1JcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRnYW1lQm9hcmQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG1ha2VNb3ZlKTtcclxuXHRcdFx0fVxyXG5cdFx0fSBlbHNlIGlmIChwaWVjZUlEID09IFwicFwiKSB7XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHRDUiA9PSAxICYmXHJcblx0XHRcdFx0KGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgKyAxIHx8IGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgKyAyKSAmJlxyXG5cdFx0XHRcdENDID09IGNsaWNrZWRDb2xUYXJnZXRcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIGlmIChjbGlja2VkUm93VGFyZ2V0ID09IENSICsgMSAmJiBDQyA9PSBjbGlja2VkQ29sVGFyZ2V0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIGlmIChcclxuXHRcdFx0XHQoQ0MgPT0gY2xpY2tlZENvbFRhcmdldCArIDEgfHwgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCAtIDEpICYmXHJcblx0XHRcdFx0Ym9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gIT0gXCJcIiAmJlxyXG5cdFx0XHRcdGNsaWNrZWRSb3dUYXJnZXQgPiBDUlxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGdhbWVCb2FyZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBCaXNob3BzXHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJCXCIgfHwgcGllY2VJRCA9PSBcImJcIikge1xyXG5cdFx0XHRpZiAoY29sRGlmZmVyZW5jZSA9PSByb3dEaWZmZXJlbmNlKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDE7IGkgPD0gODsgaSsrKSB7XHJcblx0XHRcdFx0XHRsZXQgaW5jcmVtZW50ZWRDb2wgPSBNYXRoLm1pbihjbGlja2VkQ29sVGFyZ2V0ICsgaSwgNyk7XHJcblx0XHRcdFx0XHRsZXQgZGVjcmVtZW50ZWRDb2wgPSBNYXRoLmFicyhjbGlja2VkQ29sVGFyZ2V0IC0gaSk7XHJcblx0XHRcdFx0XHRsZXQgaW5jcmVtZW50ZWRSb3cgPSBNYXRoLm1pbihjbGlja2VkUm93VGFyZ2V0ICsgaSwgNyk7XHJcblx0XHRcdFx0XHRsZXQgZGVjcmVtZW50ZWRSb3cgPSBNYXRoLmFicyhjbGlja2VkUm93VGFyZ2V0IC0gaSk7XHJcblxyXG5cdFx0XHRcdFx0Y29uc3QgaXNDaGVjayA9ICgpID0+IHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgY2hlY2tQaWVjZSA9IChjb2wsIHJvdykgPT4ge1xyXG5cdFx0XHRcdFx0XHRcdGlmIChib2FyZFtjb2xdW3Jvd10gPT09IFwia1wiICYmIHdoaXRlc01vdmUgPT0gdHJ1ZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJzemFjaFByemV6QmlhbHljaFwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKGkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2cod2hpdGVzTW92ZSk7XHJcblx0XHRcdFx0XHRcdFx0XHRkcmF3UGllY2UoXCJrQ0hFQ0tcIiwgY29sICogdGlsZVNpemUsIHJvdyAqIHRpbGVTaXplKTtcclxuXHRcdFx0XHRcdFx0XHR9ZWxzZSBpZihib2FyZFtjb2xdW3Jvd10gPT09IFwiS1wiICYmIHdoaXRlc01vdmUgPT0gZmFsc2Upe1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJzemFjaFByemV6Q3phcm55Y2hcIik7XHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhpKTtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKHdoaXRlc01vdmUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0ZHJhd1BpZWNlKFwiS0NIRUNLMlwiLCBjb2wgKiB0aWxlU2l6ZSwgcm93ICogdGlsZVNpemUpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fTtcclxuXHJcblx0XHRcdFx0XHRcdGNoZWNrUGllY2UoaW5jcmVtZW50ZWRDb2wsIGluY3JlbWVudGVkUm93KTtcclxuXHRcdFx0XHRcdFx0Y2hlY2tQaWVjZShkZWNyZW1lbnRlZENvbCwgZGVjcmVtZW50ZWRSb3cpO1xyXG5cdFx0XHRcdFx0XHRjaGVja1BpZWNlKGluY3JlbWVudGVkQ29sLCBkZWNyZW1lbnRlZFJvdyk7XHJcblx0XHRcdFx0XHRcdGNoZWNrUGllY2UoZGVjcmVtZW50ZWRDb2wsIGluY3JlbWVudGVkUm93KTtcclxuXHRcdFx0XHRcdH07XHJcblxyXG5cdFx0XHRcdFx0aWYgKFxyXG5cdFx0XHRcdFx0XHRib2FyZFtpbmNyZW1lbnRlZENvbF1baW5jcmVtZW50ZWRSb3ddID09PSBcIlwiIHx8XHJcblx0XHRcdFx0XHRcdGJvYXJkW2RlY3JlbWVudGVkQ29sXVtkZWNyZW1lbnRlZFJvd10gPT09IFwiXCIgfHxcclxuXHRcdFx0XHRcdFx0Ym9hcmRbaW5jcmVtZW50ZWRDb2xdW2RlY3JlbWVudGVkUm93XSA9PT0gXCJcIiB8fFxyXG5cdFx0XHRcdFx0XHRib2FyZFtkZWNyZW1lbnRlZENvbF1baW5jcmVtZW50ZWRSb3ddID09PSBcIlwiXHJcblx0XHRcdFx0XHQpIHtcclxuXHRcdFx0XHRcdFx0aXNDaGVjaygpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmIChkZWNyZW1lbnRlZFJvdyA9PSAwKSBicmVhaztcclxuXHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhib2FyZFtpbmNyZW1lbnRlZENvbF1bZGVjcmVtZW50ZWRSb3ddKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBLbmlnaHRzXHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJOXCIgfHwgcGllY2VJRCA9PSBcIm5cIikge1xyXG5cdFx0XHRpZiAoXHJcblx0XHRcdFx0KHJvd0RpZmZlcmVuY2UgPT0gMSAmJiBjb2xEaWZmZXJlbmNlID09IDIpIHx8XHJcblx0XHRcdFx0KHJvd0RpZmZlcmVuY2UgPT0gMiAmJiBjb2xEaWZmZXJlbmNlID09IDEpXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gUm9va3NcclxuXHRcdH0gZWxzZSBpZiAocGllY2VJRCA9PSBcIlJcIiB8fCBwaWVjZUlEID09IFwiclwiKSB7XHJcblx0XHRcdGlmIChyb3dEaWZmZXJlbmNlID09IDAgfHwgY29sRGlmZmVyZW5jZSA9PSAwKSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBLaW5nc1xyXG5cdFx0fSBlbHNlIGlmIChwaWVjZUlEID09IFwiS1wiIHx8IHBpZWNlSUQgPT0gXCJrXCIpIHtcclxuXHRcdFx0aWYgKFxyXG5cdFx0XHRcdChyb3dEaWZmZXJlbmNlID49IDAgfHwgY29sRGlmZmVyZW5jZSA+PSAwKSAmJlxyXG5cdFx0XHRcdHJvd0RpZmZlcmVuY2UgPD0gMSAmJlxyXG5cdFx0XHRcdGNvbERpZmZlcmVuY2UgPD0gMVxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9ZWxzZXtcclxuXHRcdFx0XHRpZihwaWVjZUlEID09IFwiS1wiICYmIGNsaWNrZWRSb3dUYXJnZXQgPT0gNyAmJiBjbGlja2VkQ29sVGFyZ2V0ID09IDYgJiYgYm9hcmRbN11bN10gPT0gXCJSXCIgJiYgYm9hcmRbNl1bN10gPT0gXCJcIiAmJiBib2FyZFs1XVs3XSA9PSBcIlwiKXtcclxuXHRcdFx0XHRcdGJvYXJkWzZdWzddID0gXCJLXCJcclxuXHRcdFx0XHRcdGJvYXJkWzVdWzddID0gXCJSXCJcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0ZHJhd1BpZWNlKFwiV2tpbmdcIiwgNiAqIHRpbGVTaXplLCA3ICogdGlsZVNpemUpO1xyXG5cdFx0XHRcdFx0ZHJhd1BpZWNlKFwiV3Jvb2tcIiwgNSAqIHRpbGVTaXplLCA3ICogdGlsZVNpemUpO1xyXG5cclxuXHRcdFx0XHRcdGJvYXJkWzddWzddID0gXCJcIjtcclxuXHRcdFx0XHRcdGJvYXJkWzRdWzddID0gXCJcIjtcclxuXHJcblx0XHRcdFx0XHRkcmF3Qm9hcmRBbmRQaWVjZXMoZ2FtZUJvYXJkU2l6ZSk7XHJcblx0XHRcdFx0XHR3aGl0ZXNNb3ZlID0gIXdoaXRlc01vdmU7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHR9ZWxzZSBpZihwaWVjZUlEID09IFwiS1wiICYmIGNsaWNrZWRSb3dUYXJnZXQgPT0gNyAmJiBjbGlja2VkQ29sVGFyZ2V0ID09IDIgJiYgYm9hcmRbMF1bN10gPT0gXCJSXCIgJiYgYm9hcmRbMV1bN10gPT0gXCJcIiAmJiBib2FyZFsyXVs3XSA9PSBcIlwiICYmIGJvYXJkWzNdWzddID09IFwiXCIpe1xyXG5cdFx0XHRcdFx0Ym9hcmRbMl1bN10gPSBcIktcIlxyXG5cdFx0XHRcdFx0Ym9hcmRbM11bN10gPSBcIlJcIlxyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRkcmF3UGllY2UoXCJXa2luZ1wiLCAyICogdGlsZVNpemUsIDcgKiB0aWxlU2l6ZSk7XHJcblx0XHRcdFx0XHRkcmF3UGllY2UoXCJXcm9va1wiLCAzICogdGlsZVNpemUsIDcgKiB0aWxlU2l6ZSk7XHJcblxyXG5cdFx0XHRcdFx0Ym9hcmRbMF1bN10gPSBcIlwiO1xyXG5cdFx0XHRcdFx0Ym9hcmRbNF1bN10gPSBcIlwiO1xyXG5cclxuXHRcdFx0XHRcdGRyYXdCb2FyZEFuZFBpZWNlcyhnYW1lQm9hcmRTaXplKTtcclxuXHRcdFx0XHRcdHdoaXRlc01vdmUgPSAhd2hpdGVzTW92ZTtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBRdWVlbnNcclxuXHRcdH0gZWxzZSBpZiAocGllY2VJRCA9PSBcIlFcIiB8fCBwaWVjZUlEID09IFwicVwiKSB7XHJcblx0XHRcdGlmIChyb3dEaWZmZXJlbmNlID09IDAgfHwgY29sRGlmZmVyZW5jZSA9PSAwKSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIGlmIChjb2xEaWZmZXJlbmNlID09IHJvd0RpZmZlcmVuY2UpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxuY29uc3QgbW92ZVBpZWNlID0gKHNlbGVjdGVkUGllY2UsIENSLCBDQykgPT4ge1xyXG5cdGxldCBtb3ZlZFBpZWNlO1xyXG5cclxuXHRjb25zdCB3aGljaFBpZWNlID0gKHBpZWNlSUQpID0+IHtcclxuXHRcdGlmIChzZWxlY3RlZFBpZWNlID09IHBpZWNlSUQpIHtcclxuXHRcdFx0Ym9hcmQuZm9yRWFjaCgoY2xpY2tlZFJvdywgaSkgPT4ge1xyXG5cdFx0XHRcdGNsaWNrZWRSb3cuZm9yRWFjaCgoY2xpY2tlZENvbCwgaikgPT4ge1xyXG5cdFx0XHRcdFx0aWYgKGNsaWNrZWRDb2wgPT0gcGllY2VJRCAmJiBDUiA9PSBqICYmIENDID09IGkpIHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgbWFrZU1vdmUgPSAoZXZlbnQpID0+IHtcclxuXHRcdFx0XHRcdFx0XHRsZXQgeCA9IGV2ZW50Lm9mZnNldFg7XHJcblx0XHRcdFx0XHRcdFx0bGV0IHkgPSBldmVudC5vZmZzZXRZO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRjb25zdCBjbGlja2VkUm93VGFyZ2V0ID0gTWF0aC5mbG9vcih5IC8gdGlsZVNpemUpO1xyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGNsaWNrZWRDb2xUYXJnZXQgPSBNYXRoLmZsb29yKHggLyB0aWxlU2l6ZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGRyYXdQaWVjZU9uVGFyZ2V0ID0gKCkgPT4ge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gaWYgKGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdID09IFwiXCIgfHwgd2hpdGVQaWVjZSA9PSB0cnVlIHx8IHdoaXRlUGllY2UgPT0gZmFsc2UpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdID0gY2xpY2tlZENvbDtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRtb3ZlZFBpZWNlID0gYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF07XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0ZHJhd1BpZWNlKFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRwaWVjZU5hbWVzW21vdmVkUGllY2VdLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRjbGlja2VkQ29sVGFyZ2V0ICogdGlsZVNpemUsXHJcblx0XHRcdFx0XHRcdFx0XHRcdGNsaWNrZWRSb3dUYXJnZXQgKiB0aWxlU2l6ZVxyXG5cdFx0XHRcdFx0XHRcdFx0KTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRib2FyZFtDQ11bQ1JdID0gXCJcIjtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRkcmF3Qm9hcmRBbmRQaWVjZXMoZ2FtZUJvYXJkU2l6ZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0d2hpdGVzTW92ZSA9ICF3aGl0ZXNNb3ZlO1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gfVxyXG5cdFx0XHRcdFx0XHRcdH07XHJcblxyXG5cdFx0XHRcdFx0XHRcdGdhbWVCb2FyZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRjaGVja1J1bGVzKFxyXG5cdFx0XHRcdFx0XHRcdFx0cGllY2VJRCxcclxuXHRcdFx0XHRcdFx0XHRcdGNsaWNrZWRSb3dUYXJnZXQsXHJcblx0XHRcdFx0XHRcdFx0XHRjbGlja2VkQ29sVGFyZ2V0LFxyXG5cdFx0XHRcdFx0XHRcdFx0Q1IsXHJcblx0XHRcdFx0XHRcdFx0XHRDQyxcclxuXHRcdFx0XHRcdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0LFxyXG5cdFx0XHRcdFx0XHRcdFx0bWFrZU1vdmVcclxuXHRcdFx0XHRcdFx0XHQpO1xyXG5cdFx0XHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHRcdFx0Z2FtZUJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGlmICh3aGl0ZXNNb3ZlKSB7XHJcblx0XHRmb3IgKGxldCBwaWVjZUlEIGluIHdoaXRlUGllY2VzSUQpIHtcclxuXHRcdFx0aWYgKHBpZWNlSUQgPT0gc2VsZWN0ZWRQaWVjZSkge1xyXG5cdFx0XHRcdHdoaXRlUGllY2UgPSB0cnVlO1xyXG5cdFx0XHRcdHdoaWNoUGllY2UocGllY2VJRCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9IGVsc2Uge1xyXG5cdFx0Zm9yIChsZXQgcGllY2VJRCBpbiBibGFja1BpZWNlc0lEKSB7XHJcblx0XHRcdGlmIChwaWVjZUlEID09IHNlbGVjdGVkUGllY2UpIHtcclxuXHRcdFx0XHR3aGl0ZVBpZWNlID0gZmFsc2U7XHJcblx0XHRcdFx0d2hpY2hQaWVjZShwaWVjZUlEKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIHJlc2l6ZUNhbnZhcyk7XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCkgPT4ge1xyXG5cdGdhbWVCb2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgc2VsZWN0UGllY2UpO1xyXG5cdHJlc2l6ZUNhbnZhcygpO1xyXG59KTtcclxuIl19
