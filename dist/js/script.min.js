"use strict";var whitePiece,gameBoard=document.getElementById("gameBoard"),ctx=gameBoard.getContext("2d"),brownColor="#653c10",whiteColor="#dfc795",windowWidth=window.innerWidth,windowHeight=window.innerHeight,gameBoardSize=Math.min(windowWidth,windowHeight,600),board=[["r","p","","","","","P","R"],["n","p","","","","","P","N"],["b","p","","","","","P","B"],["q","p","","","","","P","Q"],["k","p","","","","","P","K"],["b","p","","","","","P","B"],["n","p","","","","","P","N"],["r","p","","","","","P","R"]],pieceNames={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking",P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},whitePiecesID={P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},blackPiecesID={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking"},tileSize=gameBoardSize/8,selectedPiece=null,whitesMove=!0,drawPiece=function(e,i,o){var a=new Image;a.src="./dist/img/".concat(e,".png"),a.onload=function(){ctx.drawImage(a,i,o,tileSize,tileSize)}},drawBoardAndPieces=function(e){for(var i=0,o=0;i<e;i+=tileSize,o++)for(var a=0,r=0;a<e;a+=tileSize,r++){ctx.fillStyle=o%2==0?r%2==0?whiteColor:brownColor:r%2==0?brownColor:whiteColor;var t=board[o][r];""!=t&&drawPiece(pieceNames[t],i,a),ctx.fillRect(i,a,tileSize,tileSize)}},resizeCanvas=function(){gameBoard.width=gameBoardSize,gameBoard.height=gameBoardSize,drawBoardAndPieces(gameBoardSize)},selectPiece=function(e){var i=e.offsetX,e=e.offsetY,o=Math.floor(e/tileSize),a=Math.floor(i/tileSize),e=Math.floor(e/tileSize),i=Math.floor(i/tileSize);selectedPiece=board[a][o],movePiece(selectedPiece,e,i)},checkRules=function(e,d,n,i,o,a,r){var t=Math.abs(i-d),c=Math.abs(o-n),l=!1;if(whitePiece)for(var s in whitePiecesID)s==board[n][d]&&(l=!0);else for(var w in blackPiecesID)w==board[n][d]&&(l=!0);if(1!=l)if("P"==e)6==i&&(d==i-1||d==i-2)&&o==n||d==i-1&&o==n||(o==n+1||o==n-1)&&""!=board[n][d]&&d<i?a():gameBoard.removeEventListener("click",r);else if("p"==e)1==i&&(d==i+1||d==i+2)&&o==n||d==i+1&&o==n||(o==n+1||o==n-1)&&""!=board[n][d]&&i<d?a():gameBoard.removeEventListener("click",r);else if("B"==e||"b"==e){if(c==t){for(var b=function(o){var e=Math.min(n+o,7),i=Math.abs(n-o),a=Math.min(d+o,7),r=Math.abs(d-o);{function t(e,i){"k"===board[e][i]&&1==whitesMove?(console.log("szachPrzezBialych"),console.log(o),console.log(whitesMove),drawPiece("kCHECK",e*tileSize,i*tileSize)):"K"===board[e][i]&&0==whitesMove&&(console.log("szachPrzezCzarnych"),console.log(o),console.log(whitesMove),drawPiece("KCHECK2",e*tileSize,i*tileSize))}""!==board[e][a]&&""!==board[i][r]&&""!==board[e][r]&&""!==board[i][a]||(t(e,a),t(i,r),t(e,r),t(i,a))}if(0==r)return"break";console.log(board[e][r])},h=1;h<=8;h++)if("break"===b(h))break;a()}}else"N"==e||"n"==e?(1==t&&2==c||2==t&&1==c)&&a():"R"==e||"r"==e?0!=t&&0!=c||a():"K"==e||"k"==e?(0<=t||0<=c)&&t<=1&&c<=1?a():"K"==e&&7==d&&6==n&&"R"==board[7][7]&&""==board[6][7]&&""==board[5][7]?(board[6][7]="K",board[5][7]="R",drawPiece("Wking",6*tileSize,7*tileSize),drawPiece("Wrook",5*tileSize,7*tileSize),board[7][7]="",board[4][7]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove):"K"==e&&7==d&&2==n&&"R"==board[0][7]&&""==board[1][7]&&""==board[2][7]&&""==board[3][7]?(board[2][7]="K",board[3][7]="R",drawPiece("Wking",2*tileSize,7*tileSize),drawPiece("Wrook",3*tileSize,7*tileSize),board[0][7]="",board[4][7]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove):"k"==e&&0==d&&6==n&&"r"==board[7][0]&&""==board[6][0]&&""==board[5][0]?(board[6][0]="k",board[5][0]="r",drawPiece("Bking",6*tileSize,0*tileSize),drawPiece("Brook",5*tileSize,0*tileSize),board[7][0]="",board[4][0]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove):"k"==e&&0==d&&2==n&&"r"==board[0][0]&&""==board[1][0]&&""==board[2][0]&&""==board[3][0]&&(board[2][0]="k",board[3][0]="r",drawPiece("Bking",2*tileSize,0*tileSize),drawPiece("Brook",3*tileSize,0*tileSize),board[0][0]="",board[4][0]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove):"Q"!=e&&"q"!=e||0!=t&&0!=c&&c!=t||a()},movePiece=function(e,n,c){function i(d){e==d&&board.forEach(function(e,i){e.forEach(function(t,e){t==d&&n==e&&c==i&&gameBoard.addEventListener("click",function e(i){var o=i.offsetX,i=i.offsetY,a=Math.floor(i/tileSize),r=Math.floor(o/tileSize);gameBoard.removeEventListener("click",e),checkRules(d,a,r,n,c,function(){board[r][a]=t,l=board[r][a],drawPiece(pieceNames[l],r*tileSize,a*tileSize),board[c][n]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove},e)})})})}var l;if(whitesMove)for(var o in whitePiecesID)o==e&&(whitePiece=!0,i(o));else for(var a in blackPiecesID)a==e&&(whitePiece=!1,i(a))};window.addEventListener("resize",resizeCanvas),window.addEventListener("load",function(){gameBoard.addEventListener("click",selectPiece),resizeCanvas()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJ3aGl0ZVBpZWNlIiwiZ2FtZUJvYXJkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImN0eCIsImdldENvbnRleHQiLCJicm93bkNvbG9yIiwid2luZG93IiwiaW5uZXJXaWR0aCIsIndoaXRlQ29sb3IiLCJpbm5lckhlaWdodCIsIndpbmRvd1dpZHRoIiwid2luZG93SGVpZ2h0IiwiZ2FtZUJvYXJkU2l6ZSIsIk1hdGgiLCJib2FyZCIsInBpZWNlTmFtZXMiLCJwIiwiciIsIm4iLCJiIiwicSIsImsiLCJ3aGl0ZVBpZWNlc0lEIiwiUCIsIlIiLCJOIiwiQiIsIlEiLCJLIiwidGlsZVNpemUiLCJkcmF3UGllY2UiLCJpbWciLCJzZWxlY3RlZFBpZWNlIiwibCIsIndoaXRlc01vdmUiLCJwaWVjZU5hbWUiLCJ4IiwieSIsImZpbGxTdHlsZSIsInNyYyIsImNvbmNhdCIsIm9ubG9hZCIsImRyYXdJbWFnZSIsImRyYXdCb2FyZEFuZFBpZWNlcyIsInBpZWNlIiwiaiIsImkiLCJ3aWR0aCIsImNsaWNrZWRSb3ciLCJmbG9vciIsIkNSIiwiZmlsbFJlY3QiLCJwaWVjZUlEIiwic2VsZWN0UGllY2UiLCJldmVudCIsImNsaWNrZWRDb2wiLCJ3cm9uZ1Rha2UiLCJDQyIsImNsaWNrZWRSb3dUYXJnZXQiLCJtb3ZlUGllY2UiLCJjaGVja1J1bGVzIiwiZHJhd1BpZWNlT25UYXJnZXQiLCJjbGlja2VkQ29sVGFyZ2V0IiwibWFrZU1vdmUiLCJyb3dEaWZmZXJlbmNlIiwiY29sRGlmZmVyZW5jZSIsImFicyIsImRlY3JlbWVudGVkQ29sIiwiaW5jcmVtZW50ZWRSb3ciLCJkZWNyZW1lbnRlZFJvdyIsImNvbnNvbGUiLCJsb2ciLCJpbmNyZW1lbnRlZENvbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJfbG9vcCIsIm1pbiIsInJvdyIsImNvbCIsImNoZWNrUGllY2UiLCJmb3JFYWNoIiwib2Zmc2V0WCIsIm1vdmVkUGllY2UiLCJhZGRFdmVudExpc3RlbmVyIiwid2hpY2hQaWVjZSIsIm9mZnNldFkiLCJibGFja1BpZWNlc0lEIiwicmVzaXplQ2FudmFzIl0sIm1hcHBpbmdzIjoiYUFBQSxJQXVESUEsV0F2REVDLFVBQVlDLFNBQVNDLGVBQWUsV0FBVyxFQUMvQ0MsSUFBTUgsVUFBVUksV0FBVyxJQUFJLEVBRC9CSixXQUFZQyxVQUNaRSxXQUFlLFVBQ2ZFLFlBQWFDLE9BQVNDLFdBQ3RCQyxhQUFhRixPQUFTRyxZQUN0QkMsY0FBY0osS0FBT0MsSUFBQUEsWUFBVUksYUFBQSxHQUFBLEVBQy9CQSxNQUFBQSxDQUNOLENBQUEsSUFBTUMsSUFBQUEsR0FBQUEsR0FBZ0JDLEdBQUksR0FBSSxJQUFDSCxLQUMvQixDQUFBLElBQU1JLElBQVEsR0FDWixHQUFLLEdBQUssR0FBSSxJQUFJLEtBVXBCLENBQUEsSUFBTUMsSUFBQUEsR0FBVSxHQUFHLEdBQUEsR0FBQSxJQUFBLEtBUGxCLENBUUFDLElBQUcsSUFBTyxHQUFBLEdBQUEsR0FBQSxHQUFBLElBQUEsS0FQVixDQVFBQyxJQUFHLElBQU8sR0FBQSxHQUFBLEdBQUEsR0FBQSxJQUFBLEtBUFYsQ0FRQUMsSUFBRyxJQUFBLEdBQVMsR0FBQSxHQUFBLEdBQUEsSUFBQSxLQVBaLENBUUFDLElBQUcsSUFBQSxHQUFTLEdBQUEsR0FBQSxHQUFBLElBQUEsS0FQWixDQVFBQyxJQUFHLElBQUEsR0FBUSxHQUFBLEdBQUEsR0FBQSxJQUFBLE1BSVJMLFdBQU8sQ0FSVkMsRUFTQyxRQVJEQyxFQVNDLFFBUkRDLEVBU0MsVUFSREMsRUFTQyxVQUNEQyxFQUFBLFNBRURDLEVBQU1DLFFBUkxDLEVBVUMsUUFUREMsRUFVQyxRQVREQyxFQVVDLFVBVERDLEVBVUMsVUFUREMsRUFVQyxTQUNEQyxFQUFBLE9BRUQsRUFFSU4sY0FBTyxDQVZWQyxFQVdDLFFBVkRDLEVBV0MsUUFWREMsRUFXQyxVQVZEQyxFQVdDLFVBQ0RDLEVBQUEsU0FFREMsRUFBSUMsT0FDSixFQUVJOUIsY0FBVSxDQUVkaUIsRUFBTWMsUUFaTGIsRUFhQSxRQVpBQyxFQWFBYSxVQVpBWixFQWNBWSxVQWJBWCxFQWNDakIsU0FiRGtCLEVBY0MsT0FDRixFQUdDUSxTQUFhakIsY0FBY0EsRUFDMUJvQixjQUFnQkMsS0FkZEMsV0FlUSxDQUFBLEVBWk5KLFVBZUssU0FBQUssRUFBQUMsRUFBQUMsR0FkVixJQUFNTixFQWVDLElBQUNPLE1BZFJQLEVBQUlRLElBZUQsY0FBQUMsT0FBQUwsRUFBQSxNQUFBLEVBYkhKLEVBQUlVLE9BZUksV0FkUHRDLElBQUl1QyxVQWVHSixFQUFBQSxFQUFTRCxFQUFHaEMsU0FBVXdCLFFBQUEsQ0FkOUIsQ0FDRCxFQWlCR2MsbUJBQUEsU0FBQS9CLEdBZEYsSUFnQkUsSUFBTWdDLEVBQUFBLEVBQUtDLEVBQUcvQixFQUFNK0IsRUFBSWpDLEVBQUNrQyxHQUFBakIsU0FBQWdCLENBQUEsR0FmMUIsSUFpQkMsSUFBSUQsRUFBSyxFQUFBWCxFQUFNLEVBQUVaLEVBQUFULEVBQUFTLEdBQUFRLFNBQUFJLENBQUEsR0FBQSxDQWRmOUIsSUFrQkNtQyxVQXBCQ08sRUFpQkhmLEdBQVMsRUFDVkcsRUFBQSxHQUFBLEVBRWN6QixXQUVoQkgsV0FJQUwsRUFBVStDLEdBQUssRUFDSW5DLFdBRW5CSixXQU1BLElBQU13QyxFQUFVbEMsTUFBTytCLEdBQUNJLEdBR1JBLElBQVZDLEdBQ05wQixVQUFXakIsV0FBWStCLEdBQUdmLEVBQVNSLENBQUEsRUFLbkNsQixJQUFBZ0QsU0FBQUwsRUFBQXpCLEVBQUFRLFNBQUFBLFFBQUEsQ0FFRCxDQXZCQSxFQW9DSzlCLGFBQVksV0FqQ2hCQyxVQWtDTStDLE1BQUlLLGNBakNWcEQsVUFrQ01vRCxPQUFPeEMsY0FqQ2IrQixtQkFrQ2UvQixhQUFJLENBakNwQixFQW9DRXlDLFlBQU0sU0FBQUMsR0FqQ1AsSUFrQ0NsQixFQUFLa0IsRUFBSUYsUUFqQ05mLEVBa0NGaUIsRUFBSUYsUUFFSkosRUFBQW5DLEtBQUFvQyxNQUFBWixFQUFBUixRQUFBLEVBQ0QwQixFQUFBMUMsS0FBQW9DLE1BQUFiLEVBQUFQLFFBQUEsRUFHRzJCLEVBQUFBLEtBQVNQLE1BQVFaLEVBQUVSLFFBQUEsRUFDdEI0QixFQUFBNUMsS0FBQW9DLE1BQUFiLEVBQUFQLFFBQUEsRUFqQ0RHLGNBb0NVbEIsTUFDTjRDLEdBQUFBLEdBbkNKQyxVQXVDRzNCLGNBQVUwQixFQUFBQSxDQUFBQSxDQXRDZCxFQUVNRSxXQTJDRkMsU0ExQ0hULEVBQ0FNLEVBQ0FJLEVBQ0FaLEVBQ0FPLEVBQ0FJLEVBQ0FFLEdBRUEsSUFBSUMsRUFnREVuRCxLQUFJaUQsSUFBQUEsRUFBQUEsQ0FBMEIsRUEvQ2hDRyxFQW1EREosS0FBaUJLLElBQUVULEVBQUFLLENBQUEsRUFsRGxCTixFQW1ESyxDQUFBLEVBakRULEdBQUl6RCxXQUNILElBQUssSUFBSXFELEtBQVc5QixjQW9EbkI4QixHQUFBdEMsTUFBQWdELEdBQUFKLEtBQ0RGLEVBQVdKLENBQUFBLFFBL0NYLElBQUssSUFtREZBLEtBQUllLGNBbERGZixHQW1ERWdCLE1BQUFBLEdBQTBCVixLQWxEL0JGLEVBbURLYSxDQUFBQSxHQTlDUixHQW9ET0MsR0FwREhkLEVBRUgsR0FvRE0xQixLQXBERnNCLEVBRUksR0FBTkYsSUFDQ1EsR0FvRFdhLEVBQU0sR0FBQWIsR0FBQVIsRUFBQSxJQW5EbEJPLEdBQU1LLEdBdURISixHQUFBUixFQUFBLEdBQUFPLEdBQUFLLElBakRGTCxHQUFNSyxFQXFETVUsR0FBQUEsR0FBZ0JILEVBQWUsSUFDZkQsSUFyRDdCdEQsTUFBTWdELEdBcURPSyxJQXBEYlQsRUFxREVSLEVBM0RGVyxFQW9ERyxFQTFDSDdELFVBNERLcUUsb0JBQW1CLFFBQUFOLENBQUEsT0FHdkIsR0FBQSxLQUFBWCxFQXZDMEIsR0FwQjNCRixJQUNDUSxHQW1CMEJSLEVBQUEsR0FvQ0RRLEdBQUFSLEVBQUEsSUF0RDFCTyxHQXNEZ0NLLEdBTWpDSixHQUFBUixFQUFBLEdBQUFPLEdBQUFLLElBdERFTCxHQTREREksRUFBbUIsR0FBQUosR0FBQUssRUFBQSxJQUNwQixJQTVEQ2hELE1BNEREZ0QsR0FBQUosSUFDQVIsRUE1RENRLEVBTkFHLEVBeURELEVBL0NDN0QsVUE0RER5RSxvQkFBQSxRQUFBVixDQUFBLE9BUUNGLEdBQUFBLEtBQUFBLEdBQW1CLEtBQUFULEdBL0RwQixHQWdFQ2EsR0FBSUQsRUFBQSxDQS9ESixJQStESSxJQUFBVSxFQUFBLFNBQUE1QixHQTlESCxJQUFJMEIsRUFnRVUzRCxLQUFHOEQsSUFBQWIsRUFBQWhCLEVBQUEsQ0FBQSxFQS9EYnFCLEVBZ0VVdEQsS0FBR3FELElBQUFKLEVBQUFoQixDQUFBLEVBL0Ric0IsRUFpRU12RCxLQUFVOEQsSUFBRzlDLEVBQWNBLEVBQVMsQ0FBQSxFQWhFMUN3QyxFQWlFTXhELEtBQVVxRCxJQUFHckMsRUFBY0EsQ0FBUSxFQTFDN0MsQ0ErQ0FjLFNBQUFBLEVBQUFBLEVBQW1CL0IsR0FDTHNCLE1BQWRBLE1BQUFBLEdBQVUwQyxJQUFjLEdBQUExQyxZQUV6Qm9DLFFBQU1DLElBQUduQixtQkFBa0JNLEVBbkV2QlksUUFvRUdDLElBQUl6QixDQUFDLEVBbkVSd0IsUUFvRUdDLElBQUlyQyxVQUFPLEVBbkVkSixVQXFFSEEsU0FBaUIrQyxFQUFNaEQsU0FBVytDLEVBQUcvQyxRQUFTLEdBQ3ZCQSxNQUF2QkMsTUFBVStDLEdBQU9ELElBQTZCLEdBQWIxQyxhQXBFOUJvQyxRQXNFR0MsSUFBSSxvQkFBTSxFQXJFYkQsUUFzRUdDLElBQUl6QixDQUFDLEVBckVSd0IsUUF1RUgzQixJQUFBQSxVQUFtQi9CLEVBdEVoQmtCLFVBdUVISSxVQUFjQSxFQUFVTCxTQUFBK0MsRUFBQS9DLFFBQUEsRUFyRXZCLENBcUZnQixLQTVFaEJmLE1BNEVEQSxHQUFpQnNELElBQ0EsS0E1RWhCdEQsTUE0RURBLEdBQWlCdUQsSUFFb0J4QyxLQTdFcENmLE1BNkVEZ0IsR0FBaUJ1QyxJQUNvQnhDLEtBN0VwQ2YsTUE2RURnQixHQUFpQnNDLEtBdkZoQlUsRUF5RURoRCxFQUF1QkQsQ0FBY0EsRUF4RXBDaUQsRUF5RURoRCxFQUF1QkQsQ0FBY0EsRUF4RXBDaUQsRUEwRU1OLEVBQVNILENBQUEsRUF6RWZTLEVBMEVNWCxFQUFTQyxDQUFBLEVBaEVoQixDQUVBLEdBZ0ZELEdBQUFDLEVBQUEsTUFBQSxRQTlFQ0MsUUFnRkZDLElBQUF6RCxNQUFBMEQsR0FBQUgsRUFBQSxDQUNELEVBdkRLakIsRUFBQUEsRUFBT04sR0FBSSxFQUFHQSxDQUFBLEdBQUlZLEdBQUFBLFVBQUFBLEVBQUFBLENBQUFBLEVBb0RyQixNQTVFQUcsRUFnRkdHLENBL0VKLENBQUEsS0FrRkNILEtBQUFBLEdBQW1CLEtBQUFULEdBRXJCLEdBQUFZLEdBQUEsR0FBQUMsR0FDRCxHQUFBRCxHQUFBLEdBQUFDLElBR0tOLEVBQVksRUFJQyxLQUFiM0IsR0FBMEIsS0FBVG9CLEVBQ04sR0FBZHRDLEdBQWlDLEdBQW5CbUQsR0FqRmJKLEVBa0ZXa0IsRUFHQXpCLEtBbEZGRixHQWtGZSxLQUFQNEIsR0FHUnRCLEdBbkZSTSxHQW1GZ0NmLEdBQXhCUyxJQWxGVE0sR0FtRlNGLEdBbEZURyxHQW9GU0osRUFsRlRBLEVBb0ZTLEVBSUwvQixLQXRGRHNCLEdBdUZhNkIsR0FESHZCLEdBRVc3QixHQUFuQmlDLEdBQ0FKLEtBRG1CN0IsTUFDbkI2QixHQUFBQSxJQUNBLElBRGdCNUMsTUFBR2UsR0FBUSxJQUMzQixJQUFBZixNQUFBLEdBQUEsSUF6RkpBLE1BQU0sR0FBRyxHQTJGTkEsSUExRkhBLE1BQU0sR0FBRyxHQTRGTjZCLElBMUZIYixVQUFVLFFBNkZQLEVBQUFELFNBQUEsRUFBQUEsUUFBQSxFQTVGSEMsVUE2RkcsUUFBQSxFQUFBRCxTQUFBLEVBQUFBLFFBQUEsRUEzRkhmLE1BQU0sR0E2RkpkLEdBQUFBLEdBNUZGYyxNQUFNLEdBOEZKOEMsR0FBQUEsR0E1RkZqQixtQkF1R1d1QyxhQUFBQSxFQXRHWGhELFdBdUdBLENBQUFBLFlBRUEsS0FBQWtCLEdBQUEsR0FBQU0sR0FBQSxHQUFBSSxHQUFBLEtBQUFoRCxNQUFBLEdBQUEsSUFBQSxJQUFBQSxNQUFBLEdBQUEsSUFBQSxJQUFBQSxNQUFBLEdBQUEsSUFBQSxJQUFBQSxNQUFBLEdBQUEsSUFDSEEsTUFBQSxHQUFBLEdBQUEsSUFDQUEsTUFBQSxHQUFBLEdBQUEsSUFHQWdCLFVBQVNzQixRQUFXOUIsRUFBQUEsU0FBYSxFQUFFTyxRQUFBLEVBdkdoQ0MsVUF3R0VzQixRQUFXcEIsRUFBQUEsU0FBZSxFQUFBSCxRQUFBLEVBdEc1QmYsTUF3R0RxRSxHQUFBQSxHQUFXL0IsR0F2R1Z0QyxNQXdHRixHQUFBLEdBQUEsR0FFRDZCLG1CQUFNL0IsYUFBQSxFQUNOc0IsV0FBU2tCLENBQUFBLFlBRU0sS0FBYnJELEdBQWtCLEdBQUEyRCxHQUFBLEdBQUFJLEdBQUEsS0FBQWhELE1BQUEsR0FBQSxJQUFBLElBQUFBLE1BQUEsR0FBQSxJQUFBLElBQUFBLE1BQUEsR0FBQSxJQXZHakJBLE1Bd0dEcUUsR0FBQUEsR0FBVy9CLElBdkdWdEMsTUF3R0YsR0FBQSxHQUFBLElBRUZnQixVQUFBLFFBQUEsRUFBQUQsU0FBQSxFQUFBQSxRQUFBLEVBQ0FDLFVBQUEsUUFBQSxFQUFBRCxTQUFBLEVBQUFBLFFBQUEsRUFJRHZCLE1BQU80RSxHQUFBQSxHQUFBQSxHQUNObEYsTUFBUyxHQUFDa0YsR0FBQUEsR0FFVHZDLG1CQUFBL0IsYUFBQSxFQXpHR3NCLFdBQWEsQ0FBQ0EsWUFFSyxLQUFYa0IsR0FBc0MsR0FBcEJNLEdBQTZDLEdBQXBCSSxHQUF3QyxLQUFmaEQsTUFBTSxHQUFHLElBQTRCLElBQWZBLE1BQU0sR0FBRyxJQUEyQixJQUFmQSxNQUFNLEdBQUcsSUFBMkIsSUFBZkEsTUFBTSxHQUFHLEtBQ3JKQSxNQUFNLEdBQUcsR0FBSyxJQUNkQSxNQUFNLEdBQUcsR0FBSyxJQUVkZ0IsVUFBVSxRQUFTLEVBQUlELFNBQVUsRUFBSUEsUUFBUSxFQUM3Q0MsVUFBVSxRQUFTLEVBQUlELFNBQVUsRUFBSUEsUUFBUSxFQUU3Q2YsTUFBTSxHQUFHLEdBQUssR0FDZEEsTUFBTSxHQUFHLEdBQUssR0FFZDZCLG1CQUFtQi9CLGFBQWEsRUFDaENzQixXQUFhLENBQUNBLFlBS0ssS0FBWGtCLEdBQTZCLEtBQVhBLEdBQ1AsR0FBakJZLEdBQXVDLEdBQWpCQyxHQUVmQSxHQUFpQkQsR0FDM0JILEVBQWlCLENBSXJCLEVBRU1GLFVBQVksU0FBQzNCLEVBQWVrQixFQUFJTyxHQUdsQixTQUFiMEIsRUFBYy9CLEdBQ2ZwQixHQUFpQm9CLEdBQ3BCdEMsTUFBTWlFLFFBQVEsU0FBQy9CLEVBQVlGLEdBQzFCRSxFQUFXK0IsUUFBUSxTQUFDeEIsRUFBWVYsR0FDM0JVLEdBQWNILEdBQVdGLEdBQU1MLEdBQUtZLEdBQU1YLEdBeUM3QzlDLFVBQVVrRixpQkFBaUIsUUF4Q1YsU0FBWG5CLEVBQVlULEdBQ2pCLElBQUlsQixFQUFJa0IsRUFBTTBCLFFBQ1YzQyxFQUFJaUIsRUFBTThCLFFBRVIxQixFQUFtQjdDLEtBQUtvQyxNQUFNWixFQUFJUixRQUFRLEVBQzFDaUMsRUFBbUJqRCxLQUFLb0MsTUFBTWIsRUFBSVAsUUFBUSxFQXNCaEQ3QixVQUFVeUUsb0JBQW9CLFFBQVNWLENBQVEsRUFFL0NILFdBQ0NSLEVBQ0FNLEVBQ0FJLEVBQ0FaLEVBQ0FPLEVBM0J5QixXQUV6QjNDLE1BQU1nRCxHQUFrQkosR0FBb0JILEVBRTVDMEIsRUFBYW5FLE1BQU1nRCxHQUFrQkosR0FFckM1QixVQUNDZixXQUFXa0UsR0FDWG5CLEVBQW1CakMsU0FDbkI2QixFQUFtQjdCLFFBQVEsRUFHNUJmLE1BQU0yQyxHQUFJUCxHQUFNLEdBRWhCUCxtQkFBbUIvQixhQUFhLEVBRWhDc0IsV0FBYSxDQUFDQSxVQUVmLEVBV0M2QixDQUFRLENBRVYsQ0FFNEMsQ0FFOUMsQ0FBQyxDQUNGLENBQUMsQ0FFSCxDQXBEQSxJQUFJa0IsRUFzREosR0FBSS9DLFdBQ0gsSUFBSyxJQUFJa0IsS0FBVzlCLGNBQ2Y4QixHQUFXcEIsSUFDZGpDLFdBQWEsQ0FBQSxFQUNib0YsRUFBVy9CLENBQU8sUUFJcEIsSUFBSyxJQUFJQSxLQUFXaUMsY0FDZmpDLEdBQVdwQixJQUNkakMsV0FBYSxDQUFBLEVBQ2JvRixFQUFXL0IsQ0FBTyxFQUl0QixFQUVBOUMsT0FBTzRFLGlCQUFpQixTQUFVSSxZQUFZLEVBRTlDaEYsT0FBTzRFLGlCQUFpQixPQUFRLFdBQy9CbEYsVUFBVWtGLGlCQUFpQixRQUFTN0IsV0FBVyxFQUMvQ2lDLGFBQVksQ0FDYixDQUFDIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBnYW1lQm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbWVCb2FyZFwiKTtcclxuY29uc3QgY3R4ID0gZ2FtZUJvYXJkLmdldENvbnRleHQoXCIyZFwiKTtcclxuY29uc3QgYnJvd25Db2xvciA9IFwiIzY1M2MxMFwiO1xyXG5jb25zdCB3aGl0ZUNvbG9yID0gXCIjZGZjNzk1XCI7XHJcbmNvbnN0IHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbmNvbnN0IHdpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuY29uc3QgZ2FtZUJvYXJkU2l6ZSA9IE1hdGgubWluKHdpbmRvd1dpZHRoLCB3aW5kb3dIZWlnaHQsIDYwMCk7XHJcbmNvbnN0IGJvYXJkID0gW1xyXG5cdFtcInJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIlJcIl0sXHJcblx0W1wiblwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiTlwiXSxcclxuXHRbXCJiXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJCXCJdLFxyXG5cdFtcInFcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIlFcIl0sXHJcblx0W1wia1wiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiS1wiXSxcclxuXHRbXCJiXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJCXCJdLFxyXG5cdFtcIm5cIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIk5cIl0sXHJcblx0W1wiclwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiUlwiXSxcclxuXTtcclxuXHJcbmNvbnN0IHBpZWNlTmFtZXMgPSB7XHJcblx0cDogXCJCcGF3blwiLFxyXG5cdHI6IFwiQnJvb2tcIixcclxuXHRuOiBcIkJrbmlnaHRcIixcclxuXHRiOiBcIkJiaXNob3BcIixcclxuXHRxOiBcIkJxdWVlblwiLFxyXG5cdGs6IFwiQmtpbmdcIixcclxuXHJcblx0UDogXCJXcGF3blwiLFxyXG5cdFI6IFwiV3Jvb2tcIixcclxuXHROOiBcIldrbmlnaHRcIixcclxuXHRCOiBcIldiaXNob3BcIixcclxuXHRROiBcIldxdWVlblwiLFxyXG5cdEs6IFwiV2tpbmdcIixcclxufTtcclxuXHJcbmNvbnN0IHdoaXRlUGllY2VzSUQgPSB7XHJcblx0UDogXCJXcGF3blwiLFxyXG5cdFI6IFwiV3Jvb2tcIixcclxuXHROOiBcIldrbmlnaHRcIixcclxuXHRCOiBcIldiaXNob3BcIixcclxuXHRROiBcIldxdWVlblwiLFxyXG5cdEs6IFwiV2tpbmdcIixcclxufTtcclxuXHJcbmNvbnN0IGJsYWNrUGllY2VzSUQgPSB7XHJcblx0cDogXCJCcGF3blwiLFxyXG5cdHI6IFwiQnJvb2tcIixcclxuXHRuOiBcIkJrbmlnaHRcIixcclxuXHRiOiBcIkJiaXNob3BcIixcclxuXHRxOiBcIkJxdWVlblwiLFxyXG5cdGs6IFwiQmtpbmdcIixcclxufTtcclxuXHJcbmxldCB0aWxlU2l6ZSA9IGdhbWVCb2FyZFNpemUgLyA4O1xyXG5sZXQgc2VsZWN0ZWRQaWVjZSA9IG51bGw7XHJcbmxldCB3aGl0ZXNNb3ZlID0gdHJ1ZTtcclxubGV0IHdoaXRlUGllY2U7XHJcblxyXG5jb25zdCBkcmF3UGllY2UgPSAocGllY2VOYW1lLCB4LCB5KSA9PiB7XHJcblx0Y29uc3QgaW1nID0gbmV3IEltYWdlKCk7XHJcblx0aW1nLnNyYyA9IGAuL2Rpc3QvaW1nLyR7cGllY2VOYW1lfS5wbmdgO1xyXG5cclxuXHRpbWcub25sb2FkID0gKCkgPT4ge1xyXG5cdFx0Y3R4LmRyYXdJbWFnZShpbWcsIHgsIHksIHRpbGVTaXplLCB0aWxlU2l6ZSk7XHJcblx0fTtcclxufTtcclxuXHJcbmNvbnN0IGRyYXdCb2FyZEFuZFBpZWNlcyA9IChnYW1lQm9hcmRTaXplKSA9PiB7XHJcblx0Zm9yIChsZXQgaSA9IDAsIGogPSAwOyBpIDwgZ2FtZUJvYXJkU2l6ZTsgaSArPSB0aWxlU2l6ZSwgaisrKSB7XHJcblx0XHRmb3IgKGxldCBrID0gMCwgbCA9IDA7IGsgPCBnYW1lQm9hcmRTaXplOyBrICs9IHRpbGVTaXplLCBsKyspIHtcclxuXHRcdFx0aWYgKGogJSAyID09PSAwKSB7XHJcblx0XHRcdFx0aWYgKGwgJSAyID09PSAwKSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gd2hpdGVDb2xvcjtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IGJyb3duQ29sb3I7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGlmIChsICUgMiA9PT0gMCkge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IGJyb3duQ29sb3I7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSB3aGl0ZUNvbG9yO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Y29uc3QgcGllY2UgPSBib2FyZFtqXVtsXTtcclxuXHJcblx0XHRcdGlmIChwaWVjZSAhPSBcIlwiKSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlKHBpZWNlTmFtZXNbcGllY2VdLCBpLCBrKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Y3R4LmZpbGxSZWN0KGksIGssIHRpbGVTaXplLCB0aWxlU2l6ZSk7XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxuY29uc3QgcmVzaXplQ2FudmFzID0gKCkgPT4ge1xyXG5cdGdhbWVCb2FyZC53aWR0aCA9IGdhbWVCb2FyZFNpemU7XHJcblx0Z2FtZUJvYXJkLmhlaWdodCA9IGdhbWVCb2FyZFNpemU7XHJcblx0ZHJhd0JvYXJkQW5kUGllY2VzKGdhbWVCb2FyZFNpemUpO1xyXG59O1xyXG5cclxuY29uc3Qgc2VsZWN0UGllY2UgPSAoZXZlbnQpID0+IHtcclxuXHRsZXQgeCA9IGV2ZW50Lm9mZnNldFg7XHJcblx0bGV0IHkgPSBldmVudC5vZmZzZXRZO1xyXG5cclxuXHRjb25zdCBjbGlja2VkUm93ID0gTWF0aC5mbG9vcih5IC8gdGlsZVNpemUpO1xyXG5cdGNvbnN0IGNsaWNrZWRDb2wgPSBNYXRoLmZsb29yKHggLyB0aWxlU2l6ZSk7XHJcblxyXG5cdGNvbnN0IENSID0gTWF0aC5mbG9vcih5IC8gdGlsZVNpemUpO1xyXG5cdGNvbnN0IENDID0gTWF0aC5mbG9vcih4IC8gdGlsZVNpemUpO1xyXG5cclxuXHRzZWxlY3RlZFBpZWNlID0gYm9hcmRbY2xpY2tlZENvbF1bY2xpY2tlZFJvd107XHJcblxyXG5cdG1vdmVQaWVjZShzZWxlY3RlZFBpZWNlLCBDUiwgQ0MpO1xyXG59O1xyXG5cclxuY29uc3QgY2hlY2tSdWxlcyA9IChcclxuXHRwaWVjZUlELFxyXG5cdGNsaWNrZWRSb3dUYXJnZXQsXHJcblx0Y2xpY2tlZENvbFRhcmdldCxcclxuXHRDUixcclxuXHRDQyxcclxuXHRkcmF3UGllY2VPblRhcmdldCxcclxuXHRtYWtlTW92ZVxyXG4pID0+IHtcclxuXHRsZXQgcm93RGlmZmVyZW5jZSA9IE1hdGguYWJzKENSIC0gY2xpY2tlZFJvd1RhcmdldCk7XHJcblx0bGV0IGNvbERpZmZlcmVuY2UgPSBNYXRoLmFicyhDQyAtIGNsaWNrZWRDb2xUYXJnZXQpO1xyXG5cdGxldCB3cm9uZ1Rha2UgPSBmYWxzZTtcclxuXHJcblx0aWYgKHdoaXRlUGllY2UpIHtcclxuXHRcdGZvciAobGV0IHBpZWNlSUQgaW4gd2hpdGVQaWVjZXNJRCkge1xyXG5cdFx0XHRpZiAocGllY2VJRCA9PSBib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSkge1xyXG5cdFx0XHRcdHdyb25nVGFrZSA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9IGVsc2Uge1xyXG5cdFx0Zm9yIChsZXQgcGllY2VJRCBpbiBibGFja1BpZWNlc0lEKSB7XHJcblx0XHRcdGlmIChwaWVjZUlEID09IGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdKSB7XHJcblx0XHRcdFx0d3JvbmdUYWtlID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0aWYgKHdyb25nVGFrZSAhPSB0cnVlKSB7XHJcblx0XHQvLyBQYXduc1xyXG5cdFx0aWYgKHBpZWNlSUQgPT0gXCJQXCIpIHtcclxuXHRcdFx0aWYgKFxyXG5cdFx0XHRcdENSID09IDYgJiZcclxuXHRcdFx0XHQoY2xpY2tlZFJvd1RhcmdldCA9PSBDUiAtIDEgfHwgY2xpY2tlZFJvd1RhcmdldCA9PSBDUiAtIDIpICYmXHJcblx0XHRcdFx0Q0MgPT0gY2xpY2tlZENvbFRhcmdldFxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgLSAxICYmIENDID09IGNsaWNrZWRDb2xUYXJnZXQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKFxyXG5cdFx0XHRcdChDQyA9PSBjbGlja2VkQ29sVGFyZ2V0ICsgMSB8fCBDQyA9PSBjbGlja2VkQ29sVGFyZ2V0IC0gMSkgJiZcclxuXHRcdFx0XHRib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSAhPSBcIlwiICYmXHJcblx0XHRcdFx0Y2xpY2tlZFJvd1RhcmdldCA8IENSXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Z2FtZUJvYXJkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSBpZiAocGllY2VJRCA9PSBcInBcIikge1xyXG5cdFx0XHRpZiAoXHJcblx0XHRcdFx0Q1IgPT0gMSAmJlxyXG5cdFx0XHRcdChjbGlja2VkUm93VGFyZ2V0ID09IENSICsgMSB8fCBjbGlja2VkUm93VGFyZ2V0ID09IENSICsgMikgJiZcclxuXHRcdFx0XHRDQyA9PSBjbGlja2VkQ29sVGFyZ2V0XHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSBpZiAoY2xpY2tlZFJvd1RhcmdldCA9PSBDUiArIDEgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSBpZiAoXHJcblx0XHRcdFx0KENDID09IGNsaWNrZWRDb2xUYXJnZXQgKyAxIHx8IENDID09IGNsaWNrZWRDb2xUYXJnZXQgLSAxKSAmJlxyXG5cdFx0XHRcdGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdICE9IFwiXCIgJiZcclxuXHRcdFx0XHRjbGlja2VkUm93VGFyZ2V0ID4gQ1JcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRnYW1lQm9hcmQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG1ha2VNb3ZlKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gQmlzaG9wc1xyXG5cdFx0fSBlbHNlIGlmIChwaWVjZUlEID09IFwiQlwiIHx8IHBpZWNlSUQgPT0gXCJiXCIpIHtcclxuXHRcdFx0aWYgKGNvbERpZmZlcmVuY2UgPT0gcm93RGlmZmVyZW5jZSkge1xyXG5cdFx0XHRcdGZvciAobGV0IGkgPSAxOyBpIDw9IDg7IGkrKykge1xyXG5cdFx0XHRcdFx0bGV0IGluY3JlbWVudGVkQ29sID0gTWF0aC5taW4oY2xpY2tlZENvbFRhcmdldCArIGksIDcpO1xyXG5cdFx0XHRcdFx0bGV0IGRlY3JlbWVudGVkQ29sID0gTWF0aC5hYnMoY2xpY2tlZENvbFRhcmdldCAtIGkpO1xyXG5cdFx0XHRcdFx0bGV0IGluY3JlbWVudGVkUm93ID0gTWF0aC5taW4oY2xpY2tlZFJvd1RhcmdldCArIGksIDcpO1xyXG5cdFx0XHRcdFx0bGV0IGRlY3JlbWVudGVkUm93ID0gTWF0aC5hYnMoY2xpY2tlZFJvd1RhcmdldCAtIGkpO1xyXG5cclxuXHRcdFx0XHRcdGNvbnN0IGlzQ2hlY2sgPSAoKSA9PiB7XHJcblx0XHRcdFx0XHRcdGNvbnN0IGNoZWNrUGllY2UgPSAoY29sLCByb3cpID0+IHtcclxuXHRcdFx0XHRcdFx0XHRpZiAoYm9hcmRbY29sXVtyb3ddID09PSBcImtcIiAmJiB3aGl0ZXNNb3ZlID09IHRydWUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwic3phY2hQcnplekJpYWx5Y2hcIik7XHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhpKTtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKHdoaXRlc01vdmUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0ZHJhd1BpZWNlKFwia0NIRUNLXCIsIGNvbCAqIHRpbGVTaXplLCByb3cgKiB0aWxlU2l6ZSk7XHJcblx0XHRcdFx0XHRcdFx0fWVsc2UgaWYoYm9hcmRbY29sXVtyb3ddID09PSBcIktcIiAmJiB3aGl0ZXNNb3ZlID09IGZhbHNlKXtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwic3phY2hQcnplekN6YXJueWNoXCIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coaSk7XHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyh3aGl0ZXNNb3ZlKTtcclxuXHRcdFx0XHRcdFx0XHRcdGRyYXdQaWVjZShcIktDSEVDSzJcIiwgY29sICogdGlsZVNpemUsIHJvdyAqIHRpbGVTaXplKTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH07XHJcblxyXG5cdFx0XHRcdFx0XHRjaGVja1BpZWNlKGluY3JlbWVudGVkQ29sLCBpbmNyZW1lbnRlZFJvdyk7XHJcblx0XHRcdFx0XHRcdGNoZWNrUGllY2UoZGVjcmVtZW50ZWRDb2wsIGRlY3JlbWVudGVkUm93KTtcclxuXHRcdFx0XHRcdFx0Y2hlY2tQaWVjZShpbmNyZW1lbnRlZENvbCwgZGVjcmVtZW50ZWRSb3cpO1xyXG5cdFx0XHRcdFx0XHRjaGVja1BpZWNlKGRlY3JlbWVudGVkQ29sLCBpbmNyZW1lbnRlZFJvdyk7XHJcblx0XHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHRcdGlmIChcclxuXHRcdFx0XHRcdFx0Ym9hcmRbaW5jcmVtZW50ZWRDb2xdW2luY3JlbWVudGVkUm93XSA9PT0gXCJcIiB8fFxyXG5cdFx0XHRcdFx0XHRib2FyZFtkZWNyZW1lbnRlZENvbF1bZGVjcmVtZW50ZWRSb3ddID09PSBcIlwiIHx8XHJcblx0XHRcdFx0XHRcdGJvYXJkW2luY3JlbWVudGVkQ29sXVtkZWNyZW1lbnRlZFJvd10gPT09IFwiXCIgfHxcclxuXHRcdFx0XHRcdFx0Ym9hcmRbZGVjcmVtZW50ZWRDb2xdW2luY3JlbWVudGVkUm93XSA9PT0gXCJcIlxyXG5cdFx0XHRcdFx0KSB7XHJcblx0XHRcdFx0XHRcdGlzQ2hlY2soKTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRpZiAoZGVjcmVtZW50ZWRSb3cgPT0gMCkgYnJlYWs7XHJcblxyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2coYm9hcmRbaW5jcmVtZW50ZWRDb2xdW2RlY3JlbWVudGVkUm93XSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gS25pZ2h0c1xyXG5cdFx0fSBlbHNlIGlmIChwaWVjZUlEID09IFwiTlwiIHx8IHBpZWNlSUQgPT0gXCJuXCIpIHtcclxuXHRcdFx0aWYgKFxyXG5cdFx0XHRcdChyb3dEaWZmZXJlbmNlID09IDEgJiYgY29sRGlmZmVyZW5jZSA9PSAyKSB8fFxyXG5cdFx0XHRcdChyb3dEaWZmZXJlbmNlID09IDIgJiYgY29sRGlmZmVyZW5jZSA9PSAxKVxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vIFJvb2tzXHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJSXCIgfHwgcGllY2VJRCA9PSBcInJcIikge1xyXG5cdFx0XHRpZiAocm93RGlmZmVyZW5jZSA9PSAwIHx8IGNvbERpZmZlcmVuY2UgPT0gMCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gS2luZ3NcclxuXHRcdH0gZWxzZSBpZiAocGllY2VJRCA9PSBcIktcIiB8fCBwaWVjZUlEID09IFwia1wiKSB7XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHQocm93RGlmZmVyZW5jZSA+PSAwIHx8IGNvbERpZmZlcmVuY2UgPj0gMCkgJiZcclxuXHRcdFx0XHRyb3dEaWZmZXJlbmNlIDw9IDEgJiZcclxuXHRcdFx0XHRjb2xEaWZmZXJlbmNlIDw9IDFcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fWVsc2V7XHJcblx0XHRcdFx0aWYocGllY2VJRCA9PSBcIktcIiAmJiBjbGlja2VkUm93VGFyZ2V0ID09IDcgJiYgY2xpY2tlZENvbFRhcmdldCA9PSA2ICYmIGJvYXJkWzddWzddID09IFwiUlwiICYmIGJvYXJkWzZdWzddID09IFwiXCIgJiYgYm9hcmRbNV1bN10gPT0gXCJcIil7XHJcblx0XHRcdFx0XHRib2FyZFs2XVs3XSA9IFwiS1wiXHJcblx0XHRcdFx0XHRib2FyZFs1XVs3XSA9IFwiUlwiXHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdGRyYXdQaWVjZShcIldraW5nXCIsIDYgKiB0aWxlU2l6ZSwgNyAqIHRpbGVTaXplKTtcclxuXHRcdFx0XHRcdGRyYXdQaWVjZShcIldyb29rXCIsIDUgKiB0aWxlU2l6ZSwgNyAqIHRpbGVTaXplKTtcclxuXHJcblx0XHRcdFx0XHRib2FyZFs3XVs3XSA9IFwiXCI7XHJcblx0XHRcdFx0XHRib2FyZFs0XVs3XSA9IFwiXCI7XHJcblxyXG5cdFx0XHRcdFx0ZHJhd0JvYXJkQW5kUGllY2VzKGdhbWVCb2FyZFNpemUpO1xyXG5cdFx0XHRcdFx0d2hpdGVzTW92ZSA9ICF3aGl0ZXNNb3ZlO1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0fWVsc2UgaWYocGllY2VJRCA9PSBcIktcIiAmJiBjbGlja2VkUm93VGFyZ2V0ID09IDcgJiYgY2xpY2tlZENvbFRhcmdldCA9PSAyICYmIGJvYXJkWzBdWzddID09IFwiUlwiICYmIGJvYXJkWzFdWzddID09IFwiXCIgJiYgYm9hcmRbMl1bN10gPT0gXCJcIiAmJiBib2FyZFszXVs3XSA9PSBcIlwiKXtcclxuXHRcdFx0XHRcdGJvYXJkWzJdWzddID0gXCJLXCJcclxuXHRcdFx0XHRcdGJvYXJkWzNdWzddID0gXCJSXCJcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0ZHJhd1BpZWNlKFwiV2tpbmdcIiwgMiAqIHRpbGVTaXplLCA3ICogdGlsZVNpemUpO1xyXG5cdFx0XHRcdFx0ZHJhd1BpZWNlKFwiV3Jvb2tcIiwgMyAqIHRpbGVTaXplLCA3ICogdGlsZVNpemUpO1xyXG5cclxuXHRcdFx0XHRcdGJvYXJkWzBdWzddID0gXCJcIjtcclxuXHRcdFx0XHRcdGJvYXJkWzRdWzddID0gXCJcIjtcclxuXHJcblx0XHRcdFx0XHRkcmF3Qm9hcmRBbmRQaWVjZXMoZ2FtZUJvYXJkU2l6ZSk7XHJcblx0XHRcdFx0XHR3aGl0ZXNNb3ZlID0gIXdoaXRlc01vdmU7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHR9ZWxzZSBpZihwaWVjZUlEID09IFwia1wiICYmIGNsaWNrZWRSb3dUYXJnZXQgPT0gMCAmJiBjbGlja2VkQ29sVGFyZ2V0ID09IDYgJiYgYm9hcmRbN11bMF0gPT0gXCJyXCIgJiYgYm9hcmRbNl1bMF0gPT0gXCJcIiAmJiBib2FyZFs1XVswXSA9PSBcIlwiKXtcclxuXHRcdFx0XHRcdGJvYXJkWzZdWzBdID0gXCJrXCJcclxuXHRcdFx0XHRcdGJvYXJkWzVdWzBdID0gXCJyXCJcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0ZHJhd1BpZWNlKFwiQmtpbmdcIiwgNiAqIHRpbGVTaXplLCAwICogdGlsZVNpemUpO1xyXG5cdFx0XHRcdFx0ZHJhd1BpZWNlKFwiQnJvb2tcIiwgNSAqIHRpbGVTaXplLCAwICogdGlsZVNpemUpO1xyXG5cclxuXHRcdFx0XHRcdGJvYXJkWzddWzBdID0gXCJcIjtcclxuXHRcdFx0XHRcdGJvYXJkWzRdWzBdID0gXCJcIjtcclxuXHJcblx0XHRcdFx0XHRkcmF3Qm9hcmRBbmRQaWVjZXMoZ2FtZUJvYXJkU2l6ZSk7XHJcblx0XHRcdFx0XHR3aGl0ZXNNb3ZlID0gIXdoaXRlc01vdmU7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHR9ZWxzZSBpZihwaWVjZUlEID09IFwia1wiICYmIGNsaWNrZWRSb3dUYXJnZXQgPT0gMCAmJiBjbGlja2VkQ29sVGFyZ2V0ID09IDIgJiYgYm9hcmRbMF1bMF0gPT0gXCJyXCIgJiYgYm9hcmRbMV1bMF0gPT0gXCJcIiAmJiBib2FyZFsyXVswXSA9PSBcIlwiICYmIGJvYXJkWzNdWzBdID09IFwiXCIpe1xyXG5cdFx0XHRcdFx0Ym9hcmRbMl1bMF0gPSBcImtcIlxyXG5cdFx0XHRcdFx0Ym9hcmRbM11bMF0gPSBcInJcIlxyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRkcmF3UGllY2UoXCJCa2luZ1wiLCAyICogdGlsZVNpemUsIDAgKiB0aWxlU2l6ZSk7XHJcblx0XHRcdFx0XHRkcmF3UGllY2UoXCJCcm9va1wiLCAzICogdGlsZVNpemUsIDAgKiB0aWxlU2l6ZSk7XHJcblxyXG5cdFx0XHRcdFx0Ym9hcmRbMF1bMF0gPSBcIlwiO1xyXG5cdFx0XHRcdFx0Ym9hcmRbNF1bMF0gPSBcIlwiO1xyXG5cclxuXHRcdFx0XHRcdGRyYXdCb2FyZEFuZFBpZWNlcyhnYW1lQm9hcmRTaXplKTtcclxuXHRcdFx0XHRcdHdoaXRlc01vdmUgPSAhd2hpdGVzTW92ZTtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBRdWVlbnNcclxuXHRcdH0gZWxzZSBpZiAocGllY2VJRCA9PSBcIlFcIiB8fCBwaWVjZUlEID09IFwicVwiKSB7XHJcblx0XHRcdGlmIChyb3dEaWZmZXJlbmNlID09IDAgfHwgY29sRGlmZmVyZW5jZSA9PSAwKSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIGlmIChjb2xEaWZmZXJlbmNlID09IHJvd0RpZmZlcmVuY2UpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxuY29uc3QgbW92ZVBpZWNlID0gKHNlbGVjdGVkUGllY2UsIENSLCBDQykgPT4ge1xyXG5cdGxldCBtb3ZlZFBpZWNlO1xyXG5cclxuXHRjb25zdCB3aGljaFBpZWNlID0gKHBpZWNlSUQpID0+IHtcclxuXHRcdGlmIChzZWxlY3RlZFBpZWNlID09IHBpZWNlSUQpIHtcclxuXHRcdFx0Ym9hcmQuZm9yRWFjaCgoY2xpY2tlZFJvdywgaSkgPT4ge1xyXG5cdFx0XHRcdGNsaWNrZWRSb3cuZm9yRWFjaCgoY2xpY2tlZENvbCwgaikgPT4ge1xyXG5cdFx0XHRcdFx0aWYgKGNsaWNrZWRDb2wgPT0gcGllY2VJRCAmJiBDUiA9PSBqICYmIENDID09IGkpIHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgbWFrZU1vdmUgPSAoZXZlbnQpID0+IHtcclxuXHRcdFx0XHRcdFx0XHRsZXQgeCA9IGV2ZW50Lm9mZnNldFg7XHJcblx0XHRcdFx0XHRcdFx0bGV0IHkgPSBldmVudC5vZmZzZXRZO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRjb25zdCBjbGlja2VkUm93VGFyZ2V0ID0gTWF0aC5mbG9vcih5IC8gdGlsZVNpemUpO1xyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGNsaWNrZWRDb2xUYXJnZXQgPSBNYXRoLmZsb29yKHggLyB0aWxlU2l6ZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGRyYXdQaWVjZU9uVGFyZ2V0ID0gKCkgPT4ge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gaWYgKGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdID09IFwiXCIgfHwgd2hpdGVQaWVjZSA9PSB0cnVlIHx8IHdoaXRlUGllY2UgPT0gZmFsc2UpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdID0gY2xpY2tlZENvbDtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRtb3ZlZFBpZWNlID0gYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF07XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0ZHJhd1BpZWNlKFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRwaWVjZU5hbWVzW21vdmVkUGllY2VdLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRjbGlja2VkQ29sVGFyZ2V0ICogdGlsZVNpemUsXHJcblx0XHRcdFx0XHRcdFx0XHRcdGNsaWNrZWRSb3dUYXJnZXQgKiB0aWxlU2l6ZVxyXG5cdFx0XHRcdFx0XHRcdFx0KTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRib2FyZFtDQ11bQ1JdID0gXCJcIjtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRkcmF3Qm9hcmRBbmRQaWVjZXMoZ2FtZUJvYXJkU2l6ZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0d2hpdGVzTW92ZSA9ICF3aGl0ZXNNb3ZlO1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gfVxyXG5cdFx0XHRcdFx0XHRcdH07XHJcblxyXG5cdFx0XHRcdFx0XHRcdGdhbWVCb2FyZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRjaGVja1J1bGVzKFxyXG5cdFx0XHRcdFx0XHRcdFx0cGllY2VJRCxcclxuXHRcdFx0XHRcdFx0XHRcdGNsaWNrZWRSb3dUYXJnZXQsXHJcblx0XHRcdFx0XHRcdFx0XHRjbGlja2VkQ29sVGFyZ2V0LFxyXG5cdFx0XHRcdFx0XHRcdFx0Q1IsXHJcblx0XHRcdFx0XHRcdFx0XHRDQyxcclxuXHRcdFx0XHRcdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0LFxyXG5cdFx0XHRcdFx0XHRcdFx0bWFrZU1vdmVcclxuXHRcdFx0XHRcdFx0XHQpO1xyXG5cdFx0XHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHRcdFx0Z2FtZUJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGlmICh3aGl0ZXNNb3ZlKSB7XHJcblx0XHRmb3IgKGxldCBwaWVjZUlEIGluIHdoaXRlUGllY2VzSUQpIHtcclxuXHRcdFx0aWYgKHBpZWNlSUQgPT0gc2VsZWN0ZWRQaWVjZSkge1xyXG5cdFx0XHRcdHdoaXRlUGllY2UgPSB0cnVlO1xyXG5cdFx0XHRcdHdoaWNoUGllY2UocGllY2VJRCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9IGVsc2Uge1xyXG5cdFx0Zm9yIChsZXQgcGllY2VJRCBpbiBibGFja1BpZWNlc0lEKSB7XHJcblx0XHRcdGlmIChwaWVjZUlEID09IHNlbGVjdGVkUGllY2UpIHtcclxuXHRcdFx0XHR3aGl0ZVBpZWNlID0gZmFsc2U7XHJcblx0XHRcdFx0d2hpY2hQaWVjZShwaWVjZUlEKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIHJlc2l6ZUNhbnZhcyk7XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCkgPT4ge1xyXG5cdGdhbWVCb2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgc2VsZWN0UGllY2UpO1xyXG5cdHJlc2l6ZUNhbnZhcygpO1xyXG59KTtcclxuIl19
