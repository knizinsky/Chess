"use strict";var whitePiece,gameBoard=document.getElementById("gameBoard"),ctx=gameBoard.getContext("2d"),brownColor="#653c10",whiteColor="#dfc795",windowWidth=window.innerWidth,windowHeight=window.innerHeight,gameBoardSize=Math.min(windowWidth,windowHeight,600),board=[["r","p","","","","","P","R"],["n","p","","","","","P","N"],["b","p","","","","","P","B"],["q","p","","","","","P","Q"],["k","p","","","","","P","K"],["b","p","","","","","P","B"],["n","p","","","","","P","N"],["r","p","","","","","P","R"]],pieceNames={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking",P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},whitePiecesID={P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},blackPiecesID={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking"},tileSize=gameBoardSize/8,selectedPiece=null,whitesMove=!0,drawPiece=function(e,i,o){var a=new Image;a.src="./dist/img/".concat(e,".png"),a.onload=function(){ctx.drawImage(a,i,o,tileSize,tileSize)}},drawBoardAndPieces=function(e){for(var i=0,o=0;i<e;i+=tileSize,o++)for(var a=0,t=0;a<e;a+=tileSize,t++){ctx.fillStyle=o%2==0?t%2==0?whiteColor:brownColor:t%2==0?brownColor:whiteColor;var r=board[o][t];""!=r&&drawPiece(pieceNames[r],i,a),ctx.fillRect(i,a,tileSize,tileSize)}},resizeCanvas=function(){gameBoard.width=gameBoardSize,gameBoard.height=gameBoardSize,drawBoardAndPieces(gameBoardSize)},selectPiece=function(e){var i=e.offsetX,e=e.offsetY,o=Math.floor(e/tileSize),a=Math.floor(i/tileSize),e=Math.floor(e/tileSize),i=Math.floor(i/tileSize);selectedPiece=board[a][o],movePiece(selectedPiece,e,i)},checkRules=function(e,i,o,a,t,r,n){var c=Math.abs(a-i),d=Math.abs(t-o),l=!1;if(whitePiece)for(var s in whitePiecesID)s==board[o][i]&&(l=!0);else for(var w in blackPiecesID)w==board[o][i]&&(l=!0);1!=l&&("P"==e?6==a&&(i==a-1||i==a-2)&&t==o||i==a-1&&t==o||(t==o+1||t==o-1)&&""!=board[o][i]&&i<a?r():gameBoard.removeEventListener("click",n):"p"==e?1==a&&(i==a+1||i==a+2)&&t==o||i==a+1&&t==o||(t==o+1||t==o-1)&&""!=board[o][i]&&a<i?r():gameBoard.removeEventListener("click",n):"B"==e||"b"==e?d==c&&r():"N"==e||"n"==e?(1==c&&2==d||2==c&&1==d)&&r():"R"==e||"r"==e?0!=c&&0!=d||r():"K"==e||"k"==e?(0<=c||0<=d)&&c<=1&&d<=1&&r():"Q"!=e&&"q"!=e||0!=c&&0!=d&&d!=c||r())},movePiece=function(e,c,d){function i(n){e==n&&board.forEach(function(e,i){e.forEach(function(r,e){r==n&&c==e&&d==i&&gameBoard.addEventListener("click",function e(i){var o=i.offsetX,i=i.offsetY,a=Math.floor(i/tileSize),t=Math.floor(o/tileSize);gameBoard.removeEventListener("click",e),checkRules(n,a,t,c,d,function(){board[t][a]=r,l=board[t][a],drawPiece(pieceNames[l],t*tileSize,a*tileSize),board[d][c]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove},e)})})})}var l;if(whitesMove)for(var o in whitePiecesID)o==e&&(whitePiece=!0,i(o),console.log(o));else for(var a in blackPiecesID)a==e&&(whitePiece=!1,i(a))};window.addEventListener("resize",resizeCanvas),window.addEventListener("load",function(){gameBoard.addEventListener("click",selectPiece),resizeCanvas()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJ3aGl0ZVBpZWNlIiwiZ2FtZUJvYXJkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImN0eCIsImdldENvbnRleHQiLCJicm93bkNvbG9yIiwid2luZG93IiwiaW5uZXJXaWR0aCIsIndoaXRlQ29sb3IiLCJpbm5lckhlaWdodCIsIndpbmRvd1dpZHRoIiwid2luZG93SGVpZ2h0IiwiZ2FtZUJvYXJkU2l6ZSIsIk1hdGgiLCJib2FyZCIsInBpZWNlTmFtZXMiLCJwIiwiciIsIm4iLCJiIiwicSIsImsiLCJ3aGl0ZVBpZWNlc0lEIiwiUCIsIlIiLCJOIiwiQiIsIlEiLCJLIiwidGlsZVNpemUiLCJkcmF3UGllY2UiLCJpbWciLCJzZWxlY3RlZFBpZWNlIiwibCIsIndoaXRlc01vdmUiLCJwaWVjZU5hbWUiLCJ4IiwieSIsImZpbGxTdHlsZSIsInNyYyIsImNvbmNhdCIsIm9ubG9hZCIsImRyYXdJbWFnZSIsImRyYXdCb2FyZEFuZFBpZWNlcyIsInBpZWNlIiwiaiIsImkiLCJ3aWR0aCIsImNsaWNrZWRSb3ciLCJmbG9vciIsIkNSIiwiZmlsbFJlY3QiLCJwaWVjZUlEIiwic2VsZWN0UGllY2UiLCJldmVudCIsImNsaWNrZWRDb2wiLCJ3cm9uZ1Rha2UiLCJDQyIsImNsaWNrZWRSb3dUYXJnZXQiLCJtb3ZlUGllY2UiLCJjaGVja1J1bGVzIiwiZHJhd1BpZWNlT25UYXJnZXQiLCJjbGlja2VkQ29sVGFyZ2V0IiwibWFrZU1vdmUiLCJyb3dEaWZmZXJlbmNlIiwiY29sRGlmZmVyZW5jZSIsImFicyIsImJsYWNrUGllY2VzSUQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwid2hpY2hQaWVjZSIsImZvckVhY2giLCJvZmZzZXRZIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlc2l6ZUNhbnZhcyIsIm9mZnNldFgiLCJtb3ZlZFBpZWNlIiwiY29uc29sZSIsImxvZyJdLCJtYXBwaW5ncyI6ImFBQUEsSUF1RElBLFdBdkRFQyxV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QixXQUFhLENBQUNBLFVBRWYsRUFXQzZCLENBQVEsQ0FFVixDQUU0QyxDQUU5QyxDQUFDLENBQ0YsQ0FBQyxDQUVILENBcERBLElBQUlZLEVBc0RKLEdBQUl6QyxXQUNILElBQUssSUFBSWtCLEtBQVc5QixjQUNmOEIsR0FBV3BCLElBQ2RqQyxXQUFhLENBQUEsRUFDYnNFLEVBQVdqQixDQUFPLEVBQ2xCd0IsUUFBUUMsSUFBSXpCLENBQU8sUUFJckIsSUFBSyxJQUFJQSxLQUFXZSxjQUNmZixHQUFXcEIsSUFDZGpDLFdBQWEsQ0FBQSxFQUNic0UsRUFBV2pCLENBQU8sRUFJdEIsRUFFQTlDLE9BQU9rRSxpQkFBaUIsU0FBVUMsWUFBWSxFQUU5Q25FLE9BQU9rRSxpQkFBaUIsT0FBUSxXQUMvQnhFLFVBQVV3RSxpQkFBaUIsUUFBU25CLFdBQVcsRUFDL0NvQixhQUFZLENBQ2IsQ0FBQyIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZ2FtZUJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnYW1lQm9hcmRcIik7XHJcbmNvbnN0IGN0eCA9IGdhbWVCb2FyZC5nZXRDb250ZXh0KFwiMmRcIik7XHJcbmNvbnN0IGJyb3duQ29sb3IgPSBcIiM2NTNjMTBcIjtcclxuY29uc3Qgd2hpdGVDb2xvciA9IFwiI2RmYzc5NVwiO1xyXG5jb25zdCB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG5jb25zdCB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbmNvbnN0IGdhbWVCb2FyZFNpemUgPSBNYXRoLm1pbih3aW5kb3dXaWR0aCwgd2luZG93SGVpZ2h0LCA2MDApO1xyXG5jb25zdCBib2FyZCA9IFtcclxuXHRbXCJyXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJSXCJdLFxyXG5cdFtcIm5cIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIk5cIl0sXHJcblx0W1wiYlwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiQlwiXSxcclxuXHRbXCJxXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJRXCJdLFxyXG5cdFtcImtcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIktcIl0sXHJcblx0W1wiYlwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiQlwiXSxcclxuXHRbXCJuXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJOXCJdLFxyXG5cdFtcInJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIlJcIl0sXHJcbl07XHJcblxyXG5jb25zdCBwaWVjZU5hbWVzID0ge1xyXG5cdHA6IFwiQnBhd25cIixcclxuXHRyOiBcIkJyb29rXCIsXHJcblx0bjogXCJCa25pZ2h0XCIsXHJcblx0YjogXCJCYmlzaG9wXCIsXHJcblx0cTogXCJCcXVlZW5cIixcclxuXHRrOiBcIkJraW5nXCIsXHJcblxyXG5cdFA6IFwiV3Bhd25cIixcclxuXHRSOiBcIldyb29rXCIsXHJcblx0TjogXCJXa25pZ2h0XCIsXHJcblx0QjogXCJXYmlzaG9wXCIsXHJcblx0UTogXCJXcXVlZW5cIixcclxuXHRLOiBcIldraW5nXCIsXHJcbn07XHJcblxyXG5jb25zdCB3aGl0ZVBpZWNlc0lEID0ge1xyXG5cdFA6IFwiV3Bhd25cIixcclxuXHRSOiBcIldyb29rXCIsXHJcblx0TjogXCJXa25pZ2h0XCIsXHJcblx0QjogXCJXYmlzaG9wXCIsXHJcblx0UTogXCJXcXVlZW5cIixcclxuXHRLOiBcIldraW5nXCIsXHJcbn07XHJcblxyXG5jb25zdCBibGFja1BpZWNlc0lEID0ge1xyXG5cdHA6IFwiQnBhd25cIixcclxuXHRyOiBcIkJyb29rXCIsXHJcblx0bjogXCJCa25pZ2h0XCIsXHJcblx0YjogXCJCYmlzaG9wXCIsXHJcblx0cTogXCJCcXVlZW5cIixcclxuXHRrOiBcIkJraW5nXCIsXHJcbn07XHJcblxyXG5sZXQgdGlsZVNpemUgPSBnYW1lQm9hcmRTaXplIC8gODtcclxubGV0IHNlbGVjdGVkUGllY2UgPSBudWxsO1xyXG5sZXQgd2hpdGVzTW92ZSA9IHRydWU7XHJcbmxldCB3aGl0ZVBpZWNlO1xyXG5cclxuY29uc3QgZHJhd1BpZWNlID0gKHBpZWNlTmFtZSwgeCwgeSkgPT4ge1xyXG5cdGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xyXG5cdGltZy5zcmMgPSBgLi9kaXN0L2ltZy8ke3BpZWNlTmFtZX0ucG5nYDtcclxuXHJcblx0aW1nLm9ubG9hZCA9ICgpID0+IHtcclxuXHRcdGN0eC5kcmF3SW1hZ2UoaW1nLCB4LCB5LCB0aWxlU2l6ZSwgdGlsZVNpemUpO1xyXG5cdH07XHJcbn07XHJcblxyXG5jb25zdCBkcmF3Qm9hcmRBbmRQaWVjZXMgPSAoZ2FtZUJvYXJkU2l6ZSkgPT4ge1xyXG5cdGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IGdhbWVCb2FyZFNpemU7IGkgKz0gdGlsZVNpemUsIGorKykge1xyXG5cdFx0Zm9yIChsZXQgayA9IDAsIGwgPSAwOyBrIDwgZ2FtZUJvYXJkU2l6ZTsgayArPSB0aWxlU2l6ZSwgbCsrKSB7XHJcblx0XHRcdGlmIChqICUgMiA9PT0gMCkge1xyXG5cdFx0XHRcdGlmIChsICUgMiA9PT0gMCkge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IHdoaXRlQ29sb3I7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSBicm93bkNvbG9yO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRpZiAobCAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSBicm93bkNvbG9yO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gd2hpdGVDb2xvcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGNvbnN0IHBpZWNlID0gYm9hcmRbal1bbF07XHJcblxyXG5cdFx0XHRpZiAocGllY2UgIT0gXCJcIikge1xyXG5cdFx0XHRcdGRyYXdQaWVjZShwaWVjZU5hbWVzW3BpZWNlXSwgaSwgayk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGN0eC5maWxsUmVjdChpLCBrLCB0aWxlU2l6ZSwgdGlsZVNpemUpO1xyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcbmNvbnN0IHJlc2l6ZUNhbnZhcyA9ICgpID0+IHtcclxuXHRnYW1lQm9hcmQud2lkdGggPSBnYW1lQm9hcmRTaXplO1xyXG5cdGdhbWVCb2FyZC5oZWlnaHQgPSBnYW1lQm9hcmRTaXplO1xyXG5cdGRyYXdCb2FyZEFuZFBpZWNlcyhnYW1lQm9hcmRTaXplKTtcclxufTtcclxuXHJcbmNvbnN0IHNlbGVjdFBpZWNlID0gKGV2ZW50KSA9PiB7XHJcblx0bGV0IHggPSBldmVudC5vZmZzZXRYO1xyXG5cdGxldCB5ID0gZXZlbnQub2Zmc2V0WTtcclxuXHJcblx0Y29uc3QgY2xpY2tlZFJvdyA9IE1hdGguZmxvb3IoeSAvIHRpbGVTaXplKTtcclxuXHRjb25zdCBjbGlja2VkQ29sID0gTWF0aC5mbG9vcih4IC8gdGlsZVNpemUpO1xyXG5cclxuXHRjb25zdCBDUiA9IE1hdGguZmxvb3IoeSAvIHRpbGVTaXplKTtcclxuXHRjb25zdCBDQyA9IE1hdGguZmxvb3IoeCAvIHRpbGVTaXplKTtcclxuXHJcblx0c2VsZWN0ZWRQaWVjZSA9IGJvYXJkW2NsaWNrZWRDb2xdW2NsaWNrZWRSb3ddO1xyXG5cclxuXHRtb3ZlUGllY2Uoc2VsZWN0ZWRQaWVjZSwgQ1IsIENDKTtcclxufTtcclxuXHJcbmNvbnN0IGNoZWNrUnVsZXMgPSAoXHJcblx0cGllY2VJRCxcclxuXHRjbGlja2VkUm93VGFyZ2V0LFxyXG5cdGNsaWNrZWRDb2xUYXJnZXQsXHJcblx0Q1IsXHJcblx0Q0MsXHJcblx0ZHJhd1BpZWNlT25UYXJnZXQsXHJcblx0bWFrZU1vdmVcclxuKSA9PiB7XHJcblx0bGV0IHJvd0RpZmZlcmVuY2UgPSBNYXRoLmFicyhDUiAtIGNsaWNrZWRSb3dUYXJnZXQpO1xyXG5cdGxldCBjb2xEaWZmZXJlbmNlID0gTWF0aC5hYnMoQ0MgLSBjbGlja2VkQ29sVGFyZ2V0KTtcclxuXHRsZXQgd3JvbmdUYWtlID0gZmFsc2U7XHJcblxyXG5cdGlmICh3aGl0ZVBpZWNlKSB7XHJcblx0XHRmb3IgKGxldCBwaWVjZUlEIGluIHdoaXRlUGllY2VzSUQpIHtcclxuXHRcdFx0aWYgKHBpZWNlSUQgPT0gYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0pIHtcclxuXHRcdFx0XHR3cm9uZ1Rha2UgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSBlbHNlIHtcclxuXHRcdGZvciAobGV0IHBpZWNlSUQgaW4gYmxhY2tQaWVjZXNJRCkge1xyXG5cdFx0XHRpZiAocGllY2VJRCA9PSBib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSkge1xyXG5cdFx0XHRcdHdyb25nVGFrZSA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGlmICh3cm9uZ1Rha2UgIT0gdHJ1ZSkge1xyXG5cdFx0Ly8gUGF3bnNcclxuXHRcdGlmIChwaWVjZUlEID09IFwiUFwiKSB7XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHRDUiA9PSA2ICYmXHJcblx0XHRcdFx0KGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgLSAxIHx8IGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgLSAyKSAmJlxyXG5cdFx0XHRcdENDID09IGNsaWNrZWRDb2xUYXJnZXRcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIGlmIChjbGlja2VkUm93VGFyZ2V0ID09IENSIC0gMSAmJiBDQyA9PSBjbGlja2VkQ29sVGFyZ2V0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIGlmIChcclxuXHRcdFx0XHQoQ0MgPT0gY2xpY2tlZENvbFRhcmdldCArIDEgfHwgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCAtIDEpICYmXHJcblx0XHRcdFx0Ym9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gIT0gXCJcIiAmJlxyXG5cdFx0XHRcdGNsaWNrZWRSb3dUYXJnZXQgPCBDUlxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGdhbWVCb2FyZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJwXCIpIHtcclxuXHRcdFx0aWYgKFxyXG5cdFx0XHRcdENSID09IDEgJiZcclxuXHRcdFx0XHQoY2xpY2tlZFJvd1RhcmdldCA9PSBDUiArIDEgfHwgY2xpY2tlZFJvd1RhcmdldCA9PSBDUiArIDIpICYmXHJcblx0XHRcdFx0Q0MgPT0gY2xpY2tlZENvbFRhcmdldFxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgKyAxICYmIENDID09IGNsaWNrZWRDb2xUYXJnZXQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKFxyXG5cdFx0XHRcdChDQyA9PSBjbGlja2VkQ29sVGFyZ2V0ICsgMSB8fCBDQyA9PSBjbGlja2VkQ29sVGFyZ2V0IC0gMSkgJiZcclxuXHRcdFx0XHRib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSAhPSBcIlwiICYmXHJcblx0XHRcdFx0Y2xpY2tlZFJvd1RhcmdldCA+IENSXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Z2FtZUJvYXJkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEJpc2hvcHNcclxuXHRcdH0gZWxzZSBpZiAocGllY2VJRCA9PSBcIkJcIiB8fCBwaWVjZUlEID09IFwiYlwiKSB7XHJcblx0XHRcdGlmIChjb2xEaWZmZXJlbmNlID09IHJvd0RpZmZlcmVuY2UpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vIEtuaWdodHNcclxuXHRcdH0gZWxzZSBpZiAocGllY2VJRCA9PSBcIk5cIiB8fCBwaWVjZUlEID09IFwiblwiKSB7XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHQocm93RGlmZmVyZW5jZSA9PSAxICYmIGNvbERpZmZlcmVuY2UgPT0gMikgfHxcclxuXHRcdFx0XHQocm93RGlmZmVyZW5jZSA9PSAyICYmIGNvbERpZmZlcmVuY2UgPT0gMSlcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBSb29rc1xyXG5cdFx0fSBlbHNlIGlmIChwaWVjZUlEID09IFwiUlwiIHx8IHBpZWNlSUQgPT0gXCJyXCIpIHtcclxuXHRcdFx0aWYgKHJvd0RpZmZlcmVuY2UgPT0gMCB8fCBjb2xEaWZmZXJlbmNlID09IDApIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vIEtpbmdzXHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJLXCIgfHwgcGllY2VJRCA9PSBcImtcIikge1xyXG5cdFx0XHRpZiAoXHJcblx0XHRcdFx0KHJvd0RpZmZlcmVuY2UgPj0gMCB8fCBjb2xEaWZmZXJlbmNlID49IDApICYmXHJcblx0XHRcdFx0cm93RGlmZmVyZW5jZSA8PSAxICYmXHJcblx0XHRcdFx0Y29sRGlmZmVyZW5jZSA8PSAxXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gUXVlZW5zXHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJRXCIgfHwgcGllY2VJRCA9PSBcInFcIikge1xyXG5cdFx0XHRpZiAocm93RGlmZmVyZW5jZSA9PSAwIHx8IGNvbERpZmZlcmVuY2UgPT0gMCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSBpZiAoY29sRGlmZmVyZW5jZSA9PSByb3dEaWZmZXJlbmNlKSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcbmNvbnN0IG1vdmVQaWVjZSA9IChzZWxlY3RlZFBpZWNlLCBDUiwgQ0MpID0+IHtcclxuXHRsZXQgbW92ZWRQaWVjZTtcclxuXHJcblx0Y29uc3Qgd2hpY2hQaWVjZSA9IChwaWVjZUlEKSA9PiB7XHJcblx0XHRpZiAoc2VsZWN0ZWRQaWVjZSA9PSBwaWVjZUlEKSB7XHJcblx0XHRcdGJvYXJkLmZvckVhY2goKGNsaWNrZWRSb3csIGkpID0+IHtcclxuXHRcdFx0XHRjbGlja2VkUm93LmZvckVhY2goKGNsaWNrZWRDb2wsIGopID0+IHtcclxuXHRcdFx0XHRcdGlmIChjbGlja2VkQ29sID09IHBpZWNlSUQgJiYgQ1IgPT0gaiAmJiBDQyA9PSBpKSB7XHJcblx0XHRcdFx0XHRcdGNvbnN0IG1ha2VNb3ZlID0gKGV2ZW50KSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0bGV0IHggPSBldmVudC5vZmZzZXRYO1xyXG5cdFx0XHRcdFx0XHRcdGxldCB5ID0gZXZlbnQub2Zmc2V0WTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgY2xpY2tlZFJvd1RhcmdldCA9IE1hdGguZmxvb3IoeSAvIHRpbGVTaXplKTtcclxuXHRcdFx0XHRcdFx0XHRjb25zdCBjbGlja2VkQ29sVGFyZ2V0ID0gTWF0aC5mbG9vcih4IC8gdGlsZVNpemUpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRjb25zdCBkcmF3UGllY2VPblRhcmdldCA9ICgpID0+IHtcclxuXHRcdFx0XHRcdFx0XHRcdC8vIGlmIChib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSA9PSBcIlwiIHx8IHdoaXRlUGllY2UgPT0gdHJ1ZSB8fCB3aGl0ZVBpZWNlID09IGZhbHNlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XSA9IGNsaWNrZWRDb2w7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0bW92ZWRQaWVjZSA9IGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdGRyYXdQaWVjZShcclxuXHRcdFx0XHRcdFx0XHRcdFx0cGllY2VOYW1lc1ttb3ZlZFBpZWNlXSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2xpY2tlZENvbFRhcmdldCAqIHRpbGVTaXplLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRjbGlja2VkUm93VGFyZ2V0ICogdGlsZVNpemVcclxuXHRcdFx0XHRcdFx0XHRcdCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0Ym9hcmRbQ0NdW0NSXSA9IFwiXCI7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0ZHJhd0JvYXJkQW5kUGllY2VzKGdhbWVCb2FyZFNpemUpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdHdoaXRlc01vdmUgPSAhd2hpdGVzTW92ZTtcclxuXHRcdFx0XHRcdFx0XHRcdC8vIH1cclxuXHRcdFx0XHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHRcdFx0XHRnYW1lQm9hcmQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG1ha2VNb3ZlKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Y2hlY2tSdWxlcyhcclxuXHRcdFx0XHRcdFx0XHRcdHBpZWNlSUQsXHJcblx0XHRcdFx0XHRcdFx0XHRjbGlja2VkUm93VGFyZ2V0LFxyXG5cdFx0XHRcdFx0XHRcdFx0Y2xpY2tlZENvbFRhcmdldCxcclxuXHRcdFx0XHRcdFx0XHRcdENSLFxyXG5cdFx0XHRcdFx0XHRcdFx0Q0MsXHJcblx0XHRcdFx0XHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCxcclxuXHRcdFx0XHRcdFx0XHRcdG1ha2VNb3ZlXHJcblx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0fTtcclxuXHJcblx0XHRcdFx0XHRcdGdhbWVCb2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRpZiAod2hpdGVzTW92ZSkge1xyXG5cdFx0Zm9yIChsZXQgcGllY2VJRCBpbiB3aGl0ZVBpZWNlc0lEKSB7XHJcblx0XHRcdGlmIChwaWVjZUlEID09IHNlbGVjdGVkUGllY2UpIHtcclxuXHRcdFx0XHR3aGl0ZVBpZWNlID0gdHJ1ZTtcclxuXHRcdFx0XHR3aGljaFBpZWNlKHBpZWNlSUQpO1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKHBpZWNlSUQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSBlbHNlIHtcclxuXHRcdGZvciAobGV0IHBpZWNlSUQgaW4gYmxhY2tQaWVjZXNJRCkge1xyXG5cdFx0XHRpZiAocGllY2VJRCA9PSBzZWxlY3RlZFBpZWNlKSB7XHJcblx0XHRcdFx0d2hpdGVQaWVjZSA9IGZhbHNlO1xyXG5cdFx0XHRcdHdoaWNoUGllY2UocGllY2VJRCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCByZXNpemVDYW52YXMpO1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHtcclxuXHRnYW1lQm9hcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHNlbGVjdFBpZWNlKTtcclxuXHRyZXNpemVDYW52YXMoKTtcclxufSk7XHJcbiJdfQ==
