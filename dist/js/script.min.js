"use strict";var whitePiece,gameBoard=document.getElementById("gameBoard"),ctx=gameBoard.getContext("2d"),brownColor="#653c10",whiteColor="#dfc795",windowWidth=window.innerWidth,windowHeight=window.innerHeight,gameBoardSize=Math.min(windowWidth,windowHeight,600),board=[["r","p","","","","","P","R"],["n","p","","","","","P","N"],["b","p","","","","","P","B"],["q","p","","","","","P","Q"],["k","p","","","","","P","K"],["b","p","","","","","P","B"],["n","p","","","","","P","N"],["r","p","","","","","P","R"]],pieceNames={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking",P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},whitePiecesID={P:"Wpawn",R:"Wrook",N:"Wknight",B:"Wbishop",Q:"Wqueen",K:"Wking"},blackPiecesID={p:"Bpawn",r:"Brook",n:"Bknight",b:"Bbishop",q:"Bqueen",k:"Bking"},tileSize=gameBoardSize/8,selectedPiece=null,whitesMove=!0,drawPiece=function(e,i,o){var a=new Image;a.src="./dist/img/".concat(e,".png"),a.onload=function(){ctx.drawImage(a,i,o,tileSize,tileSize)}},drawBoardAndPieces=function(e){for(var i=0,o=0;i<e;i+=tileSize,o++)for(var a=0,r=0;a<e;a+=tileSize,r++){ctx.fillStyle=o%2==0?r%2==0?whiteColor:brownColor:r%2==0?brownColor:whiteColor;var t=board[o][r];""!=t&&drawPiece(pieceNames[t],i,a),ctx.fillRect(i,a,tileSize,tileSize)}},resizeCanvas=function(){gameBoard.width=gameBoardSize,gameBoard.height=gameBoardSize,drawBoardAndPieces(gameBoardSize)},selectPiece=function(e){var i=e.offsetX,e=e.offsetY,o=Math.floor(e/tileSize),a=Math.floor(i/tileSize),e=Math.floor(e/tileSize),i=Math.floor(i/tileSize);selectedPiece=board[a][o],movePiece(selectedPiece,e,i)},checkRules=function(e,n,c,i,o,a,r){var t=Math.abs(i-n),d=Math.abs(o-c),l=!1;if(whitePiece)for(var s in whitePiecesID)s==board[c][n]&&(l=!0);else for(var h in blackPiecesID)h==board[c][n]&&(l=!0);if(1!=l)if("P"==e)6==i&&(n==i-1||n==i-2)&&o==c||n==i-1&&o==c||(o==c+1||o==c-1)&&""!=board[c][n]&&n<i?a():gameBoard.removeEventListener("click",r);else if("p"==e)1==i&&(n==i+1||n==i+2)&&o==c||n==i+1&&o==c||(o==c+1||o==c-1)&&""!=board[c][n]&&i<n?a():gameBoard.removeEventListener("click",r);else if("B"==e||"b"==e){if(d==t){for(var f=1;f<=8;f++)if("break"===function(e){Math.abs(n-e),Math.abs(c-e);function i(){"k"==board[o][r]||"K"==board[o][r]?(console.log("szach"),console.log(e),drawPiece("kCHECK",o*tileSize,r*tileSize)):"k"==board[a][t]||"K"==board[a][t]?(console.log("szach"),console.log(e),drawPiece("kCHECK",a*tileSize,t*tileSize)):"k"==board[o][t]||"K"==board[o][t]?(console.log("szach"),console.log(e),drawPiece("kCHECK",o*tileSize,t*tileSize)):"k"!=board[a][r]&&"K"!=board[a][r]||(console.log("szach"),console.log(e),drawPiece("kCHECK",a*tileSize,r*tileSize))}var o=Math.min(c+e,7),a=Math.abs(c-e),r=Math.min(n+e,7),t=Math.abs(n-e);if(""!=board[o][r]&&""!=board[a][t]&&""!=board[o][t]&&""!=board[a][r]||i(),0==t)return"break";console.log(board[o][t])}(f))break;a()}}else"N"==e||"n"==e?(1==t&&2==d||2==t&&1==d)&&a():"R"==e||"r"==e?0!=t&&0!=d||a():"K"==e||"k"==e?(0<=t||0<=d)&&t<=1&&d<=1&&a():"Q"!=e&&"q"!=e||0!=t&&0!=d&&d!=t||a()},movePiece=function(e,c,d){function i(n){e==n&&board.forEach(function(e,i){e.forEach(function(t,e){t==n&&c==e&&d==i&&gameBoard.addEventListener("click",function e(i){var o=i.offsetX,i=i.offsetY,a=Math.floor(i/tileSize),r=Math.floor(o/tileSize);gameBoard.removeEventListener("click",e),checkRules(n,a,r,c,d,function(){board[r][a]=t,l=board[r][a],drawPiece(pieceNames[l],r*tileSize,a*tileSize),board[d][c]="",drawBoardAndPieces(gameBoardSize),whitesMove=!whitesMove},e)})})})}var l;if(whitesMove)for(var o in whitePiecesID)o==e&&(whitePiece=!0,i(o));else for(var a in blackPiecesID)a==e&&(whitePiece=!1,i(a))};window.addEventListener("resize",resizeCanvas),window.addEventListener("load",function(){gameBoard.addEventListener("click",selectPiece),resizeCanvas()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJ3aGl0ZVBpZWNlIiwiZ2FtZUJvYXJkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImN0eCIsImdldENvbnRleHQiLCJicm93bkNvbG9yIiwid2luZG93IiwiaW5uZXJXaWR0aCIsIndoaXRlQ29sb3IiLCJpbm5lckhlaWdodCIsIndpbmRvd1dpZHRoIiwid2luZG93SGVpZ2h0IiwiZ2FtZUJvYXJkU2l6ZSIsIk1hdGgiLCJib2FyZCIsInBpZWNlTmFtZXMiLCJwIiwiciIsIm4iLCJiIiwicSIsImsiLCJ3aGl0ZVBpZWNlc0lEIiwiUCIsIlIiLCJOIiwiQiIsIlEiLCJLIiwidGlsZVNpemUiLCJkcmF3UGllY2UiLCJpbWciLCJzZWxlY3RlZFBpZWNlIiwibCIsIndoaXRlc01vdmUiLCJwaWVjZU5hbWUiLCJ4IiwieSIsImZpbGxTdHlsZSIsInNyYyIsImNvbmNhdCIsIm9ubG9hZCIsImRyYXdJbWFnZSIsImRyYXdCb2FyZEFuZFBpZWNlcyIsInBpZWNlIiwiaiIsImkiLCJ3aWR0aCIsImNsaWNrZWRSb3ciLCJmbG9vciIsIkNSIiwiZmlsbFJlY3QiLCJwaWVjZUlEIiwic2VsZWN0UGllY2UiLCJldmVudCIsImNsaWNrZWRDb2wiLCJ3cm9uZ1Rha2UiLCJDQyIsImNsaWNrZWRSb3dUYXJnZXQiLCJtb3ZlUGllY2UiLCJjaGVja1J1bGVzIiwiZHJhd1BpZWNlT25UYXJnZXQiLCJjbGlja2VkQ29sVGFyZ2V0IiwibWFrZU1vdmUiLCJyb3dEaWZmZXJlbmNlIiwiY29sRGlmZmVyZW5jZSIsImFicyIsImNvbERpZmZlcmVuY2UyIiwiaW5jcmVtZW50ZWRDb2wiLCJkZWNyZW1lbnRlZENvbCIsImNvbnNvbGUiLCJpc0NoZWNrIiwiaW5jcmVtZW50ZWRSb3ciLCJfbG9vcCIsImRlY3JlbWVudGVkUm93IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImxvZyIsIm1vdmVkUGllY2UiLCJmb3JFYWNoIiwib2Zmc2V0WSIsIm1pbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJ3aGljaFBpZWNlIiwicmVzaXplQ2FudmFzIiwib2Zmc2V0WCIsImJsYWNrUGllY2VzSUQiXSwibWFwcGluZ3MiOiJhQUFBLElBdURJQSxXQXZERUMsVUFBWUMsU0FBU0MsZUFBZSxXQUFXLEVBQy9DQyxJQUFNSCxVQUFVSSxXQUFXLElBQUksRUFEL0JKLFdBQVlDLFVBQ1pFLFdBQWUsVUFDZkUsWUFBYUMsT0FBU0MsV0FDdEJDLGFBQWFGLE9BQVNHLFlBQ3RCQyxjQUFjSixLQUFPQyxJQUFBQSxZQUFVSSxhQUFBLEdBQUEsRUFDL0JBLE1BQUFBLENBQ04sQ0FBQSxJQUFNQyxJQUFBQSxHQUFBQSxHQUFnQkMsR0FBSSxHQUFJLElBQUNILEtBQy9CLENBQUEsSUFBTUksSUFBUSxHQUNaLEdBQUssR0FBSyxHQUFJLElBQUksS0FVcEIsQ0FBQSxJQUFNQyxJQUFBQSxHQUFVLEdBQUcsR0FBQSxHQUFBLElBQUEsS0FQbEIsQ0FRQUMsSUFBRyxJQUFPLEdBQUEsR0FBQSxHQUFBLEdBQUEsSUFBQSxLQVBWLENBUUFDLElBQUcsSUFBTyxHQUFBLEdBQUEsR0FBQSxHQUFBLElBQUEsS0FQVixDQVFBQyxJQUFHLElBQUEsR0FBUyxHQUFBLEdBQUEsR0FBQSxJQUFBLEtBUFosQ0FRQUMsSUFBRyxJQUFBLEdBQVMsR0FBQSxHQUFBLEdBQUEsSUFBQSxLQVBaLENBUUFDLElBQUcsSUFBQSxHQUFRLEdBQUEsR0FBQSxHQUFBLElBQUEsTUFJUkwsV0FBTyxDQVJWQyxFQVNDLFFBUkRDLEVBU0MsUUFSREMsRUFTQyxVQVJEQyxFQVNDLFVBQ0RDLEVBQUEsU0FFREMsRUFBTUMsUUFSTEMsRUFVQyxRQVREQyxFQVVDLFFBVERDLEVBVUMsVUFUREMsRUFVQyxVQVREQyxFQVVDLFNBQ0RDLEVBQUEsT0FFRCxFQUVJTixjQUFPLENBVlZDLEVBV0MsUUFWREMsRUFXQyxRQVZEQyxFQVdDLFVBVkRDLEVBV0MsVUFDREMsRUFBQSxTQUVEQyxFQUFJQyxPQUNKLEVBRUk5QixjQUFVLENBRWRp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N0M5QyxVQUFVaUYsaUJBQWlCLFFBeENWLFNBQVhsQixFQUFZVCxHQUNqQixJQUFJbEIsRUFBSWtCLEVBQU04QixRQUNWL0MsRUFBSWlCLEVBQU15QixRQUVSckIsRUFBbUI3QyxLQUFLb0MsTUFBTVosRUFBSVIsUUFBUSxFQUMxQ2lDLEVBQW1CakQsS0FBS29DLE1BQU1iLEVBQUlQLFFBQVEsRUFzQmhEN0IsVUFBVTJFLG9CQUFvQixRQUFTWixDQUFRLEVBRS9DSCxXQUNDUixFQUNBTSxFQUNBSSxFQUNBWixFQUNBTyxFQTNCeUIsV0FFekIzQyxNQUFNZ0QsR0FBa0JKLEdBQW9CSCxFQUU1Q3NCLEVBQWEvRCxNQUFNZ0QsR0FBa0JKLEdBRXJDNUIsVUFDQ2YsV0FBVzhELEdBQ1hmLEVBQW1CakMsU0FDbkI2QixFQUFtQjdCLFFBQVEsRUFHNUJmLE1BQU0yQyxHQUFJUCxHQUFNLEdBRWhCUCxtQkFBbUIvQixhQUFhLEVBRWhDc0IsV0FBYSxDQUFDQSxVQUVmLEVBV0M2QixDQUFRLENBRVYsQ0FFNEMsQ0FFOUMsQ0FBQyxDQUNGLENBQUMsQ0FFSCxDQXBEQSxJQUFJYyxFQXNESixHQUFJM0MsV0FDSCxJQUFLLElBQUlrQixLQUFXOUIsY0FDZjhCLEdBQVdwQixJQUNkakMsV0FBYSxDQUFBLEVBQ2JtRixFQUFXOUIsQ0FBTyxRQUlwQixJQUFLLElBQUlBLEtBQVdpQyxjQUNmakMsR0FBV3BCLElBQ2RqQyxXQUFhLENBQUEsRUFDYm1GLEVBQVc5QixDQUFPLEVBSXRCLEVBRUE5QyxPQUFPMkUsaUJBQWlCLFNBQVVFLFlBQVksRUFFOUM3RSxPQUFPMkUsaUJBQWlCLE9BQVEsV0FDL0JqRixVQUFVaUYsaUJBQWlCLFFBQVM1QixXQUFXLEVBQy9DOEIsYUFBWSxDQUNiLENBQUMiLCJmaWxlIjoic2NyaXB0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGdhbWVCb2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZ2FtZUJvYXJkXCIpO1xyXG5jb25zdCBjdHggPSBnYW1lQm9hcmQuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG5jb25zdCBicm93bkNvbG9yID0gXCIjNjUzYzEwXCI7XHJcbmNvbnN0IHdoaXRlQ29sb3IgPSBcIiNkZmM3OTVcIjtcclxuY29uc3Qgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuY29uc3Qgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5jb25zdCBnYW1lQm9hcmRTaXplID0gTWF0aC5taW4od2luZG93V2lkdGgsIHdpbmRvd0hlaWdodCwgNjAwKTtcclxuY29uc3QgYm9hcmQgPSBbXHJcblx0W1wiclwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiUlwiXSxcclxuXHRbXCJuXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJOXCJdLFxyXG5cdFtcImJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIkJcIl0sXHJcblx0W1wicVwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiUVwiXSxcclxuXHRbXCJrXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJLXCJdLFxyXG5cdFtcImJcIiwgXCJwXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiUFwiLCBcIkJcIl0sXHJcblx0W1wiblwiLCBcInBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJQXCIsIFwiTlwiXSxcclxuXHRbXCJyXCIsIFwicFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlBcIiwgXCJSXCJdLFxyXG5dO1xyXG5cclxuY29uc3QgcGllY2VOYW1lcyA9IHtcclxuXHRwOiBcIkJwYXduXCIsXHJcblx0cjogXCJCcm9va1wiLFxyXG5cdG46IFwiQmtuaWdodFwiLFxyXG5cdGI6IFwiQmJpc2hvcFwiLFxyXG5cdHE6IFwiQnF1ZWVuXCIsXHJcblx0azogXCJCa2luZ1wiLFxyXG5cclxuXHRQOiBcIldwYXduXCIsXHJcblx0UjogXCJXcm9va1wiLFxyXG5cdE46IFwiV2tuaWdodFwiLFxyXG5cdEI6IFwiV2Jpc2hvcFwiLFxyXG5cdFE6IFwiV3F1ZWVuXCIsXHJcblx0SzogXCJXa2luZ1wiLFxyXG59O1xyXG5cclxuY29uc3Qgd2hpdGVQaWVjZXNJRCA9IHtcclxuXHRQOiBcIldwYXduXCIsXHJcblx0UjogXCJXcm9va1wiLFxyXG5cdE46IFwiV2tuaWdodFwiLFxyXG5cdEI6IFwiV2Jpc2hvcFwiLFxyXG5cdFE6IFwiV3F1ZWVuXCIsXHJcblx0SzogXCJXa2luZ1wiLFxyXG59O1xyXG5cclxuY29uc3QgYmxhY2tQaWVjZXNJRCA9IHtcclxuXHRwOiBcIkJwYXduXCIsXHJcblx0cjogXCJCcm9va1wiLFxyXG5cdG46IFwiQmtuaWdodFwiLFxyXG5cdGI6IFwiQmJpc2hvcFwiLFxyXG5cdHE6IFwiQnF1ZWVuXCIsXHJcblx0azogXCJCa2luZ1wiLFxyXG59O1xyXG5cclxubGV0IHRpbGVTaXplID0gZ2FtZUJvYXJkU2l6ZSAvIDg7XHJcbmxldCBzZWxlY3RlZFBpZWNlID0gbnVsbDtcclxubGV0IHdoaXRlc01vdmUgPSB0cnVlO1xyXG5sZXQgd2hpdGVQaWVjZTtcclxuXHJcbmNvbnN0IGRyYXdQaWVjZSA9IChwaWVjZU5hbWUsIHgsIHkpID0+IHtcclxuXHRjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHRpbWcuc3JjID0gYC4vZGlzdC9pbWcvJHtwaWVjZU5hbWV9LnBuZ2A7XHJcblxyXG5cdGltZy5vbmxvYWQgPSAoKSA9PiB7XHJcblx0XHRjdHguZHJhd0ltYWdlKGltZywgeCwgeSwgdGlsZVNpemUsIHRpbGVTaXplKTtcclxuXHR9O1xyXG59O1xyXG5cclxuY29uc3QgZHJhd0JvYXJkQW5kUGllY2VzID0gKGdhbWVCb2FyZFNpemUpID0+IHtcclxuXHRmb3IgKGxldCBpID0gMCwgaiA9IDA7IGkgPCBnYW1lQm9hcmRTaXplOyBpICs9IHRpbGVTaXplLCBqKyspIHtcclxuXHRcdGZvciAobGV0IGsgPSAwLCBsID0gMDsgayA8IGdhbWVCb2FyZFNpemU7IGsgKz0gdGlsZVNpemUsIGwrKykge1xyXG5cdFx0XHRpZiAoaiAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRpZiAobCAlIDIgPT09IDApIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSB3aGl0ZUNvbG9yO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gYnJvd25Db2xvcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0aWYgKGwgJSAyID09PSAwKSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFN0eWxlID0gYnJvd25Db2xvcjtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IHdoaXRlQ29sb3I7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjb25zdCBwaWVjZSA9IGJvYXJkW2pdW2xdO1xyXG5cclxuXHRcdFx0aWYgKHBpZWNlICE9IFwiXCIpIHtcclxuXHRcdFx0XHRkcmF3UGllY2UocGllY2VOYW1lc1twaWVjZV0sIGksIGspO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjdHguZmlsbFJlY3QoaSwgaywgdGlsZVNpemUsIHRpbGVTaXplKTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5jb25zdCByZXNpemVDYW52YXMgPSAoKSA9PiB7XHJcblx0Z2FtZUJvYXJkLndpZHRoID0gZ2FtZUJvYXJkU2l6ZTtcclxuXHRnYW1lQm9hcmQuaGVpZ2h0ID0gZ2FtZUJvYXJkU2l6ZTtcclxuXHRkcmF3Qm9hcmRBbmRQaWVjZXMoZ2FtZUJvYXJkU2l6ZSk7XHJcbn07XHJcblxyXG5jb25zdCBzZWxlY3RQaWVjZSA9IChldmVudCkgPT4ge1xyXG5cdGxldCB4ID0gZXZlbnQub2Zmc2V0WDtcclxuXHRsZXQgeSA9IGV2ZW50Lm9mZnNldFk7XHJcblxyXG5cdGNvbnN0IGNsaWNrZWRSb3cgPSBNYXRoLmZsb29yKHkgLyB0aWxlU2l6ZSk7XHJcblx0Y29uc3QgY2xpY2tlZENvbCA9IE1hdGguZmxvb3IoeCAvIHRpbGVTaXplKTtcclxuXHJcblx0Y29uc3QgQ1IgPSBNYXRoLmZsb29yKHkgLyB0aWxlU2l6ZSk7XHJcblx0Y29uc3QgQ0MgPSBNYXRoLmZsb29yKHggLyB0aWxlU2l6ZSk7XHJcblxyXG5cdHNlbGVjdGVkUGllY2UgPSBib2FyZFtjbGlja2VkQ29sXVtjbGlja2VkUm93XTtcclxuXHJcblx0bW92ZVBpZWNlKHNlbGVjdGVkUGllY2UsIENSLCBDQyk7XHJcbn07XHJcblxyXG5jb25zdCBjaGVja1J1bGVzID0gKFxyXG5cdHBpZWNlSUQsXHJcblx0Y2xpY2tlZFJvd1RhcmdldCxcclxuXHRjbGlja2VkQ29sVGFyZ2V0LFxyXG5cdENSLFxyXG5cdENDLFxyXG5cdGRyYXdQaWVjZU9uVGFyZ2V0LFxyXG5cdG1ha2VNb3ZlXHJcbikgPT4ge1xyXG5cdGxldCByb3dEaWZmZXJlbmNlID0gTWF0aC5hYnMoQ1IgLSBjbGlja2VkUm93VGFyZ2V0KTtcclxuXHRsZXQgY29sRGlmZmVyZW5jZSA9IE1hdGguYWJzKENDIC0gY2xpY2tlZENvbFRhcmdldCk7XHJcblx0bGV0IHdyb25nVGFrZSA9IGZhbHNlO1xyXG5cclxuXHRpZiAod2hpdGVQaWVjZSkge1xyXG5cdFx0Zm9yIChsZXQgcGllY2VJRCBpbiB3aGl0ZVBpZWNlc0lEKSB7XHJcblx0XHRcdGlmIChwaWVjZUlEID09IGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdKSB7XHJcblx0XHRcdFx0d3JvbmdUYWtlID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0gZWxzZSB7XHJcblx0XHRmb3IgKGxldCBwaWVjZUlEIGluIGJsYWNrUGllY2VzSUQpIHtcclxuXHRcdFx0aWYgKHBpZWNlSUQgPT0gYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0pIHtcclxuXHRcdFx0XHR3cm9uZ1Rha2UgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRpZiAod3JvbmdUYWtlICE9IHRydWUpIHtcclxuXHRcdC8vIFBhd25zXHJcblx0XHRpZiAocGllY2VJRCA9PSBcIlBcIikge1xyXG5cdFx0XHRpZiAoXHJcblx0XHRcdFx0Q1IgPT0gNiAmJlxyXG5cdFx0XHRcdChjbGlja2VkUm93VGFyZ2V0ID09IENSIC0gMSB8fCBjbGlja2VkUm93VGFyZ2V0ID09IENSIC0gMikgJiZcclxuXHRcdFx0XHRDQyA9PSBjbGlja2VkQ29sVGFyZ2V0XHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSBpZiAoY2xpY2tlZFJvd1RhcmdldCA9PSBDUiAtIDEgJiYgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH0gZWxzZSBpZiAoXHJcblx0XHRcdFx0KENDID09IGNsaWNrZWRDb2xUYXJnZXQgKyAxIHx8IENDID09IGNsaWNrZWRDb2xUYXJnZXQgLSAxKSAmJlxyXG5cdFx0XHRcdGJvYXJkW2NsaWNrZWRDb2xUYXJnZXRdW2NsaWNrZWRSb3dUYXJnZXRdICE9IFwiXCIgJiZcclxuXHRcdFx0XHRjbGlja2VkUm93VGFyZ2V0IDwgQ1JcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRnYW1lQm9hcmQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG1ha2VNb3ZlKTtcclxuXHRcdFx0fVxyXG5cdFx0fSBlbHNlIGlmIChwaWVjZUlEID09IFwicFwiKSB7XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHRDUiA9PSAxICYmXHJcblx0XHRcdFx0KGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgKyAxIHx8IGNsaWNrZWRSb3dUYXJnZXQgPT0gQ1IgKyAyKSAmJlxyXG5cdFx0XHRcdENDID09IGNsaWNrZWRDb2xUYXJnZXRcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIGlmIChjbGlja2VkUm93VGFyZ2V0ID09IENSICsgMSAmJiBDQyA9PSBjbGlja2VkQ29sVGFyZ2V0KSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fSBlbHNlIGlmIChcclxuXHRcdFx0XHQoQ0MgPT0gY2xpY2tlZENvbFRhcmdldCArIDEgfHwgQ0MgPT0gY2xpY2tlZENvbFRhcmdldCAtIDEpICYmXHJcblx0XHRcdFx0Ym9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gIT0gXCJcIiAmJlxyXG5cdFx0XHRcdGNsaWNrZWRSb3dUYXJnZXQgPiBDUlxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGdhbWVCb2FyZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbWFrZU1vdmUpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBCaXNob3BzXHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJCXCIgfHwgcGllY2VJRCA9PSBcImJcIikge1xyXG5cdFx0XHRpZiAoY29sRGlmZmVyZW5jZSA9PSByb3dEaWZmZXJlbmNlKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDE7IGkgPD0gODsgaSsrKSB7XHJcblx0XHRcdFx0XHRsZXQgcm93RGlmZmVyZW5jZTIgPSBNYXRoLmFicyhjbGlja2VkUm93VGFyZ2V0IC0gaSk7XHJcblx0XHRcdFx0XHRsZXQgY29sRGlmZmVyZW5jZTIgPSBNYXRoLmFicyhjbGlja2VkQ29sVGFyZ2V0IC0gaSk7XHJcblxyXG5cdFx0XHRcdFx0bGV0IGluY3JlbWVudGVkQ29sID0gTWF0aC5taW4oY2xpY2tlZENvbFRhcmdldCArIGksIDcpO1xyXG5cdFx0XHRcdFx0bGV0IGRlY3JlbWVudGVkQ29sID0gTWF0aC5hYnMoY2xpY2tlZENvbFRhcmdldCAtIGkpO1xyXG5cdFx0XHRcdFx0bGV0IGluY3JlbWVudGVkUm93ID0gTWF0aC5taW4oY2xpY2tlZFJvd1RhcmdldCArIGksIDcpO1xyXG5cdFx0XHRcdFx0bGV0IGRlY3JlbWVudGVkUm93ID0gTWF0aC5hYnMoY2xpY2tlZFJvd1RhcmdldCAtIGkpO1xyXG5cclxuXHRcdFx0XHRcdFx0Y29uc3QgaXNDaGVjayA9ICgpID0+IHtcclxuXHRcdFx0XHRcdFx0XHRpZiAoXHJcblx0XHRcdFx0XHRcdFx0XHQoKGJvYXJkW2luY3JlbWVudGVkQ29sXVtpbmNyZW1lbnRlZFJvd10gPT0gXCJrXCIpIHx8IChib2FyZFtpbmNyZW1lbnRlZENvbF1baW5jcmVtZW50ZWRSb3ddID09IFwiS1wiKSlcclxuXHRcdFx0XHRcdFx0XHQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwic3phY2hcIik7XHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhpKTtcclxuXHRcdFx0XHRcdFx0XHRcdGRyYXdQaWVjZShcImtDSEVDS1wiLCBpbmNyZW1lbnRlZENvbCp0aWxlU2l6ZSwgaW5jcmVtZW50ZWRSb3cqdGlsZVNpemUpXHJcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmIChcclxuXHRcdFx0XHRcdFx0XHRcdCgoYm9hcmRbZGVjcmVtZW50ZWRDb2xdW2RlY3JlbWVudGVkUm93XSA9PSBcImtcIikgfHwgKGJvYXJkW2RlY3JlbWVudGVkQ29sXVtkZWNyZW1lbnRlZFJvd10gPT0gXCJLXCIpKVxyXG5cdFx0XHRcdFx0XHRcdCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJzemFjaFwiKTtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKGkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0ZHJhd1BpZWNlKFwia0NIRUNLXCIsIGRlY3JlbWVudGVkQ29sKnRpbGVTaXplLCBkZWNyZW1lbnRlZFJvdyp0aWxlU2l6ZSlcclxuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKFxyXG5cdFx0XHRcdFx0XHRcdFx0KChib2FyZFtpbmNyZW1lbnRlZENvbF1bZGVjcmVtZW50ZWRSb3ddID09IFwia1wiKSB8fCAoYm9hcmRbaW5jcmVtZW50ZWRDb2xdW2RlY3JlbWVudGVkUm93XSA9PSBcIktcIikpXHJcblx0XHRcdFx0XHRcdFx0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcInN6YWNoXCIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coaSk7XHJcblx0XHRcdFx0XHRcdFx0XHRkcmF3UGllY2UoXCJrQ0hFQ0tcIiwgaW5jcmVtZW50ZWRDb2wqdGlsZVNpemUsIGRlY3JlbWVudGVkUm93KnRpbGVTaXplKVxyXG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoXHJcblx0XHRcdFx0XHRcdFx0XHQoKGJvYXJkW2RlY3JlbWVudGVkQ29sXVtpbmNyZW1lbnRlZFJvd10gPT0gXCJrXCIpIHx8IChib2FyZFtkZWNyZW1lbnRlZENvbF1baW5jcmVtZW50ZWRSb3ddID09IFwiS1wiKSlcclxuXHRcdFx0XHRcdFx0XHQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwic3phY2hcIik7XHJcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhpKTtcclxuXHRcdFx0XHRcdFx0XHRcdGRyYXdQaWVjZShcImtDSEVDS1wiLCBkZWNyZW1lbnRlZENvbCp0aWxlU2l6ZSwgaW5jcmVtZW50ZWRSb3cqdGlsZVNpemUpXHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRpZiAoXHJcblx0XHRcdFx0XHRcdFx0KChib2FyZFtpbmNyZW1lbnRlZENvbF1baW5jcmVtZW50ZWRSb3ddID09IFwiXCIpKVxyXG5cdFx0XHRcdFx0XHQpIHtcclxuXHRcdFx0XHRcdFx0XHRpc0NoZWNrKCk7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoXHJcblx0XHRcdFx0XHRcdFx0KChib2FyZFtkZWNyZW1lbnRlZENvbF1bZGVjcmVtZW50ZWRSb3ddID09IFwiXCIpKVxyXG5cdFx0XHRcdFx0XHQpIHtcclxuXHRcdFx0XHRcdFx0XHRpc0NoZWNrKCk7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoXHJcblx0XHRcdFx0XHRcdFx0KChib2FyZFtpbmNyZW1lbnRlZENvbF1bZGVjcmVtZW50ZWRSb3ddID09IFwiXCIpKVxyXG5cdFx0XHRcdFx0XHQpIHtcclxuXHRcdFx0XHRcdFx0XHRpc0NoZWNrKCk7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoXHJcblx0XHRcdFx0XHRcdFx0KChib2FyZFtkZWNyZW1lbnRlZENvbF1baW5jcmVtZW50ZWRSb3ddID09IFwiXCIpKVxyXG5cdFx0XHRcdFx0XHQpIHtcclxuXHRcdFx0XHRcdFx0XHRpc0NoZWNrKCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRpZihkZWNyZW1lbnRlZFJvdyA9PSAwKXtcclxuXHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coYm9hcmRbaW5jcmVtZW50ZWRDb2xdW2RlY3JlbWVudGVkUm93XSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBLbmlnaHRzXHJcblx0XHR9IGVsc2UgaWYgKHBpZWNlSUQgPT0gXCJOXCIgfHwgcGllY2VJRCA9PSBcIm5cIikge1xyXG5cdFx0XHRpZiAoXHJcblx0XHRcdFx0KHJvd0RpZmZlcmVuY2UgPT0gMSAmJiBjb2xEaWZmZXJlbmNlID09IDIpIHx8XHJcblx0XHRcdFx0KHJvd0RpZmZlcmVuY2UgPT0gMiAmJiBjb2xEaWZmZXJlbmNlID09IDEpXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gUm9va3NcclxuXHRcdH0gZWxzZSBpZiAocGllY2VJRCA9PSBcIlJcIiB8fCBwaWVjZUlEID09IFwiclwiKSB7XHJcblx0XHRcdGlmIChyb3dEaWZmZXJlbmNlID09IDAgfHwgY29sRGlmZmVyZW5jZSA9PSAwKSB7XHJcblx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBLaW5nc1xyXG5cdFx0fSBlbHNlIGlmIChwaWVjZUlEID09IFwiS1wiIHx8IHBpZWNlSUQgPT0gXCJrXCIpIHtcclxuXHRcdFx0aWYgKFxyXG5cdFx0XHRcdChyb3dEaWZmZXJlbmNlID49IDAgfHwgY29sRGlmZmVyZW5jZSA+PSAwKSAmJlxyXG5cdFx0XHRcdHJvd0RpZmZlcmVuY2UgPD0gMSAmJlxyXG5cdFx0XHRcdGNvbERpZmZlcmVuY2UgPD0gMVxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vIFF1ZWVuc1xyXG5cdFx0fSBlbHNlIGlmIChwaWVjZUlEID09IFwiUVwiIHx8IHBpZWNlSUQgPT0gXCJxXCIpIHtcclxuXHRcdFx0aWYgKHJvd0RpZmZlcmVuY2UgPT0gMCB8fCBjb2xEaWZmZXJlbmNlID09IDApIHtcclxuXHRcdFx0XHRkcmF3UGllY2VPblRhcmdldCgpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKGNvbERpZmZlcmVuY2UgPT0gcm93RGlmZmVyZW5jZSkge1xyXG5cdFx0XHRcdGRyYXdQaWVjZU9uVGFyZ2V0KCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5jb25zdCBtb3ZlUGllY2UgPSAoc2VsZWN0ZWRQaWVjZSwgQ1IsIENDKSA9PiB7XHJcblx0bGV0IG1vdmVkUGllY2U7XHJcblxyXG5cdGNvbnN0IHdoaWNoUGllY2UgPSAocGllY2VJRCkgPT4ge1xyXG5cdFx0aWYgKHNlbGVjdGVkUGllY2UgPT0gcGllY2VJRCkge1xyXG5cdFx0XHRib2FyZC5mb3JFYWNoKChjbGlja2VkUm93LCBpKSA9PiB7XHJcblx0XHRcdFx0Y2xpY2tlZFJvdy5mb3JFYWNoKChjbGlja2VkQ29sLCBqKSA9PiB7XHJcblx0XHRcdFx0XHRpZiAoY2xpY2tlZENvbCA9PSBwaWVjZUlEICYmIENSID09IGogJiYgQ0MgPT0gaSkge1xyXG5cdFx0XHRcdFx0XHRjb25zdCBtYWtlTW92ZSA9IChldmVudCkgPT4ge1xyXG5cdFx0XHRcdFx0XHRcdGxldCB4ID0gZXZlbnQub2Zmc2V0WDtcclxuXHRcdFx0XHRcdFx0XHRsZXQgeSA9IGV2ZW50Lm9mZnNldFk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGNsaWNrZWRSb3dUYXJnZXQgPSBNYXRoLmZsb29yKHkgLyB0aWxlU2l6ZSk7XHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgY2xpY2tlZENvbFRhcmdldCA9IE1hdGguZmxvb3IoeCAvIHRpbGVTaXplKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgZHJhd1BpZWNlT25UYXJnZXQgPSAoKSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0XHQvLyBpZiAoYm9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gPT0gXCJcIiB8fCB3aGl0ZVBpZWNlID09IHRydWUgfHwgd2hpdGVQaWVjZSA9PSBmYWxzZSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ym9hcmRbY2xpY2tlZENvbFRhcmdldF1bY2xpY2tlZFJvd1RhcmdldF0gPSBjbGlja2VkQ29sO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdG1vdmVkUGllY2UgPSBib2FyZFtjbGlja2VkQ29sVGFyZ2V0XVtjbGlja2VkUm93VGFyZ2V0XTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRkcmF3UGllY2UoXHJcblx0XHRcdFx0XHRcdFx0XHRcdHBpZWNlTmFtZXNbbW92ZWRQaWVjZV0sXHJcblx0XHRcdFx0XHRcdFx0XHRcdGNsaWNrZWRDb2xUYXJnZXQgKiB0aWxlU2l6ZSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2xpY2tlZFJvd1RhcmdldCAqIHRpbGVTaXplXHJcblx0XHRcdFx0XHRcdFx0XHQpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdGJvYXJkW0NDXVtDUl0gPSBcIlwiO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdGRyYXdCb2FyZEFuZFBpZWNlcyhnYW1lQm9hcmRTaXplKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHR3aGl0ZXNNb3ZlID0gIXdoaXRlc01vdmU7XHJcblx0XHRcdFx0XHRcdFx0XHQvLyB9XHJcblx0XHRcdFx0XHRcdFx0fTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Z2FtZUJvYXJkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBtYWtlTW92ZSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGNoZWNrUnVsZXMoXHJcblx0XHRcdFx0XHRcdFx0XHRwaWVjZUlELFxyXG5cdFx0XHRcdFx0XHRcdFx0Y2xpY2tlZFJvd1RhcmdldCxcclxuXHRcdFx0XHRcdFx0XHRcdGNsaWNrZWRDb2xUYXJnZXQsXHJcblx0XHRcdFx0XHRcdFx0XHRDUixcclxuXHRcdFx0XHRcdFx0XHRcdENDLFxyXG5cdFx0XHRcdFx0XHRcdFx0ZHJhd1BpZWNlT25UYXJnZXQsXHJcblx0XHRcdFx0XHRcdFx0XHRtYWtlTW92ZVxyXG5cdFx0XHRcdFx0XHRcdCk7XHJcblx0XHRcdFx0XHRcdH07XHJcblxyXG5cdFx0XHRcdFx0XHRnYW1lQm9hcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG1ha2VNb3ZlKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0aWYgKHdoaXRlc01vdmUpIHtcclxuXHRcdGZvciAobGV0IHBpZWNlSUQgaW4gd2hpdGVQaWVjZXNJRCkge1xyXG5cdFx0XHRpZiAocGllY2VJRCA9PSBzZWxlY3RlZFBpZWNlKSB7XHJcblx0XHRcdFx0d2hpdGVQaWVjZSA9IHRydWU7XHJcblx0XHRcdFx0d2hpY2hQaWVjZShwaWVjZUlEKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0gZWxzZSB7XHJcblx0XHRmb3IgKGxldCBwaWVjZUlEIGluIGJsYWNrUGllY2VzSUQpIHtcclxuXHRcdFx0aWYgKHBpZWNlSUQgPT0gc2VsZWN0ZWRQaWVjZSkge1xyXG5cdFx0XHRcdHdoaXRlUGllY2UgPSBmYWxzZTtcclxuXHRcdFx0XHR3aGljaFBpZWNlKHBpZWNlSUQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgcmVzaXplQ2FudmFzKTtcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiB7XHJcblx0Z2FtZUJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzZWxlY3RQaWVjZSk7XHJcblx0cmVzaXplQ2FudmFzKCk7XHJcbn0pO1xyXG4iXX0=
